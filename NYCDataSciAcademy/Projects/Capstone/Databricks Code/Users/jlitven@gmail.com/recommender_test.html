<!DOCTYPE html>
<html>
<head>
  <meta name="databricks-html-version" content="1">
<title>jlitven@gmail.com / recommender_test - Databricks</title>

<meta charset="utf-8">
<meta name="google" content="notranslate">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=UTF8">
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700">

<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/lib/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/lib/jquery-ui-bundle/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/css/main.css">
<link rel="stylesheet" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/css/print.css" media="print">
<link rel="icon" type="image/png" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/img/favicon.ico"/>
<script>window.settings = {"enableSshKeyUI":true,"enableAutoCompleteAsYouType":[],"devTierName":"Community Edition","workspaceFeaturedLinks":[{"linkURI":"https://docs.databricks.com/index.html","displayName":"Documentation","icon":"question"},{"linkURI":"https://docs.databricks.com/release-notes/product/latest.html","displayName":"Release Notes","icon":"code"},{"linkURI":"https://docs.databricks.com/spark/latest/training/index.html","displayName":"Training & Tutorials","icon":"graduation-cap"}],"enableClearStateFeature":false,"dbcForumURL":"http://forums.databricks.com/","maxCustomTags":45,"enableInstanceProfilesUIInJobs":true,"nodeInfo":{"node_types":[{"spark_heap_memory":21145,"instance_type_id":"r3.xlarge","node_type_id":"r3.xlarge","description":"r3.xlarge (beta)","support_cluster_tags":true,"container_memory_mb":26432,"memory_mb":31232,"category":"Memory Optimized","num_cores":4.0,"support_ebs_volumes":true},{"spark_heap_memory":46131,"instance_type_id":"r3.2xlarge","node_type_id":"r3.2xlarge","description":"r3.2xlarge (beta)","support_cluster_tags":true,"container_memory_mb":57664,"memory_mb":62464,"category":"Memory Optimized","num_cores":8.0,"support_ebs_volumes":true},{"spark_heap_memory":96102,"instance_type_id":"r3.4xlarge","node_type_id":"r3.4xlarge","description":"r3.4xlarge (beta)","support_cluster_tags":true,"container_memory_mb":120128,"memory_mb":124928,"category":"Memory Optimized","num_cores":16.0,"support_ebs_volumes":true},{"spark_heap_memory":196044,"instance_type_id":"r3.8xlarge","node_type_id":"r3.8xlarge","description":"r3.8xlarge (beta)","support_cluster_tags":true,"container_memory_mb":245056,"memory_mb":249856,"category":"Memory Optimized","num_cores":32.0,"support_ebs_volumes":true},{"spark_heap_memory":8448,"instance_type_id":"c3.2xlarge","node_type_id":"c3.2xlarge","description":"c3.2xlarge (beta)","support_cluster_tags":true,"container_memory_mb":10560,"memory_mb":15360,"category":"Compute Optimized","num_cores":8.0,"support_ebs_volumes":true},{"spark_heap_memory":20736,"instance_type_id":"c3.4xlarge","node_type_id":"c3.4xlarge","description":"c3.4xlarge (beta)","support_cluster_tags":true,"container_memory_mb":25920,"memory_mb":30720,"category":"Compute Optimized","num_cores":16.0,"support_ebs_volumes":true},{"spark_heap_memory":45312,"instance_type_id":"c3.8xlarge","node_type_id":"c3.8xlarge","description":"c3.8xlarge (beta)","support_cluster_tags":true,"container_memory_mb":56640,"memory_mb":61440,"category":"Compute Optimized","num_cores":32.0,"support_ebs_volumes":true},{"spark_heap_memory":21145,"instance_type_id":"i2.xlarge","node_type_id":"i2.xlarge","description":"i2.xlarge (beta)","support_cluster_tags":true,"container_memory_mb":26432,"memory_mb":31232,"category":"Storage Optimized","num_cores":4.0,"support_ebs_volumes":true},{"spark_heap_memory":46131,"instance_type_id":"i2.2xlarge","node_type_id":"i2.2xlarge","description":"i2.2xlarge (beta)","support_cluster_tags":true,"container_memory_mb":57664,"memory_mb":62464,"category":"Storage Optimized","num_cores":8.0,"support_ebs_volumes":true},{"spark_heap_memory":96102,"instance_type_id":"i2.4xlarge","node_type_id":"i2.4xlarge","description":"i2.4xlarge (beta)","support_cluster_tags":true,"container_memory_mb":120128,"memory_mb":124928,"category":"Storage Optimized","num_cores":16.0,"support_ebs_volumes":true},{"spark_heap_memory":196044,"instance_type_id":"i2.8xlarge","node_type_id":"i2.8xlarge","description":"i2.8xlarge (beta)","support_cluster_tags":true,"container_memory_mb":245056,"memory_mb":249856,"category":"Storage Optimized","num_cores":32.0,"support_ebs_volumes":true},{"spark_heap_memory":23800,"instance_type_id":"r3.2xlarge","node_type_id":"memory-optimized","description":"Memory Optimized","support_cluster_tags":false,"container_memory_mb":28000,"memory_mb":30720,"category":"Memory Optimized","num_cores":4.0,"support_ebs_volumes":false},{"spark_heap_memory":9702,"instance_type_id":"c3.4xlarge","node_type_id":"compute-optimized","description":"Compute Optimized","support_cluster_tags":false,"container_memory_mb":12128,"memory_mb":15360,"category":"Compute Optimized","num_cores":8.0,"support_ebs_volumes":false}],"default_node_type_id":"memory-optimized"},"enableThirdPartyApplicationsUI":false,"enableClusterAcls":true,"notebookRevisionVisibilityHorizon":0,"enableTableHandler":true,"maxEbsVolumesPerInstance":10,"isAdmin":true,"deltaProcessingBatchSize":1000,"enableLargeResultDownload":true,"zoneInfos":[{"id":"us-east-1e","isDefault":true},{"id":"us-east-1b","isDefault":false},{"id":"us-east-1c","isDefault":false},{"id":"us-east-1d","isDefault":false}],"enableEBSVolumesUIForJobs":true,"enablePublishNotebooks":false,"enableMaxConcurrentRuns":false,"enableJobAclsConfig":true,"enableFullTextSearch":true,"enableElasticSparkUI":true,"enableNewClustersCreate":false,"clusters":true,"allowRunOnPendingClusters":true,"applications":false,"fileStoreBase":"FileStore","enableSshKeyUIInJobs":true,"enableDetachAndAttachSubMenu":false,"configurableSparkOptionsSpec":[{"keyPattern":"spark\\.kryo(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.kryo.*","valuePatternDisplay":"*","description":"Configuration options for Kryo serialization"},{"keyPattern":"spark\\.io\\.compression\\.codec","valuePattern":"(lzf|snappy|org\\.apache\\.spark\\.io\\.LZFCompressionCodec|org\\.apache\\.spark\\.io\\.SnappyCompressionCodec)","keyPatternDisplay":"spark.io.compression.codec","valuePatternDisplay":"snappy|lzf","description":"The codec used to compress internal data such as RDD partitions, broadcast variables and shuffle outputs."},{"keyPattern":"spark\\.serializer","valuePattern":"(org\\.apache\\.spark\\.serializer\\.JavaSerializer|org\\.apache\\.spark\\.serializer\\.KryoSerializer)","keyPatternDisplay":"spark.serializer","valuePatternDisplay":"org.apache.spark.serializer.JavaSerializer|org.apache.spark.serializer.KryoSerializer","description":"Class to use for serializing objects that will be sent over the network or need to be cached in serialized form."},{"keyPattern":"spark\\.rdd\\.compress","valuePattern":"(true|false)","keyPatternDisplay":"spark.rdd.compress","valuePatternDisplay":"true|false","description":"Whether to compress serialized RDD partitions (e.g. for StorageLevel.MEMORY_ONLY_SER). Can save substantial space at the cost of some extra CPU time."},{"keyPattern":"spark\\.speculation","valuePattern":"(true|false)","keyPatternDisplay":"spark.speculation","valuePatternDisplay":"true|false","description":"Whether to use speculation (recommended off for streaming)"},{"keyPattern":"spark\\.es(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"es(\\.([^\\.]+))+","valuePattern":".*","keyPatternDisplay":"es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"spark\\.(storage|shuffle)\\.memoryFraction","valuePattern":"0?\\.0*([1-9])([0-9])*","keyPatternDisplay":"spark.(storage|shuffle).memoryFraction","valuePatternDisplay":"(0.0,1.0)","description":"Fraction of Java heap to use for Spark's shuffle or storage"},{"keyPattern":"spark\\.streaming\\.backpressure\\.enabled","valuePattern":"(true|false)","keyPatternDisplay":"spark.streaming.backpressure.enabled","valuePatternDisplay":"true|false","description":"Enables or disables Spark Streaming's internal backpressure mechanism (since 1.5). This enables the Spark Streaming to control the receiving rate based on the current batch scheduling delays and processing times so that the system receives only as fast as the system can process. Internally, this dynamically sets the maximum receiving rate of receivers. This rate is upper bounded by the values `spark.streaming.receiver.maxRate` and `spark.streaming.kafka.maxRatePerPartition` if they are set."},{"keyPattern":"spark\\.streaming\\.receiver\\.maxRate","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.receiver.maxRate","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which each receiver will receive data. Effectively, each stream will consume at most this number of records per second. Setting this configuration to 0 or a negative number will put no limit on the rate. See the deployment guide in the Spark Streaming programing guide for mode details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRatePerPartition","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRatePerPartition","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which data will be read from each Kafka partition when using the Kafka direct stream API introduced in Spark 1.3. See the Kafka Integration guide for more details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRetries","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRetries","valuePatternDisplay":"numeric","description":"Maximum number of consecutive retries the driver will make in order to find the latest offsets on the leader of each partition (a default value of 1 means that the driver will make a maximum of 2 attempts). Only applies to the Kafka direct stream API introduced in Spark 1.3."},{"keyPattern":"spark\\.streaming\\.ui\\.retainedBatches","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.ui.retainedBatches","valuePatternDisplay":"numeric","description":"How many batches the Spark Streaming UI and status APIs remember before garbage collecting."}],"enableReactNotebookComments":true,"enableAdminPasswordReset":true,"enableResetPassword":true,"maxClusterTagValueLength":255,"enableJobsSparkUpgrade":true,"sparkVersions":[{"key":"1.6.x-ubuntu15.10","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"1.4.x-ubuntu15.10","displayName":"Spark 1.4.1 (Hadoop 1)","packageLabel":"spark-image-f710650fb8aaade8e4e812368ea87c45cd8cd0b5e6894ca6c94f3354e8daa6dc","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.0-ubuntu15.10-scala2.10","displayName":"Spark 2.0.0 (Scala 2.10)","packageLabel":"spark-image-073c1b52ace74f251fae2680624a0d8d184a8b57096d1c21c5ce56c29be6a37a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db1-scala2.11","displayName":"Spark 2.1.0 RC5 (Scala 2.11)","packageLabel":"spark-image-20833506f690f3a49c53fb08837cb9b98f7f2e15380f1fb26efc158d953e94c8","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.x-ubuntu15.10-hadoop1","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"1.6.1-ubuntu15.10-hadoop1","displayName":"Spark 1.6.1 (Hadoop 1)","packageLabel":"spark-image-21d1cac181b7b8856dd1b4214a3a734f95b5289089349db9d9c926cb87d843db","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.x-gpu-scala2.11","displayName":"Spark 2.0 (Auto-updating, GPU, Scala 2.11 experimental)","packageLabel":"spark-image-6c2dd678fff350c03ba0e945bab52d0080cd857a39c99a22131b3e824bb8096f","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.2-ubuntu15.10-hadoop1","displayName":"Spark 1.6.2 (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.3-db1-hadoop2-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 2, Scala 2.10)","packageLabel":"spark-image-eaa8d9b990015a14e032fb2e2e15be0b8d5af9627cd01d855df728b67969d5d9","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.2-ubuntu15.10-hadoop2","displayName":"Spark 1.6.2 (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.1-ubuntu15.10-hadoop2","displayName":"Spark 1.6.1 (Hadoop 2)","packageLabel":"spark-image-4cafdf8bc6cba8edad12f441e3b3f0a8ea27da35c896bc8290e16b41fd15496a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db2-scala2.10","displayName":"Spark 2.0.2-db2 (Scala 2.10)","packageLabel":"spark-image-36d48f22cca7a907538e07df71847dd22aaf84a852c2eeea2dcefe24c681602f","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.x-ubuntu15.10-scala2.11","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.11, deprecated)","packageLabel":"spark-image-8e1c50d626a52eac5a6c8129e09ae206ba9890f4523775f77af4ad6d99a64c44","upgradable":true,"deprecated":true,"customerVisible":true},{"key":"2.0.x-scala2.10","displayName":"Spark 2.0 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-4f22a8d3016bc3dce9e839b10418815a7d28afff3a027b43bd2b041c42b2a89d","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db1-scala2.11","displayName":"Spark 2.0.2-db1 (Scala 2.11)","packageLabel":"spark-image-c2d623f03dd44097493c01aa54a941fc31978ebe6d759b36c75b716b2ff6ab9c","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.5.x-ubuntu15.10","displayName":"Spark 1.5.2 (Hadoop 1)","packageLabel":"spark-image-c9d2a8abf41f157a4acc6d52bc721090346f6fea2de356f3a66e388f54481698","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.x-scala2.11","displayName":"Spark 2.0 (Auto-updating, Scala 2.11)","packageLabel":"spark-image-596490ba3e0ca4b62abb048923fc70de84e319cf527bb7a5a8f609bbf780bed8","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db2-scala2.11","displayName":"Spark 2.0.2-db2 (Scala 2.11)","packageLabel":"spark-image-4fa852ba378e97815083b96c9cada7b962a513ec23554a5fc849f7f1dd8c065a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.3.x-ubuntu15.10","displayName":"Spark 1.3.0 (Hadoop 1)","packageLabel":"spark-image-40d2842670bc3dc178b14042501847d76171437ccf70613fa397a7a24c48b912","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.1-db1-scala2.11","displayName":"Spark 2.0.1-db1 (Scala 2.11)","packageLabel":"spark-image-10ab19f634bbfdb860446c326a9f76dc25bfa87de6403b980566279142a289ea","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.3-db1-hadoop1-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 1, Scala 2.10)","packageLabel":"spark-image-d50af1032799546b8ccbeeb76889a20c819ebc2a0e68ea20920cb30d3895d3ae","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db1-scala2.10","displayName":"Spark 2.0.2-db1 (Scala 2.10)","packageLabel":"spark-image-654bdd6e9bad70079491987d853b4b7abf3b736fff099701501acaabe0e75c41","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.x-ubuntu15.10","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.10, deprecated)","packageLabel":"spark-image-a659f3909d51b38d297b20532fc807ecf708cfb7440ce9b090c406ab0c1e4b7e","upgradable":true,"deprecated":true,"customerVisible":true},{"key":"2.0.1-db1-scala2.10","displayName":"Spark 2.0.1-db1 (Scala 2.10)","packageLabel":"spark-image-5a13c2db3091986a4e7363006cc185c5b1108c7761ef5d0218506cf2e6643840","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db1-scala2.10","displayName":"Spark 2.1.0 RC5 (Scala 2.10)","packageLabel":"spark-image-f430b652793cbc27e454dc629737ae2bc04b75a1fecd68a5d90c44eca7543756","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.0-ubuntu15.10","displayName":"Spark 1.6.0 (Hadoop 1)","packageLabel":"spark-image-10ef758029b8c7e19cd7f4fb52fff9180d75db92ca071bd94c47f3c1171a7cb5","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.x-ubuntu15.10-hadoop2","displayName":"Spark 1.6.x (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"2.0.0-ubuntu15.10-scala2.11","displayName":"Spark 2.0.0 (Scala 2.11)","packageLabel":"spark-image-b4ec141e751f201399f8358a82efee202560f7ed05e1a04a2ae8778f6324b909","upgradable":true,"deprecated":false,"customerVisible":true}],"enableRestrictedClusterCreation":false,"enableFeedback":true,"enableClusterAutoScaling":true,"enableUserVisibleDefaultTags":false,"defaultNumWorkers":8,"serverContinuationTimeoutMillis":10000,"driverStderrFilePrefix":"stderr","enableNotebookRefresh":true,"accountsOwnerUrl":"https://accounts.cloud.databricks.com/registration.html#login","driverStdoutFilePrefix":"stdout","defaultNodeTypeToPricingUnitsMap":{"r3.2xlarge":2,"class-node":1,"p2.8xlarge":16,"r3.8xlarge":8,"dev-tier-node":1,"c3.8xlarge":4,"r3.4xlarge":4,"i2.4xlarge":6,"development-node":1,"i2.2xlarge":3,"g2.8xlarge":6,"memory-optimized":1,"p2.16xlarge":24,"c3.2xlarge":1,"c4.2xlarge":1,"i2.xlarge":1.5,"compute-optimized":1,"c4.4xlarge":2,"c3.4xlarge":2,"g2.2xlarge":1.5,"p2.xlarge":2,"c4.8xlarge":4,"r3.xlarge":1,"i2.8xlarge":12},"enableSparkDocsSearch":true,"sparkHistoryServerEnabled":true,"enableEBSVolumesUI":true,"sanitizeMarkdownHtml":true,"enableIPythonImportExport":true,"enableClusterTagsUIForJobs":false,"enableClusterTagsUI":false,"enableNotebookHistoryDiffing":true,"branch":"2.33.220","accountsLimit":-1,"enableX509Authentication":false,"enableNotebookGitBranching":true,"local":false,"enableClusterAutoScalingForJobs":false,"enableStrongPassword":false,"displayDefaultContainerMemoryGB":30,"disableS3TableImport":false,"deploymentMode":"production","useSpotForWorkers":true,"enableUserInviteWorkflow":true,"enableStaticNotebooks":true,"enableCssTransitions":true,"minClusterTagKeyLength":1,"showHomepageFeaturedLinks":true,"pricingURL":"https://databricks.com/product/pricing","enableClusterAclsConfig":true,"useTempS3UrlForTableUpload":false,"notifyLastLogin":false,"enableNotebookGitVersioning":true,"files":"files/","feedbackEmail":"support@databricks.com","enableDriverLogsUI":true,"disableLegacyDashboards":false,"enableWorkspaceAclsConfig":true,"dropzoneMaxFileSize":4096,"enableNewClustersList":false,"enableNewDashboardViews":true,"driverLog4jFilePrefix":"log4j","enableSingleSignOn":true,"enableMavenLibraries":true,"displayRowLimit":1000,"deltaProcessingAsyncEnabled":true,"defaultSparkVersion":{"key":"2.0.x-scala2.10","displayName":"Spark 2.0 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-4f22a8d3016bc3dce9e839b10418815a7d28afff3a027b43bd2b041c42b2a89d","upgradable":true,"deprecated":false,"customerVisible":true},"enableCustomSpotPricing":true,"enableMountAclsConfig":false,"useDevTierHomePage":false,"enablePublishHub":false,"notebookHubUrl":"http://hub.dev.databricks.com/","showSqlEndpoints":true,"enableClusterAclsByTier":true,"databricksDocsBaseUrl":"https://docs.databricks.com/","disallowAddingAdmins":false,"enableSparkConfUI":true,"featureTier":"UNKNOWN_TIER","enableOrgSwitcherUI":false,"clustersLimit":-1,"enableJdbcImport":true,"logfiles":"logfiles/","enableWebappSharding":false,"enableClusterDeltaUpdates":true,"enableSingleSignOnLogin":false,"ebsVolumeSizeLimitGB":{"GENERAL_PURPOSE_SSD":[100,4096],"THROUGHPUT_OPTIMIZED_HDD":[500,4096]},"enableMountAcls":false,"requireEmailUserName":true,"enableDashboardViews":false,"dbcFeedbackURL":"http://feedback.databricks.com/forums/263785-product-feedback","enableMountAclService":true,"enableWorkspaceAcls":true,"maxClusterTagKeyLength":127,"gitHash":"8719902676c4e1cefbc31755c1726979bdf286d0","showWorkspaceFeaturedLinks":true,"signupUrl":"https://databricks.com/try-databricks","allowFeedbackForumAccess":true,"enableImportFromUrl":true,"enableMiniClusters":false,"enableDebugUI":false,"allowNonAdminUsers":true,"enableSingleSignOnByTier":true,"enableJobsRetryOnTimeout":true,"staticNotebookResourceUrl":"https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/","enableSparkPackages":true,"dynamicSparkVersions":true,"enableNotebookHistoryUI":true,"showDebugCounters":false,"enableInstanceProfilesUI":true,"enableFolderHtmlExport":true,"enableSparkVersionsUI":true,"homepageFeaturedLinks":[{"linkURI":"https://docs.databricks.com/_static/notebooks/gentle-introduction-to-apache-spark.html","displayName":"Introduction to Apache Spark on Databricks","icon":"img/home/Python_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/databricks-for-data-scientists.html","displayName":"Databricks for Data Scientists","icon":"img/home/Scala_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/structured-streaming-python.html","displayName":"Introduction to Structured Streaming","icon":"img/home/Python_icon.svg"}],"upgradeURL":"","notebookLoadingBackground":"#fff","sshContainerForwardedPort":2200,"enableServerAutoComplete":true,"enableStaticHtmlImport":true,"enableInstanceProfilesByTier":true,"enableTerminal":false,"defaultMemoryPerContainerMB":28000,"enablePresenceUI":true,"accounts":true,"useFramedStaticNotebooks":false,"enableNewProgressReportUI":true,"defaultCoresPerContainer":4,"enableNewClustersGet":false,"showSqlProxyUI":true};</script>
<script>var __DATABRICKS_NOTEBOOK_MODEL = {"version":"NotebookV1","origId":308,"name":"jlitven@gmail.com / recommender_test","language":"python","commands":[{"version":"CommandV1","origId":310,"guid":"9e6a25b0-d2df-4961-8388-56644ba21012","subtype":"command","commandType":"auto","position":0.125,"command":"%md # Recommendation Test\nRun PySpark's recommendation algorithm on test ratings","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"01a251c8-4a37-4142-9d5e-bc22bb8b4fcd"},{"version":"CommandV1","origId":311,"guid":"8d7c5349-abb4-4b5d-b47b-bc866208ead5","subtype":"command","commandType":"auto","position":0.25,"command":"# Run this cell to setup data path\nimport os\nfrom pyspark.mllib.recommendation import ALS, MatrixFactorizationModel, Rating\n\ndatapath = os.getcwd()\nif datapath.find('databricks') != -1:\n  ACCESS_KEY =   \"AKIAIUOEPA4PZ2RIARXA\"\n  SECRET_KEY = \"vkVXcbOTaWx7k4HnrvaeWblnbZkedeYEX5DVtNN+\"\n  AWS_BUCKET_NAME = \"dummyvarsmillionsong\"\n  datapath = \"s3a://%s:%s@%s/\" %(ACCESS_KEY, SECRET_KEY, AWS_BUCKET_NAME)\n\n# Load and parse ratings\ntripletsRDD = sc.textFile('processed_data/ratings_full.txt')\nratings = tripletsRDD.map(lambda l: l.split(','))\\\n    .map(lambda l: Rating(int(l[0]), int(l[1]), float(l[2])))\n  \n# Load and parse hidden ratings\ntriplets_hidden_RDD = sc.textFile('processed_data/ratings_hidden.txt')\nratings_hidden = triplets_hidden_RDD.map(lambda l: l.split(','))\\\n    .map(lambda l: Rating(int(l[0]), int(l[1]), float(l[2])))\n\n# Sanity check\nprint \"number of ratings\", ratings.count()\nprint \"number of hidden ratings\", ratings_hidden.count()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">number of ratings 48373586\nnumber of hidden ratings 135938\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1.481598594552E12,"submitTime":1.481598598401E12,"finishTime":1.481598609711E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"60a09b43-704c-4ee3-94d8-c9e8d34c895b"},{"version":"CommandV1","origId":312,"guid":"cc947d3b-367a-4bf7-ba73-c135f24c62db","subtype":"command","commandType":"auto","position":1.0,"command":"# Explicit Recommendation\n\n# First convert ratings to binary\nratings_normalized = ratings.map(lambda x: Rating(x[0], x[1], x[2]/x[2]))\n\n# Sanity check\nprint ratings.take(5)\n\n# Build the recommendation model using Alternating Least Squares\nrank = 50\nnumIterations = 5\nmodel = ALS.train(ratings_normalized, rank, numIterations)\n\n# Evaluate the model on training data\ntestdata = ratings.map(lambda p: (p[0], p[1]))\npredictions = model.predictAll(testdata).map(lambda r: ((r[0], r[1]), r[2]))\nratesAndPreds = ratings.map(lambda r: ((r[0], r[1]), r[2])).join(predictions)\nMSE = ratesAndPreds.map(lambda r: (r[1][0] - r[1][1])**2).mean()\nprint(\"Mean Squared Error = \" + str(MSE))\n\n# Save and load model\n# model.save(sc, \"target/tmp/myCollaborativeFilter\")\n# sameModel = MatrixFactorizationModel.load(sc, \"target/tmp/myCollaborativeFilter\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">[Rating(user=719122, product=11757, rating=1.0), Rating(user=719122, product=45991, rating=1.0), Rating(user=719122, product=142745, rating=1.0), Rating(user=719122, product=190995, rating=1.0), Rating(user=719122, product=224645, rating=1.0)]\nMean Squared Error = 45.2851337825\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 64310.0 failed 4 times, most recent failure: Lost task 0.3 in stage 64310.0 (TID 191269, 10.172.225.95): org.apache.spark.api.python.PythonException: Traceback (most recent call last):","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">Py4JJavaError</span>                             Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-108-ca8e430f63df&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      5</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      6</span> <span class=\"ansired\"># Sanity check</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 7</span><span class=\"ansiyellow\"> </span><span class=\"ansigreen\">print</span> ratings<span class=\"ansiyellow\">.</span>take<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">5</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      8</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      9</span> <span class=\"ansired\"># Build the recommendation model using Alternating Least Squares</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/rdd.py</span> in <span class=\"ansicyan\">take</span><span class=\"ansiblue\">(self, num)</span>\n<span class=\"ansigreen\">   1308</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1309</span>             p <span class=\"ansiyellow\">=</span> range<span class=\"ansiyellow\">(</span>partsScanned<span class=\"ansiyellow\">,</span> min<span class=\"ansiyellow\">(</span>partsScanned <span class=\"ansiyellow\">+</span> numPartsToTry<span class=\"ansiyellow\">,</span> totalParts<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">-&gt; 1310</span><span class=\"ansiyellow\">             </span>res <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>context<span class=\"ansiyellow\">.</span>runJob<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">,</span> takeUpToNumLeft<span class=\"ansiyellow\">,</span> p<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1311</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1312</span>             items <span class=\"ansiyellow\">+=</span> res<span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/context.py</span> in <span class=\"ansicyan\">runJob</span><span class=\"ansiblue\">(self, rdd, partitionFunc, partitions, allowLocal)</span>\n<span class=\"ansigreen\">    931</span>         <span class=\"ansired\"># SparkContext#runJob.</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    932</span>         mappedRDD <span class=\"ansiyellow\">=</span> rdd<span class=\"ansiyellow\">.</span>mapPartitions<span class=\"ansiyellow\">(</span>partitionFunc<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 933</span><span class=\"ansiyellow\">         </span>port <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>_jvm<span class=\"ansiyellow\">.</span>PythonRDD<span class=\"ansiyellow\">.</span>runJob<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">.</span>_jsc<span class=\"ansiyellow\">.</span>sc<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> mappedRDD<span class=\"ansiyellow\">.</span>_jrdd<span class=\"ansiyellow\">,</span> partitions<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    934</span>         <span class=\"ansigreen\">return</span> list<span class=\"ansiyellow\">(</span>_load_from_socket<span class=\"ansiyellow\">(</span>port<span class=\"ansiyellow\">,</span> mappedRDD<span class=\"ansiyellow\">.</span>_jrdd_deserializer<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    935</span> <span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.3-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">   1131</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1132</span>         return_value = get_return_value(\n<span class=\"ansigreen\">-&gt; 1133</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">   1134</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1135</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.py</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     61</span>     <span class=\"ansigreen\">def</span> deco<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">*</span>a<span class=\"ansiyellow\">,</span> <span class=\"ansiyellow\">**</span>kw<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     62</span>         <span class=\"ansigreen\">try</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 63</span><span class=\"ansiyellow\">             </span><span class=\"ansigreen\">return</span> f<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">*</span>a<span class=\"ansiyellow\">,</span> <span class=\"ansiyellow\">**</span>kw<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     64</span>         <span class=\"ansigreen\">except</span> py4j<span class=\"ansiyellow\">.</span>protocol<span class=\"ansiyellow\">.</span>Py4JJavaError <span class=\"ansigreen\">as</span> e<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     65</span>             s <span class=\"ansiyellow\">=</span> e<span class=\"ansiyellow\">.</span>java_exception<span class=\"ansiyellow\">.</span>toString<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.3-src.zip/py4j/protocol.py</span> in <span class=\"ansicyan\">get_return_value</span><span class=\"ansiblue\">(answer, gateway_client, target_id, name)</span>\n<span class=\"ansigreen\">    317</span>                 raise Py4JJavaError(\n<span class=\"ansigreen\">    318</span>                     <span class=\"ansiblue\">&quot;An error occurred while calling {0}{1}{2}.\\n&quot;</span><span class=\"ansiyellow\">.</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 319</span><span class=\"ansiyellow\">                     format(target_id, &quot;.&quot;, name), value)\n</span><span class=\"ansigreen\">    320</span>             <span class=\"ansigreen\">else</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    321</span>                 raise Py4JError(\n\n<span class=\"ansired\">Py4JJavaError</span>: An error occurred while calling z:org.apache.spark.api.python.PythonRDD.runJob.\n: org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 64310.0 failed 4 times, most recent failure: Lost task 0.3 in stage 64310.0 (TID 191269, 10.172.225.95): org.apache.spark.api.python.PythonException: Traceback (most recent call last):\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 172, in main\n    process()\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 167, in process\n    serializer.dump_stream(func(split_index, iterator), outfile)\n  File &quot;/databricks/spark/python/pyspark/serializers.py&quot;, line 263, in dump_stream\n    vs = list(itertools.islice(iterator, batch))\n  File &quot;/databricks/spark/python/pyspark/rdd.py&quot;, line 1306, in takeUpToNumLeft\n    yield next(iterator)\n  File &quot;&lt;ipython-input-106-852ac1d4f71a&gt;&quot;, line 4, in &lt;lambda&gt;\nTypeError: __new__() takes exactly 4 arguments (2 given)\n\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.read(PythonRDD.scala:193)\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.&lt;init&gt;(PythonRDD.scala:234)\n\tat org.apache.spark.api.python.PythonRunner.compute(PythonRDD.scala:152)\n\tat org.apache.spark.api.python.PythonRDD.compute(PythonRDD.scala:63)\n\tat org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:319)\n\tat org.apache.spark.rdd.RDD.iterator(RDD.scala:283)\n\tat org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:70)\n\tat org.apache.spark.scheduler.Task.run(Task.scala:86)\n\tat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:274)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\nDriver stacktrace:\n\tat org.apache.spark.scheduler.DAGScheduler.org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages(DAGScheduler.scala:1454)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1442)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1441)\n\tat scala.collection.mutable.ResizableArray$class.foreach(ResizableArray.scala:59)\n\tat scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:47)\n\tat org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:1441)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:811)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:811)\n\tat scala.Option.foreach(Option.scala:236)\n\tat org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:811)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:1667)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1622)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1611)\n\tat org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:48)\n\tat org.apache.spark.scheduler.DAGScheduler.runJob(DAGScheduler.scala:632)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:1891)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:1904)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:1917)\n\tat org.apache.spark.api.python.PythonRDD$.runJob(PythonRDD.scala:441)\n\tat org.apache.spark.api.python.PythonRDD.runJob(PythonRDD.scala)\n\tat sun.reflect.GeneratedMethodAccessor145.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:237)\n\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)\n\tat py4j.Gateway.invoke(Gateway.java:280)\n\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\n\tat py4j.commands.CallCommand.execute(CallCommand.java:79)\n\tat py4j.GatewayConnection.run(GatewayConnection.java:214)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: org.apache.spark.api.python.PythonException: Traceback (most recent call last):\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 172, in main\n    process()\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 167, in process\n    serializer.dump_stream(func(split_index, iterator), outfile)\n  File &quot;/databricks/spark/python/pyspark/serializers.py&quot;, line 263, in dump_stream\n    vs = list(itertools.islice(iterator, batch))\n  File &quot;/databricks/spark/python/pyspark/rdd.py&quot;, line 1306, in takeUpToNumLeft\n    yield next(iterator)\n  File &quot;&lt;ipython-input-106-852ac1d4f71a&gt;&quot;, line 4, in &lt;lambda&gt;\nTypeError: __new__() takes exactly 4 arguments (2 given)\n\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.read(PythonRDD.scala:193)\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.&lt;init&gt;(PythonRDD.scala:234)\n\tat org.apache.spark.api.python.PythonRunner.compute(PythonRDD.scala:152)\n\tat org.apache.spark.api.python.PythonRDD.compute(PythonRDD.scala:63)\n\tat org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:319)\n\tat org.apache.spark.rdd.RDD.iterator(RDD.scala:283)\n\tat org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:70)\n\tat org.apache.spark.scheduler.Task.run(Task.scala:86)\n\tat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:274)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\t... 1 more\n\n</div>","workflows":[],"startTime":1.481427954749E12,"submitTime":1.48142795115E12,"finishTime":1.481428343179E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"634b17bc-2cfc-41b5-aa5d-f978906d49ca"},{"version":"CommandV1","origId":313,"guid":"61b5a387-c59d-46fe-8b5a-801a80e1b947","subtype":"command","commandType":"auto","position":2.0,"command":"# Implicit Recommendation\n\n# Build the recommendation model using Alternating Least Squares\nmodel = ALS.trainImplicit(ratings, rank = 10, iterations = 10, alpha = 40.0, lambda_ = 1.0)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">TypeError</span>: trainImplicit() got an unexpected keyword argument &apos;numIterations&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">TypeError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-230-7a07d0de0b98&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      2</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      3</span> <span class=\"ansired\"># Build the recommendation model using Alternating Least Squares</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 4</span><span class=\"ansiyellow\"> </span>model <span class=\"ansiyellow\">=</span> ALS<span class=\"ansiyellow\">.</span>trainImplicit<span class=\"ansiyellow\">(</span>ratings<span class=\"ansiyellow\">,</span> rank <span class=\"ansiyellow\">=</span> <span class=\"ansicyan\">50</span><span class=\"ansiyellow\">,</span> numIterations <span class=\"ansiyellow\">=</span> <span class=\"ansicyan\">10</span><span class=\"ansiyellow\">,</span> alpha <span class=\"ansiyellow\">=</span> <span class=\"ansicyan\">40.0</span><span class=\"ansiyellow\">,</span> lambda_ <span class=\"ansiyellow\">=</span> <span class=\"ansicyan\">1.0</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">TypeError</span>: trainImplicit() got an unexpected keyword argument &apos;numIterations&apos;\n</div>","workflows":[],"startTime":1.481582171329E12,"submitTime":1.481582174656E12,"finishTime":1.481582180592E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"385abf53-4d8b-4401-9e93-f0fa227da100"},{"version":"CommandV1","origId":670,"guid":"de306c61-110a-4504-ab7e-ffb7ba569912","subtype":"command","commandType":"auto","position":2.125,"command":"# Implicit Recommendation with log\n# See paper for details: Collaborative Filtering for Implicit Feedback Datasets\nimport math\n\n# Build the recommendation model using Alternating Least Squares\nepsilon = 1e-8\nratings_log = ratings.map(lambda x: Rating(x[0], x[1], math.log(1 + (x[2]/epsilon))))\nmodel = ALS.trainImplicit(ratings_log, rank = 50, iterations = 10, alpha = 40.0, lambda_ = 1.0)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1.481427165551E12,"submitTime":1.481427162008E12,"finishTime":1.481427450632E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c3f7d2f9-e9a8-426d-b4f0-8c716989db3a"},{"version":"CommandV1","origId":572,"guid":"c54d8181-5db3-4bf1-beec-b30f0eb5c9d3","subtype":"command","commandType":"auto","position":2.25,"command":"# Evaluate the model on a random subset of users\n\n# Get a random sample of users\nnum_users = 100\nusers = ratings.map(lambda x: x.user).distinct().takeSample(False, num_users, seed=100)\n\n# Get the unique products\nproducts = ratings.map(lambda x: x.product).distinct()\n\n# Create the cartesian product of products and users to predict\nuser_product_pairs = sc.parallelize(users).cartesian(products)\n\n# Get predictions for each user\npredictions = model.predictAll(user_product_pairs)\npredictions_keys = predictions.map(lambda x: (x[0], (x[1], x[2])))\npredictions_by_user = predictions_keys.groupByKey().map(lambda x : (x[0], [z[0] for z in sorted(list(x[1]), key=lambda y: y[1], reverse=True)]))\n\n# Get ground truth for each user\nground_truth = ratings.filter(lambda x: x[0] in users)\nground_truth_keys = ground_truth.map(lambda x: (x[0], (x[1])))\nground_truth_by_user = ground_truth_keys.groupByKey().map(lambda x : (x[0], list(x[1])))\n\n# Join predictions and ground truth by user keys\npredictions_and_labels = predictions_by_user.join(ground_truth_by_user).map(lambda x: x[1])\n\n# Get mAP\nfrom pyspark.mllib.evaluation import RankingMetrics\nmetrics = RankingMetrics(predictions_and_labels)\nprint \"mAP:\", metrics.meanAveragePrecision\nprint \"mean precision at 1:\", metrics.precisionAt(1)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">mAP: 0.0472036765037\nmean precision at 1: 0.12\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> invalid syntax","error":"<div class=\"ansiout\"><span class=\"ansicyan\">  File </span><span class=\"ansigreen\">&quot;&lt;ipython-input-276-7854b8b66a46&gt;&quot;</span><span class=\"ansicyan\">, line </span><span class=\"ansigreen\">19</span>\n<span class=\"ansiyellow\">    predictions_by_user = predictions_keys.groupByKey().map(lambda x : (x[0], [z[0] for z in sorted(list(x[1]), key=lambda y: y[1], reverse=True))])</span>\n<span class=\"ansigrey\">                                                                                                                                                 ^</span>\n<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> invalid syntax\n\n</div>","workflows":[],"startTime":1.481582184893E12,"submitTime":1.481582188232E12,"finishTime":1.481582210316E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6314029a-97e0-4ca6-adbc-27782c5497c6"},{"version":"CommandV1","origId":575,"guid":"5145b596-5ec3-462c-9d36-07b0631bf8e3","subtype":"command","commandType":"auto","position":2.3125,"command":"# Evaluate the model on hidden users\n\n# Subset for faster testing\nnum_users = 1000\nhidden_users = ratings_hidden.map(lambda x: x.user).distinct().take(num_users)\n\n# Get the unique products\nproducts = ratings.map(lambda x: x.product).distinct()\n\n# Create the cartesian product of products and users to predict\nuser_product_pairs = sc.parallelize(hidden_users).cartesian(products)\n\n# Remove pairs that are in the user's listening history\nuser_history = ratings.filter(lambda x: x[0] in hidden_users).map(lambda x: ((x[0], x[1]), 1)) # dummy values\nall_pairs = user_product_pairs.map(lambda x: ((x[0], x[1]), 1)) # dummy variables\nnew_products = all_pairs.leftOuterJoin(user_history).filter(lambda x: not x[1][1]).map(lambda x: x[0])\n\n# Choose top recommendations\nn_recs = 500\npredictions_by_user = model.recommendProductsForUsers(n_recs).filter(lambda x: x[0] in hidden_users).map(lambda x: (x[0], [r.product for r in x[1]]))\n#predictions = model.predictAll(new_products).filter(lambda x: x[2] > 0.5)\n#predictions_keys = predictions.map(lambda x: (x[0], (x[1], x[2])))\n#predictions_by_user = predictions_keys.groupByKey().map(lambda x : (x[0], [z[0] for z in sorted(list(x[1]), key=lambda y: y[1], reverse=True)]))\n\n# Get ground truth for each user\nground_truth = ratings_hidden.filter(lambda x: x.user in hidden_users)\nground_truth_keys = ground_truth.map(lambda x: (x[0], (x[1])))\nground_truth_by_user = ground_truth_keys.groupByKey().map(lambda x : (x[0], list(x[1])))\n\n# Join predictions and ground truth by user keys\npredictions_and_labels = predictions_by_user.join(ground_truth_by_user).map(lambda x: x[1])\n\n# Get mAP\nfrom pyspark.mllib.evaluation import RankingMetrics\nmetrics = RankingMetrics(predictions_and_labels)\nprint \"mAP:\", metrics.meanAveragePrecision\nprint \"mean precision at 1:\", metrics.precisionAt(1)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">mAP: 0.0210774099977\nmean precision at 1: 0.046\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;rulatings_hidden&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-8-5d28dece14bf&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">     23</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     24</span> <span class=\"ansired\"># Get ground truth for each user</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 25</span><span class=\"ansiyellow\"> </span>ground_truth <span class=\"ansiyellow\">=</span> rulatings_hidden<span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     26</span> ground_truth_keys <span class=\"ansiyellow\">=</span> ground_truth<span class=\"ansiyellow\">.</span>map<span class=\"ansiyellow\">(</span><span class=\"ansigreen\">lambda</span> x<span class=\"ansiyellow\">:</span> <span class=\"ansiyellow\">(</span>x<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">0</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> <span class=\"ansiyellow\">(</span>x<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     27</span> ground_truth_by_user <span class=\"ansiyellow\">=</span> ground_truth_keys<span class=\"ansiyellow\">.</span>groupByKey<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>map<span class=\"ansiyellow\">(</span><span class=\"ansigreen\">lambda</span> x <span class=\"ansiyellow\">:</span> <span class=\"ansiyellow\">(</span>x<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">0</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> list<span class=\"ansiyellow\">(</span>x<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;rulatings_hidden&apos; is not defined\n</div>","workflows":[],"startTime":1.481510027349E12,"submitTime":1.481510028396E12,"finishTime":1.481510169514E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0a448297-b204-4754-973d-1c56467c95ee"},{"version":"CommandV1","origId":680,"guid":"73619c02-b425-473d-bc89-71ea4405558b","subtype":"command","commandType":"auto","position":4.15625,"command":"print ratings.map(lambda x: x.user).distinct().count()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">10000\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">TypeError</span>: count() takes exactly one argument (0 given)","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">TypeError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-4-c60721007236&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span><span class=\"ansigreen\">print</span> hidden_users<span class=\"ansiyellow\">.</span>count<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">TypeError</span>: count() takes exactly one argument (0 given)\n</div>","workflows":[],"startTime":1.481510243616E12,"submitTime":1.481510244647E12,"finishTime":1.481510245125E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"345708ee-b19b-4190-815e-6829a65d7604"},{"version":"CommandV1","origId":655,"guid":"223e76f4-1f69-4bb5-b338-bfb80a65f851","subtype":"command","commandType":"auto","position":6.0,"command":"# Compare with popularity method\n\n# Subset for faster testing\nnum_users = 100\nhidden_users = ratings_hidden.map(lambda x: x.user).distinct().take(num_users)\nratings_hidden = ratings_hidden.filter(lambda x: x.user in hidden_users)\n\n# Get the unique products\nproducts = ratings.map(lambda x: x.product).distinct()\n\n# Get songs by popularity\nnum_songs = 500\nsongs_by_popularity = ratings\\\n  .map(lambda x: (x[1], 1))\\\n  .reduceByKey(lambda a, b: a + b)\\\n  .sortBy(lambda x: x[1], ascending=False)\\\n  .map(lambda x: x[0])\\\n  .take(num_songs) # take top n popular\n\n# Create recommendations for each user\npredictions_by_user = sc.parallelize(hidden_users).map(lambda x: (x, songs_by_popularity))\n\n# Remove songs already in user history\nhistory_by_user = ratings.filter(lambda x: x[0] in hidden_users).map(lambda x: (x[0], x[1])).groupByKey().map(lambda x : (x[0], list(x[1])))\npredictions_and_history = predictions_by_user.join(history_by_user)\npredictions_by_user = predictions_and_history.map(lambda x: (x[0], [s for s in x[1][0] if s not in x[1][1]]))\n\n# Get ground truth for each user\nground_truth = ratings_hidden\nground_truth_keys = ground_truth.map(lambda x: (x[0], (x[1])))\nground_truth_by_user = ground_truth_keys.groupByKey().map(lambda x : (x[0], list(x[1])))\n\n# Join predictions and ground truth by user keys\npredictions_and_labels = predictions_by_user.join(ground_truth_by_user).map(lambda x: x[1])\n\n# Get mAP\nfrom pyspark.mllib.evaluation import RankingMetrics\nmetrics = RankingMetrics(predictions_and_labels)\nprint \"mAP:\", metrics.meanAveragePrecision\nprint \"mean precision at 1:\", metrics.precisionAt(1)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">mAP: 0.0224304629697\nmean precision at 1: 0.08\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> unexpected character after line continuation character","error":"<div class=\"ansiout\"><span class=\"ansicyan\">  File </span><span class=\"ansigreen\">&quot;&lt;ipython-input-310-5ac57dc9d926&gt;&quot;</span><span class=\"ansicyan\">, line </span><span class=\"ansigreen\">13</span>\n<span class=\"ansiyellow\">    songs_by_popularity = ratings  .map(lambda x: (x[1], 1))  .reduceByKey(lambda a, b: a + b)\\ # count number of listens for each song</span>\n<span class=\"ansigrey\">                                                                                                                                       ^</span>\n<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> unexpected character after line continuation character\n\n</div>","workflows":[],"startTime":1.481425803963E12,"submitTime":1.481425800451E12,"finishTime":1.481425878913E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"50508537-6442-4261-917d-e169fe06da4c"},{"version":"CommandV1","origId":749,"guid":"a706ded7-6ce9-41bf-816e-457ffe3cb408","subtype":"command","commandType":"auto","position":13.0,"command":"# Perform leave-one-out cross-validation to get a score for the model\nfrom numpy import random\nfrom operator import add\nfrom __future__ import division\n\n# Parameters\nrank = 50\niterations = 10\nalpha = 40.0\nlambda_ = 1.0\nN_recommendations = 500\n\n# For reproducibility\nrandom.seed(10)\n\n# Get full listening history by user\nhistory_by_user = ratings\\\n  .map(lambda x: (x[0], (x[1], x[2])))\\\n  .groupByKey().map(lambda x: (x[0], list(x[1])))\n\n# Randomly remove one to create train test split\ndef leave_one_out(items):\n  item = items[random.randint(0, len(items))]\n  items.remove(item)\n  return (items, item)\n\ntrain_test_split = history_by_user\\\n  .map(lambda x: (x[0], leave_one_out(x[1])))\n  \ntrain = train_test_split\\\n  .map(lambda x: (x[0], x[1][0]))\\\n  .flatMapValues(lambda x: x).map(lambda x: Rating(x[0], x[1][0], x[1][1]))\n  \ntest = train_test_split\\\n  .map(lambda x: (x[0], x[1][1])).map(lambda x: Rating(x[0], x[1][0], x[1][1]))\n\n# Train model\nmodel = ALS.trainImplicit(train, rank = rank, iterations = iterations, alpha = alpha, lambda_ = lambda_)\n\n# Get top N recommendations\npredictions_by_user = model.recommendProductsForUsers(N_recommendations).map(lambda x: (x[0], [r.product for r in x[1]]))\n\n\n# Calculate proportion the test set appears in recommendations\ntest_and_predictions = test.join(predictions_by_user)\ntest_in_predictions = test_and_predictions.map(lambda x: int(x[1][0] in x[1][1]))\nscore = test_in_predictions.reduce(add) / test_in_predictions.count()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">TypeError</span>: flatMapValues() takes exactly 2 arguments (1 given)","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">TypeError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-52-ba7818abe349&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">     16</span> train_test_split <span class=\"ansiyellow\">=</span> history_by_user  <span class=\"ansiyellow\">.</span>map<span class=\"ansiyellow\">(</span><span class=\"ansigreen\">lambda</span> x<span class=\"ansiyellow\">:</span> <span class=\"ansiyellow\">(</span>x<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">0</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> leave_one_out<span class=\"ansiyellow\">(</span>x<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     17</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 18</span><span class=\"ansiyellow\"> </span>train <span class=\"ansiyellow\">=</span> train_test_split  <span class=\"ansiyellow\">.</span>map<span class=\"ansiyellow\">(</span><span class=\"ansigreen\">lambda</span> x<span class=\"ansiyellow\">:</span> <span class=\"ansiyellow\">(</span>x<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">0</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> x<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">0</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span>  <span class=\"ansiyellow\">.</span>flatMapValues<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     19</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     20</span> <span class=\"ansired\"># Train model</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">TypeError</span>: flatMapValues() takes exactly 2 arguments (1 given)\n</div>","workflows":[],"startTime":1.481520377818E12,"submitTime":1.481520379195E12,"finishTime":1.48152051206E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e8049191-48b7-4518-bc01-a7a78a2a271e"},{"version":"CommandV1","origId":752,"guid":"97ae5584-2259-4a5f-a1a4-01660dc766f1","subtype":"command","commandType":"auto","position":14.0,"command":"print te","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">0.6333\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 45477.0 failed 4 times, most recent failure: Lost task 0.3 in stage 45477.0 (TID 122406, 10.172.252.87): org.apache.spark.api.python.PythonException: Traceback (most recent call last):","error":"<div class=\"ansiout\">[(18701160, ([(333178, 1.0), (172843, 1.0), (281695, 1.0), (346955, 1.0), (236601, 1.0)], (335548, 1.0)))]\n[(18701160, 333178, 1.0), (18701160, 172843, 1.0), (18701160, 281695, 1.0), (18701160, 346955, 1.0), (18701160, 236601, 1.0), (18837510, 164540, 2.0), (18837510, 341506, 8.0), (18837510, 218335, 10.0), (18837510, 251835, 4.0), (18837510, 198235, 3.0)]\n<span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">Py4JJavaError</span>                             Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-84-b1cd9205cd2a&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansigreen\">print</span> train_test_split<span class=\"ansiyellow\">.</span>take<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      2</span> <span class=\"ansigreen\">print</span> train<span class=\"ansiyellow\">.</span>take<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">10</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 3</span><span class=\"ansiyellow\"> </span><span class=\"ansigreen\">print</span> test<span class=\"ansiyellow\">.</span>take<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/rdd.pyc</span> in <span class=\"ansicyan\">take</span><span class=\"ansiblue\">(self, num)</span>\n<span class=\"ansigreen\">   1308</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1309</span>             p <span class=\"ansiyellow\">=</span> range<span class=\"ansiyellow\">(</span>partsScanned<span class=\"ansiyellow\">,</span> min<span class=\"ansiyellow\">(</span>partsScanned <span class=\"ansiyellow\">+</span> numPartsToTry<span class=\"ansiyellow\">,</span> totalParts<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">-&gt; 1310</span><span class=\"ansiyellow\">             </span>res <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>context<span class=\"ansiyellow\">.</span>runJob<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">,</span> takeUpToNumLeft<span class=\"ansiyellow\">,</span> p<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1311</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1312</span>             items <span class=\"ansiyellow\">+=</span> res<span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/context.pyc</span> in <span class=\"ansicyan\">runJob</span><span class=\"ansiblue\">(self, rdd, partitionFunc, partitions, allowLocal)</span>\n<span class=\"ansigreen\">    931</span>         <span class=\"ansired\"># SparkContext#runJob.</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    932</span>         mappedRDD <span class=\"ansiyellow\">=</span> rdd<span class=\"ansiyellow\">.</span>mapPartitions<span class=\"ansiyellow\">(</span>partitionFunc<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 933</span><span class=\"ansiyellow\">         </span>port <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>_jvm<span class=\"ansiyellow\">.</span>PythonRDD<span class=\"ansiyellow\">.</span>runJob<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">.</span>_jsc<span class=\"ansiyellow\">.</span>sc<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> mappedRDD<span class=\"ansiyellow\">.</span>_jrdd<span class=\"ansiyellow\">,</span> partitions<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    934</span>         <span class=\"ansigreen\">return</span> list<span class=\"ansiyellow\">(</span>_load_from_socket<span class=\"ansiyellow\">(</span>port<span class=\"ansiyellow\">,</span> mappedRDD<span class=\"ansiyellow\">.</span>_jrdd_deserializer<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    935</span> <span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.3-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">   1131</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1132</span>         return_value = get_return_value(\n<span class=\"ansigreen\">-&gt; 1133</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">   1134</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1135</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.pyc</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     61</span>     <span class=\"ansigreen\">def</span> deco<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">*</span>a<span class=\"ansiyellow\">,</span> <span class=\"ansiyellow\">**</span>kw<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     62</span>         <span class=\"ansigreen\">try</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 63</span><span class=\"ansiyellow\">             </span><span class=\"ansigreen\">return</span> f<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">*</span>a<span class=\"ansiyellow\">,</span> <span class=\"ansiyellow\">**</span>kw<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     64</span>         <span class=\"ansigreen\">except</span> py4j<span class=\"ansiyellow\">.</span>protocol<span class=\"ansiyellow\">.</span>Py4JJavaError <span class=\"ansigreen\">as</span> e<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     65</span>             s <span class=\"ansiyellow\">=</span> e<span class=\"ansiyellow\">.</span>java_exception<span class=\"ansiyellow\">.</span>toString<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.3-src.zip/py4j/protocol.py</span> in <span class=\"ansicyan\">get_return_value</span><span class=\"ansiblue\">(answer, gateway_client, target_id, name)</span>\n<span class=\"ansigreen\">    317</span>                 raise Py4JJavaError(\n<span class=\"ansigreen\">    318</span>                     <span class=\"ansiblue\">&quot;An error occurred while calling {0}{1}{2}.\\n&quot;</span><span class=\"ansiyellow\">.</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 319</span><span class=\"ansiyellow\">                     format(target_id, &quot;.&quot;, name), value)\n</span><span class=\"ansigreen\">    320</span>             <span class=\"ansigreen\">else</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    321</span>                 raise Py4JError(\n\n<span class=\"ansired\">Py4JJavaError</span>: An error occurred while calling z:org.apache.spark.api.python.PythonRDD.runJob.\n: org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 45477.0 failed 4 times, most recent failure: Lost task 0.3 in stage 45477.0 (TID 122406, 10.172.252.87): org.apache.spark.api.python.PythonException: Traceback (most recent call last):\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 172, in main\n    process()\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 167, in process\n    serializer.dump_stream(func(split_index, iterator), outfile)\n  File &quot;/databricks/spark/python/pyspark/serializers.py&quot;, line 263, in dump_stream\n    vs = list(itertools.islice(iterator, batch))\n  File &quot;/databricks/spark/python/pyspark/rdd.py&quot;, line 1306, in takeUpToNumLeft\n    yield next(iterator)\n  File &quot;&lt;ipython-input-83-58a36982689a&gt;&quot;, line 20, in &lt;lambda&gt;\nTypeError: &apos;int&apos; object has no attribute &apos;__getitem__&apos;\n\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.read(PythonRDD.scala:193)\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.&lt;init&gt;(PythonRDD.scala:234)\n\tat org.apache.spark.api.python.PythonRunner.compute(PythonRDD.scala:152)\n\tat org.apache.spark.api.python.PythonRDD.compute(PythonRDD.scala:63)\n\tat org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:319)\n\tat org.apache.spark.rdd.RDD.iterator(RDD.scala:283)\n\tat org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:70)\n\tat org.apache.spark.scheduler.Task.run(Task.scala:86)\n\tat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:274)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\nDriver stacktrace:\n\tat org.apache.spark.scheduler.DAGScheduler.org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages(DAGScheduler.scala:1454)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1442)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1441)\n\tat scala.collection.mutable.ResizableArray$class.foreach(ResizableArray.scala:59)\n\tat scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:47)\n\tat org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:1441)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:811)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:811)\n\tat scala.Option.foreach(Option.scala:236)\n\tat org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:811)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:1667)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1622)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1611)\n\tat org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:48)\n\tat org.apache.spark.scheduler.DAGScheduler.runJob(DAGScheduler.scala:632)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:1891)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:1904)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:1917)\n\tat org.apache.spark.api.python.PythonRDD$.runJob(PythonRDD.scala:441)\n\tat org.apache.spark.api.python.PythonRDD.runJob(PythonRDD.scala)\n\tat sun.reflect.GeneratedMethodAccessor136.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:237)\n\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)\n\tat py4j.Gateway.invoke(Gateway.java:280)\n\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\n\tat py4j.commands.CallCommand.execute(CallCommand.java:79)\n\tat py4j.GatewayConnection.run(GatewayConnection.java:214)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: org.apache.spark.api.python.PythonException: Traceback (most recent call last):\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 172, in main\n    process()\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 167, in process\n    serializer.dump_stream(func(split_index, iterator), outfile)\n  File &quot;/databricks/spark/python/pyspark/serializers.py&quot;, line 263, in dump_stream\n    vs = list(itertools.islice(iterator, batch))\n  File &quot;/databricks/spark/python/pyspark/rdd.py&quot;, line 1306, in takeUpToNumLeft\n    yield next(iterator)\n  File &quot;&lt;ipython-input-83-58a36982689a&gt;&quot;, line 20, in &lt;lambda&gt;\nTypeError: &apos;int&apos; object has no attribute &apos;__getitem__&apos;\n\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.read(PythonRDD.scala:193)\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.&lt;init&gt;(PythonRDD.scala:234)\n\tat org.apache.spark.api.python.PythonRunner.compute(PythonRDD.scala:152)\n\tat org.apache.spark.api.python.PythonRDD.compute(PythonRDD.scala:63)\n\tat org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:319)\n\tat org.apache.spark.rdd.RDD.iterator(RDD.scala:283)\n\tat org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:70)\n\tat org.apache.spark.scheduler.Task.run(Task.scala:86)\n\tat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:274)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\t... 1 more\n\n</div>","workflows":[],"startTime":1.481520512065E12,"submitTime":1.481520380032E12,"finishTime":1.481520512086E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4641dbd6-bf9e-43ed-af0d-8a936815c624"},{"version":"CommandV1","origId":757,"guid":"f7add50c-b3f6-47da-bd8b-8d4a2592d413","subtype":"command","commandType":"auto","position":18.0,"command":"# Perform K-fold cross-validation to get an mAP score for the model\nfrom numpy import random\nfrom operator import add\nfrom __future__ import division\nfrom sklearn.cross_validation import KFold\n\n# Parameters\nrank = 50\niterations = 5\nalpha = 40.0\nlambda_ = 1.0\nN_recommendations = 500\n\n# For reproducibility\nrandom.seed(0)\n\nn_folds = 5\nusers = ratings.map(lambda x: x.user).distinct().collect()\nkf = list(KFold(len(users), n_folds=n_folds, shuffle = True))\nfold_i = 1\n#def perform_cv(fold_i):\n# Perform cross-validation on ith fold\n\n# Get training test split of users\ntrain_indices, test_indices = kf[fold_i]\ntrain_users = sc.parallelize([users[i] for i in train_indices])\ntest_users = sc.parallelize([users[i] for i in test_indices])\n\n# Aggregate ratings by user\nratings_by_user = ratings.map(lambda x: (x[0], (x[1], x[2]))).groupByKey().map(lambda x : (x[0], list(x[1])))\n\n# Get train and test ratings\ntrain_by_users = ratings_by_user.join(train_users.map(lambda x: (x, 0))).map(lambda x: (x[0], x[1][0]))\ntrain = train_by_users\\\n  .flatMapValues(lambda x: x).map(lambda x: Rating(x[0], x[1][0], x[1][1]))\ntest_by_users = ratings_by_user.join(test_users.map(lambda x: (x, 0))).map(lambda x: (x[0], x[1][0]))\n\n# Randomly remove half of test user's items\ndef split(items):\n  first, second = list(KFold(len(items), n_folds = 2, shuffle = True))[0]\n  leave_in = [items[i] for i in first]\n  leave_out = [items[i] for i in second]\n  return (leave_in, leave_out)\n\ntest_by_users_split = test_by_users\\\n  .map(lambda x: (x[0], split(x[1])))\n\ntest_visible_by_users = test_by_users_split\\\n  .map(lambda x: (x[0], x[1][0]))\n\ntest_visible = test_visible_by_users\\\n  .flatMapValues(lambda x: x).map(lambda x: Rating(x[0], x[1][0], x[1][1]))\n\ntest_hidden_by_users = test_by_users_split\\\n  .map(lambda x: (x[0], [pair[0] for pair in x[1][1]]))\n\n# # Join training and visible test data\ntrain_and_test_visible = train.union(test_visible)\n\n# Train the model\nmodel = ALS.trainImplicit(train_and_test_visible, rank = rank, iterations = iterations, alpha = alpha, lambda_ = lambda_)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1.481598609799E12,"submitTime":1.481598613663E12,"finishTime":1.48159876647E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1df71daa-ac31-4940-a209-50a8e80856f9"},{"version":"CommandV1","origId":822,"guid":"a9b7fcc9-4215-4d05-b349-7bf669ace1a8","subtype":"command","commandType":"auto","position":22.375,"command":"# Get top N recommendations\n# This is slowwwwwwwwww\npredictions_by_user = model.recommendProductsForUsers(N_recommendations).map(lambda x: (x[0], [r.product for r in x[1]]))\nprint predictions_by_user.take(1)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">[(1222100, [245012, 149371, 183790, 309384, 50740, 359201, 11011, 242151, 107697, 40539, 223714, 45592, 65358, 243516, 385556, 343207, 87433, 198350, 192716, 161257, 380623, 189050, 285387, 90822, 99657, 281498, 320725, 221730, 16634, 364051, 225108, 182021, 4604, 115101, 1424, 47055, 369289, 107825, 147248, 243307, 175099, 37271, 126648, 180413, 370158, 26673, 203463, 335634, 73887, 154559, 136621, 304123, 150760, 350380, 16220, 331326, 28632, 25706, 311933, 373978, 165753, 134665, 295824, 205438, 242558, 241932, 348629, 222847, 354134, 371952, 236050, 176803, 346886, 118196, 289238, 54368, 74238, 42744, 6449, 326792, 151596, 362652, 57378, 319788, 105694, 273894, 154167, 345871, 306274, 195299, 100751, 70949, 289658, 317948, 49297, 343279, 816, 69523, 101230, 152870, 34948, 311262, 224799, 280887, 27505, 212675, 222991, 121643, 128490, 105213, 337702, 142269, 279154, 208943, 232635, 841, 99278, 172688, 138010, 74321, 297177, 98924, 231773, 116743, 175101, 18421, 321802, 207916, 68212, 357202, 283641, 97877, 239655, 199830, 247288, 384072, 365157, 345989, 259646, 200171, 243769, 247570, 272871, 218342, 208383, 139370, 350908, 301100, 130738, 134150, 48333, 9057, 339795, 177560, 152195, 159839, 34991, 54593, 266818, 340856, 208357, 101650, 51070, 234868, 69304, 76064, 63125, 83309, 49753, 383907, 280776, 54711, 334187, 101564, 143361, 69165, 220325, 383719, 186701, 318255, 276655, 288730, 117309, 287349, 312803, 143039, 380379, 259134, 201322, 129142, 5802, 164421, 82994, 315812, 405, 366072, 218440, 303600, 297671, 94044, 361070, 349681, 269264, 16381, 371549, 217720, 26364, 366864, 51953, 78838, 358837, 215861, 37248, 285257, 173150, 77390, 368930, 251101, 339307, 249193, 39531, 97978, 194481, 366296, 281689, 318282, 222159, 253868, 278925, 154820, 227294, 314526, 193206, 62696, 31706, 192751, 227452, 376874, 340072, 312416, 210999, 116396, 26366, 168417, 217161, 385600, 200864, 351104, 138136, 173732, 250314, 159424, 151440, 24236, 122591, 269229, 38941, 42474, 2059, 129826, 249081, 317786, 186669, 73317, 177746, 383918, 152976, 187555, 36681, 34706, 327563, 308457, 378635, 33956, 126568, 212172, 354323, 180805, 31927, 144511, 212037, 353035, 266702, 108011, 92976, 154250, 268965, 283164, 258100, 131864, 210627, 129772, 334460, 312664, 185042, 116596, 6883, 156966, 146340, 116185, 82595, 270478, 386004, 139434, 115589, 166545, 230581, 321863, 279846, 336078, 168787, 167339, 251603, 247587, 364179, 206465, 10208, 363073, 176468, 262356, 66060, 314048, 95044, 255453, 292884, 69487, 240823, 311300, 110042, 159581, 346089, 174906, 139282, 118874, 152753, 199300, 90453, 322843, 208409, 87138, 244172, 341674, 154498, 136775, 173469, 230468, 348088, 285274, 261411, 3432, 169841, 241526, 352005, 237366, 36015, 207935, 180858, 340797, 319783, 238130, 213170, 246564, 111771, 249538, 231556, 237619, 45142, 363825, 206945, 158075, 34025, 238410, 345764, 98091, 30990, 373042, 17916, 186684, 288923, 265543, 61051, 264130, 131791, 228801, 247213, 325561, 294764, 201054, 5310, 32353, 320206, 197647, 18050, 111142, 244143, 120857, 154482, 200739, 142745, 257435, 277014, 62185, 378274, 341456, 189433, 359810, 122501, 169740, 354593, 298054, 153861, 284625, 329226, 383485, 116183, 207792, 116818, 288955, 179295, 118459, 293373, 206101, 214440, 12554, 237883, 208780, 385211, 23210, 383957, 25289, 52585, 342005, 165921, 12144, 25568, 261596, 102844, 44362, 6368, 231618, 190327, 70479, 112078, 318390, 252575, 170834, 278649, 361026, 318106, 27676, 273435, 118116, 84395, 245128, 321260, 134402, 220273, 217681, 219197, 374994, 303856, 206179, 122127, 6977, 282507, 83380, 8822, 367757, 257863, 39401, 112750, 55218, 266356, 182522, 364673, 151751, 372926, 44406, 60719, 183682, 165649, 76564, 207699, 348832, 18927, 341173, 53566, 42717, 136472, 328469, 300196, 85724, 155628, 76038, 35349, 301669, 264549, 121402, 317290, 258281])]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1.481598448555E12,"submitTime":1.481598452416E12,"finishTime":1.48159849355E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8ecea473-5fde-4348-82bf-4feaad29648a"},{"version":"CommandV1","origId":818,"guid":"96e273ff-437c-455e-b50e-42467487cabd","subtype":"command","commandType":"auto","position":26.75,"command":"# Get the unique products\nproducts = ratings.map(lambda x: x.product).distinct()\n\n# HACK :Get a subset of test users to get recommendations\nnum_users = 100\ntest_users_subset = test_users.takeSample(False, num_users, seed=100)\n\n# Create the cartesian product of products and users to predict\nuser_product_pairs = sc.parallelize(test_users_subset).cartesian(products)\n\n# Choose top recommendations\npredictions = model.predictAll(user_product_pairs)\npredictions_keys = predictions.map(lambda x: (x[0], (x[1], x[2])))\npredictions_by_user = predictions_keys.groupByKey().map(lambda x : (x[0], [z[0] for z in sorted(list(x[1]), key=lambda y: y[1], reverse=True)]))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 7812.0 failed 4 times, most recent failure: Lost task 0.3 in stage 7812.0 (TID 818183, 10.172.246.109): org.apache.spark.api.python.PythonException: Traceback (most recent call last):","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">Py4JJavaError</span>                             Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-14-08e616b374fd&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      8</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      9</span> predictions_by_user <span class=\"ansiyellow\">=</span> sc<span class=\"ansiyellow\">.</span>parallelize<span class=\"ansiyellow\">(</span>tpool<span class=\"ansiyellow\">.</span>map<span class=\"ansiyellow\">(</span>recommend_products<span class=\"ansiyellow\">,</span> sample_users<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>map<span class=\"ansiyellow\">(</span><span class=\"ansigreen\">lambda</span> x<span class=\"ansiyellow\">:</span> <span class=\"ansiyellow\">(</span>x<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">0</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> <span class=\"ansiyellow\">[</span>r<span class=\"ansiyellow\">.</span>product <span class=\"ansigreen\">for</span> r <span class=\"ansigreen\">in</span> x<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 10</span><span class=\"ansiyellow\"> </span><span class=\"ansigreen\">print</span> predictions_by_user<span class=\"ansiyellow\">.</span>take<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/rdd.pyc</span> in <span class=\"ansicyan\">take</span><span class=\"ansiblue\">(self, num)</span>\n<span class=\"ansigreen\">   1308</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1309</span>             p <span class=\"ansiyellow\">=</span> range<span class=\"ansiyellow\">(</span>partsScanned<span class=\"ansiyellow\">,</span> min<span class=\"ansiyellow\">(</span>partsScanned <span class=\"ansiyellow\">+</span> numPartsToTry<span class=\"ansiyellow\">,</span> totalParts<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">-&gt; 1310</span><span class=\"ansiyellow\">             </span>res <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>context<span class=\"ansiyellow\">.</span>runJob<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">,</span> takeUpToNumLeft<span class=\"ansiyellow\">,</span> p<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1311</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1312</span>             items <span class=\"ansiyellow\">+=</span> res<span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/context.pyc</span> in <span class=\"ansicyan\">runJob</span><span class=\"ansiblue\">(self, rdd, partitionFunc, partitions, allowLocal)</span>\n<span class=\"ansigreen\">    931</span>         <span class=\"ansired\"># SparkContext#runJob.</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    932</span>         mappedRDD <span class=\"ansiyellow\">=</span> rdd<span class=\"ansiyellow\">.</span>mapPartitions<span class=\"ansiyellow\">(</span>partitionFunc<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 933</span><span class=\"ansiyellow\">         </span>port <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>_jvm<span class=\"ansiyellow\">.</span>PythonRDD<span class=\"ansiyellow\">.</span>runJob<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">.</span>_jsc<span class=\"ansiyellow\">.</span>sc<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> mappedRDD<span class=\"ansiyellow\">.</span>_jrdd<span class=\"ansiyellow\">,</span> partitions<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    934</span>         <span class=\"ansigreen\">return</span> list<span class=\"ansiyellow\">(</span>_load_from_socket<span class=\"ansiyellow\">(</span>port<span class=\"ansiyellow\">,</span> mappedRDD<span class=\"ansiyellow\">.</span>_jrdd_deserializer<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    935</span> <span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.3-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">   1131</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1132</span>         return_value = get_return_value(\n<span class=\"ansigreen\">-&gt; 1133</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">   1134</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1135</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.pyc</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     61</span>     <span class=\"ansigreen\">def</span> deco<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">*</span>a<span class=\"ansiyellow\">,</span> <span class=\"ansiyellow\">**</span>kw<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     62</span>         <span class=\"ansigreen\">try</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 63</span><span class=\"ansiyellow\">             </span><span class=\"ansigreen\">return</span> f<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">*</span>a<span class=\"ansiyellow\">,</span> <span class=\"ansiyellow\">**</span>kw<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     64</span>         <span class=\"ansigreen\">except</span> py4j<span class=\"ansiyellow\">.</span>protocol<span class=\"ansiyellow\">.</span>Py4JJavaError <span class=\"ansigreen\">as</span> e<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     65</span>             s <span class=\"ansiyellow\">=</span> e<span class=\"ansiyellow\">.</span>java_exception<span class=\"ansiyellow\">.</span>toString<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.3-src.zip/py4j/protocol.py</span> in <span class=\"ansicyan\">get_return_value</span><span class=\"ansiblue\">(answer, gateway_client, target_id, name)</span>\n<span class=\"ansigreen\">    317</span>                 raise Py4JJavaError(\n<span class=\"ansigreen\">    318</span>                     <span class=\"ansiblue\">&quot;An error occurred while calling {0}{1}{2}.\\n&quot;</span><span class=\"ansiyellow\">.</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 319</span><span class=\"ansiyellow\">                     format(target_id, &quot;.&quot;, name), value)\n</span><span class=\"ansigreen\">    320</span>             <span class=\"ansigreen\">else</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    321</span>                 raise Py4JError(\n\n<span class=\"ansired\">Py4JJavaError</span>: An error occurred while calling z:org.apache.spark.api.python.PythonRDD.runJob.\n: org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 7812.0 failed 4 times, most recent failure: Lost task 0.3 in stage 7812.0 (TID 818183, 10.172.246.109): org.apache.spark.api.python.PythonException: Traceback (most recent call last):\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 172, in main\n    process()\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 167, in process\n    serializer.dump_stream(func(split_index, iterator), outfile)\n  File &quot;/databricks/spark/python/pyspark/serializers.py&quot;, line 263, in dump_stream\n    vs = list(itertools.islice(iterator, batch))\n  File &quot;/databricks/spark/python/pyspark/rdd.py&quot;, line 1306, in takeUpToNumLeft\n    yield next(iterator)\n  File &quot;&lt;ipython-input-14-08e616b374fd&gt;&quot;, line 9, in &lt;lambda&gt;\nAttributeError: &apos;int&apos; object has no attribute &apos;product&apos;\n\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.read(PythonRDD.scala:193)\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.&lt;init&gt;(PythonRDD.scala:234)\n\tat org.apache.spark.api.python.PythonRunner.compute(PythonRDD.scala:152)\n\tat org.apache.spark.api.python.PythonRDD.compute(PythonRDD.scala:63)\n\tat org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:319)\n\tat org.apache.spark.rdd.RDD.iterator(RDD.scala:283)\n\tat org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:70)\n\tat org.apache.spark.scheduler.Task.run(Task.scala:86)\n\tat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:274)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\nDriver stacktrace:\n\tat org.apache.spark.scheduler.DAGScheduler.org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages(DAGScheduler.scala:1454)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1442)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1441)\n\tat scala.collection.mutable.ResizableArray$class.foreach(ResizableArray.scala:59)\n\tat scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:47)\n\tat org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:1441)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:811)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:811)\n\tat scala.Option.foreach(Option.scala:236)\n\tat org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:811)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:1667)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1622)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1611)\n\tat org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:48)\n\tat org.apache.spark.scheduler.DAGScheduler.runJob(DAGScheduler.scala:632)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:1891)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:1904)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:1917)\n\tat org.apache.spark.api.python.PythonRDD$.runJob(PythonRDD.scala:441)\n\tat org.apache.spark.api.python.PythonRDD.runJob(PythonRDD.scala)\n\tat sun.reflect.GeneratedMethodAccessor143.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:237)\n\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)\n\tat py4j.Gateway.invoke(Gateway.java:280)\n\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\n\tat py4j.commands.CallCommand.execute(CallCommand.java:79)\n\tat py4j.GatewayConnection.run(GatewayConnection.java:214)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: org.apache.spark.api.python.PythonException: Traceback (most recent call last):\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 172, in main\n    process()\n  File &quot;/databricks/spark/python/pyspark/worker.py&quot;, line 167, in process\n    serializer.dump_stream(func(split_index, iterator), outfile)\n  File &quot;/databricks/spark/python/pyspark/serializers.py&quot;, line 263, in dump_stream\n    vs = list(itertools.islice(iterator, batch))\n  File &quot;/databricks/spark/python/pyspark/rdd.py&quot;, line 1306, in takeUpToNumLeft\n    yield next(iterator)\n  File &quot;&lt;ipython-input-14-08e616b374fd&gt;&quot;, line 9, in &lt;lambda&gt;\nAttributeError: &apos;int&apos; object has no attribute &apos;product&apos;\n\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.read(PythonRDD.scala:193)\n\tat org.apache.spark.api.python.PythonRunner$$anon$1.&lt;init&gt;(PythonRDD.scala:234)\n\tat org.apache.spark.api.python.PythonRunner.compute(PythonRDD.scala:152)\n\tat org.apache.spark.api.python.PythonRDD.compute(PythonRDD.scala:63)\n\tat org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:319)\n\tat org.apache.spark.rdd.RDD.iterator(RDD.scala:283)\n\tat org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:70)\n\tat org.apache.spark.scheduler.Task.run(Task.scala:86)\n\tat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:274)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\t... 1 more\n\n</div>","workflows":[],"startTime":1.481598766477E12,"submitTime":1.481598618918E12,"finishTime":1.481598836104E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b83aca8c-befa-4c40-9490-ce1c4601d5d7"},{"version":"CommandV1","origId":823,"guid":"2c3c3938-9a39-4761-be63-fdd943171ddd","subtype":"command","commandType":"auto","position":27.625,"command":"print predictions_by_user.take(10)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">[(507161, [12985, 91177, 288653, 68212, 25150, 14397, 87433, 217471, 315812, 319911, 307202, 177172, 54386, 314086, 25323, 221730, 302247, 123630, 305991, 291341, 243769, 177486, 52478, 244143, 241705, 289658, 311604, 333259, 334187, 192716, 248603, 277126, 243307, 24825, 165401, 183796, 384072, 212702, 170541, 266750, 311262, 86545, 348629, 115162, 45592, 281075, 190006, 142602, 310418, 373947, 19682, 357810, 2078, 302369, 242151, 177574, 245936, 207916, 38941, 52176, 329834, 107193, 126831, 233632, 301674, 261596, 49781, 105434, 192425, 307140, 351764, 26935, 329869, 97972, 334240, 183790, 195955, 337625, 16174, 292298, 353700, 8402, 180413, 187097, 190270, 74321, 208383, 207935, 222088, 16220, 362714, 55364, 109807, 211334, 354625, 335634, 212017, 383719, 142745, 74558, 319788, 285387, 341456, 138672, 57500, 90822, 223714, 353035, 3525, 154559, 65358, 359476, 129495, 108137, 12554, 11011, 167248, 339774, 251150, 40311, 245012, 345265, 307414, 115274, 289238, 105694, 132813, 311702, 309384, 259912, 172688, 123457, 196619, 251101, 30643, 62467, 231280, 165753, 6449, 297177, 205438, 114624, 322843, 28632, 273894, 295919, 49770, 49469, 284507, 242558, 157386, 282116, 333064, 128469, 82113, 25706, 202995, 300918, 103524, 69165, 302031, 374902, 127365, 117727, 314350, 281102, 137197, 134402, 346138, 335200, 212753, 287628, 341506, 206288, 365793, 207699, 195624, 161257, 170222, 107825, 135287, 341964, 136611, 170645, 75497, 37133, 326792, 233124, 198994, 290375, 253868, 122591, 309672, 301669, 125707, 154239, 225108, 315546, 175099, 93787, 362652, 220809, 357202, 8661, 73317, 70949, 248176, 233793, 189538, 305383, 307268, 149371, 191533, 139086, 126648, 287657, 385556, 86689, 79814, 50871, 50740, 359613, 291569, 7612, 232040, 261901, 30292, 327563, 311363, 262242, 13187, 188333, 51070, 115101, 243846, 234609, 353640, 251010, 157562, 362643, 40539, 359201, 379742, 351241, 112304, 134909, 235657, 280827, 106583, 84387, 49724, 207108, 186927, 48688, 68729, 6146, 134057, 164696, 2242, 309748, 256499, 296099, 160287, 23789, 136139, 83123, 218342, 243516, 215861, 296742, 282103, 236978, 334158, 39401, 841, 305804, 231613, 139370, 228613, 84395, 37214, 186533, 339094, 10208, 16116, 197153, 37271, 216535, 55106, 305541, 14903, 154151, 309958, 256130, 191003, 214742, 171320, 374516, 76417, 142493, 207426, 252531, 128247, 229348, 283134, 48333, 16989, 167128, 273887, 117309, 292369, 225221, 363559, 384037, 116185, 343061, 82581, 212675, 268474, 326432, 239262, 349536, 332771, 350908, 126327, 111771, 191499, 283314, 189433, 318169, 1248, 25262, 324455, 168430, 305444, 47391, 5592, 205995, 328524, 170306, 183682, 196700, 345969, 101204, 340072, 301690, 354593, 123769, 71547, 186701, 279154, 189050, 316038, 330392, 98924, 182917, 27676, 369289, 121733, 148050, 345815, 314114, 516, 305496, 282298, 225153, 90106, 311933, 11631, 220520, 33438, 138010, 105213, 203463, 73369, 200171, 212852, 364051, 293778, 120304, 102034, 238581, 283244, 180175, 119433, 168618, 150684, 127276, 183720, 147248, 238410, 155424, 250930, 270288, 222878, 256263, 378274, 343182, 72314, 188549, 220731, 285257, 142382, 341073, 138136, 20801, 211200, 206229, 38470, 322987, 183998, 321930, 315425, 68826, 69259, 175675, 362235, 245704, 33534, 6982, 211749, 320522, 144511, 69487, 150116, 324981, 54368, 265420, 4947, 163838, 312416, 284759, 307668, 178571, 151596, 224878, 145952, 46477, 24622, 278861, 261783, 192089, 116409, 130077, 200091, 368622, 373848, 371071, 57825, 361137, 280794, 239676, 222672, 60252, 362321, 374326, 266606, 247570, 71476, 134150, 247046, 129519, 37054, 354487, 251757, 208780, 236511, 259576, 307628, 179479, 239018, 343207, 129142, 295651, 277014, 220787, 43152, 372412, 176139, 75998, 351817, 37465, 180961, 267178, 220273, 322168, 346394, 220688, 15925, 98159, 277613, 327413, 118588, 92566, 222416, 166650, 305244, 99425, 173680, 231139, 318235, 346955, 155015, 265955, 148941, 182010, 297678, 78642, 74115, 184241, 342654, 177514, 153273, 344876, 315493, 174070, 51296, 278243, 96041, 297989, 210673, 115589, 74238, 349271, 9119, 138837, 36681, 190448, 106003, 136621, 314491, 364125, 187655, 349184, 58821, 100897, 321802, 37096, 41786, 281333, 4604, 346912, 161507, 158646, 91773, 172483, 187555, 40345, 247288, 157648, 217095, 218440, 294109, 324124, 381334, 135204, 19159, 354323, 151125, 78503, 170852, 34556, 210627, 315822, 6883, 76143, 338648, 41953, 310180, 307375, 300169, 218666, 12500, 316441, 96367, 138265, 287391, 372025, 98664, 219791, 263933, 289099, 229729, 174148, 90298, 198038, 142093, 132347, 325835, 219169, 186863, 378063, 196087, 36589, 151249, 87177, 272664, 201980, 255729, 300492, 373978, 90024, 324618, 24236, 279090, 102124, 380811, 141832, 361363, 6525, 118874, 342905, 373907, 343755, 112750, 248433, 296731, 2607, 158889, 153860, 224988, 260240, 107252, 16177, 331326, 382217, 27564, 376874, 244172, 340310, 153745, 361372, 16381, 238782, 175913, 70550, 311677, 111061, 276403, 253186, 154377, 42446, 314117, 1424, 328598, 65618, 15003, 321409, 279780, 120153, 169324, 168417, 268340, 21818, 77776, 78354, 76064, 367596, 373834, 193065, 147082, 61830, 277913, 284727, 383583, 115469, 209098, 21767, 229028, 302569, 75276, 48315, 8681, 127140, 310842, 265904, 183572, 348330, 231556, 294419, 309892, 204139, 3018, 301623, 135226, 97182, 333023, 252131, 147298, 212172, 258181, 203838, 275346, 73942, 358268, 4001, 337491, 211253, 248942, 116743, 11728, 130804, 191217, 196347, 280035, 337760, 31260, 90147, 250211, 288817, 120857, 337653, 246840, 151639, 6977, 376799, 224214, 185245, 288712, 25903, 264184, 322253, 273305, 301963, 329426, 57565, 31669, 91396, 337785, 292884, 73628, 199859, 66795, 288347, 208130, 244189, 146033, 188289, 340856, 42731, 313653, 39842, 302439, 182021, 261411, 235456, 45144, 96952, 303749, 158389, 334460, 285713, 368737, 154250, 288371, 121351, 34948, 259934, 359664, 347965, 232635, 270991, 178288, 305173, 299350, 202559, 249909, 32544, 192917, 89798, 144703, 244871, 97555, 276684, 106209, 235145, 257640, 300759, 325452, 345128, 107121, 215487, 305213, 195865, 197733, 154096, 62960, 48460, 95916, 7780, 208033, 180903, 362835, 286585, 26673, 361724, 364795, 191309, 231618, 346886, 159839, 363691, 360102, 168787, 336192, 268419, 225998, 94010, 231773, 278426, 206088, 108625, 82096, 151113, 239027, 200227, 208311, 109416, 373327, 60866, 245824, 332572, 131791, 251603, 200958, 18238, 52422, 65378, 128662, 36208, 276631, 42474, 340423, 207334, 158652, 81531, 120447, 245546, 283641, 70839, 346704, 348308, 25631, 5802, 334775, 220770, 158075, 291183, 130738, 186261, 249193, 264858, 318282, 380790, 370800, 180600, 253545, 160694, 136023, 334945, 323250, 193512, 83309, 49238, 345871, 348798, 322495, 363607, 237680, 126471, 208215, 335283, 134590, 171482, 114510, 8358, 320163, 167661]), (899016, [12985, 91177, 288653, 68212, 25150, 14397, 87433, 217471, 315812, 319911, 307202, 177172, 54386, 314086, 25323, 221730, 302247, 123630, 305991, 291341, 243769, 177486, 52478, 244143, 241705, 289658, 311604, 333259, 334187, 192716, 248603, 277126, 243307, 24825, 165401, 183796, 384072, 212702, 170541, 266750, 311262, 86545, 348629, 115162, 45592, 281075, 190006, 142602, 310418, 373947, 19682, 357810, 2078, 302369, 242151, 177574, 245936, 207916, 38941, 52176, 329834, 107193, 126831, 233632, 301674, 261596, 49781, 105434, 192425, 307140, 351764, 26935, 329869, 97972, 334240, 183790, 195955, 337625, 16174, 292298, 353700, 8402, 180413, 187097, 190270, 74321, 208383, 207935, 222088, 16220, 362714, 55364, 109807, 211334, 354625, 335634, 212017, 383719, 142745, 74558, 319788, 285387, 341456, 138672, 57500, 90822, 223714, 353035, 3525, 154559, 65358, 359476, 129495, 108137, 12554, 11011, 167248, 339774, 251150, 40311, 245012, 345265, 307414, 115274, 289238, 105694, 132813, 311702, 309384, 259912, 172688, 123457, 196619, 251101, 30643, 62467, 231280, 165753, 6449, 297177, 205438, 114624, 322843, 28632, 273894, 295919, 49770, 49469, 284507, 242558, 157386, 282116, 333064, 128469, 82113, 25706, 202995, 300918, 103524, 69165, 302031, 374902, 127365, 117727, 314350, 281102, 137197, 134402, 346138, 335200, 212753, 287628, 341506, 206288, 365793, 207699, 195624, 161257, 170222, 107825, 135287, 341964, 136611, 170645, 75497, 37133, 326792, 233124, 198994, 290375, 253868, 122591, 309672, 301669, 125707, 154239, 225108, 315546, 175099, 93787, 362652, 220809, 357202, 8661, 73317, 70949, 248176, 233793, 189538, 305383, 307268, 149371, 191533, 139086, 126648, 287657, 385556, 86689, 79814, 50871, 50740, 359613, 291569, 7612, 232040, 261901, 30292, 327563, 311363, 262242, 13187, 188333, 51070, 115101, 243846, 234609, 353640, 251010, 157562, 362643, 40539, 359201, 379742, 351241, 112304, 134909, 235657, 280827, 106583, 84387, 49724, 207108, 186927, 48688, 68729, 6146, 134057, 164696, 2242, 309748, 256499, 296099, 160287, 23789, 136139, 83123, 218342, 243516, 215861, 296742, 282103, 236978, 334158, 39401, 841, 305804, 231613, 139370, 228613, 84395, 37214, 186533, 339094, 10208, 16116, 197153, 37271, 216535, 55106, 305541, 14903, 154151, 309958, 256130, 191003, 214742, 171320, 374516, 76417, 142493, 207426, 252531, 128247, 229348, 283134, 48333, 16989, 167128, 273887, 117309, 292369, 225221, 363559, 384037, 116185, 343061, 82581, 212675, 268474, 326432, 239262, 349536, 332771, 350908, 126327, 111771, 191499, 283314, 189433, 318169, 1248, 25262, 324455, 168430, 305444, 47391, 5592, 205995, 328524, 170306, 183682, 196700, 345969, 101204, 340072, 301690, 354593, 123769, 71547, 186701, 279154, 189050, 316038, 330392, 98924, 182917, 27676, 369289, 121733, 148050, 345815, 314114, 516, 305496, 282298, 225153, 90106, 311933, 11631, 220520, 33438, 138010, 105213, 203463, 73369, 200171, 212852, 364051, 293778, 120304, 102034, 238581, 283244, 180175, 119433, 168618, 150684, 127276, 183720, 147248, 238410, 155424, 250930, 270288, 222878, 256263, 378274, 343182, 72314, 188549, 220731, 285257, 142382, 341073, 138136, 20801, 211200, 206229, 38470, 322987, 183998, 321930, 315425, 68826, 69259, 175675, 362235, 245704, 33534, 6982, 211749, 320522, 144511, 69487, 150116, 324981, 54368, 265420, 4947, 163838, 312416, 284759, 307668, 178571, 151596, 224878, 145952, 46477, 24622, 278861, 261783, 192089, 116409, 130077, 200091, 368622, 373848, 371071, 57825, 361137, 280794, 239676, 222672, 60252, 362321, 374326, 266606, 247570, 71476, 134150, 247046, 129519, 37054, 354487, 251757, 208780, 236511, 259576, 307628, 179479, 239018, 343207, 129142, 295651, 277014, 220787, 43152, 372412, 176139, 75998, 351817, 37465, 180961, 267178, 220273, 322168, 346394, 220688, 15925, 98159, 277613, 327413, 118588, 92566, 222416, 166650, 305244, 99425, 173680, 231139, 318235, 346955, 155015, 265955, 148941, 182010, 297678, 78642, 74115, 184241, 342654, 177514, 153273, 344876, 315493, 174070, 51296, 278243, 96041, 297989, 210673, 115589, 74238, 349271, 9119, 138837, 36681, 190448, 106003, 136621, 314491, 364125, 187655, 349184, 58821, 100897, 321802, 37096, 41786, 281333, 4604, 346912, 161507, 158646, 91773, 172483, 187555, 40345, 247288, 157648, 217095, 218440, 294109, 324124, 381334, 135204, 19159, 354323, 151125, 78503, 170852, 34556, 210627, 315822, 6883, 76143, 338648, 41953, 310180, 307375, 300169, 218666, 12500, 316441, 96367, 138265, 287391, 372025, 98664, 219791, 263933, 289099, 229729, 174148, 90298, 198038, 142093, 132347, 325835, 219169, 186863, 378063, 196087, 36589, 151249, 87177, 272664, 201980, 255729, 300492, 373978, 90024, 324618, 24236, 279090, 102124, 380811, 141832, 361363, 6525, 118874, 342905, 373907, 343755, 112750, 248433, 296731, 2607, 158889, 153860, 224988, 260240, 107252, 16177, 331326, 382217, 27564, 376874, 244172, 340310, 153745, 361372, 16381, 238782, 175913, 70550, 311677, 111061, 276403, 253186, 154377, 42446, 314117, 1424, 328598, 65618, 15003, 321409, 279780, 120153, 169324, 168417, 268340, 21818, 77776, 78354, 76064, 367596, 373834, 193065, 147082, 61830, 277913, 284727, 383583, 115469, 209098, 21767, 229028, 302569, 75276, 48315, 8681, 127140, 310842, 265904, 183572, 348330, 231556, 294419, 309892, 204139, 3018, 301623, 135226, 97182, 333023, 252131, 147298, 212172, 258181, 203838, 275346, 73942, 358268, 4001, 337491, 211253, 248942, 116743, 11728, 130804, 191217, 196347, 280035, 337760, 31260, 90147, 250211, 288817, 120857, 337653, 246840, 151639, 6977, 376799, 224214, 185245, 288712, 25903, 264184, 322253, 273305, 301963, 329426, 57565, 31669, 91396, 337785, 292884, 73628, 199859, 66795, 288347, 208130, 244189, 146033, 188289, 340856, 42731, 313653, 39842, 302439, 182021, 261411, 235456, 45144, 96952, 303749, 158389, 334460, 285713, 368737, 154250, 288371, 121351, 34948, 259934, 359664, 347965, 232635, 270991, 178288, 305173, 299350, 202559, 249909, 32544, 192917, 89798, 144703, 244871, 97555, 276684, 106209, 235145, 257640, 300759, 325452, 345128, 107121, 215487, 305213, 195865, 197733, 154096, 62960, 48460, 95916, 7780, 208033, 180903, 362835, 286585, 26673, 361724, 364795, 191309, 231618, 346886, 159839, 363691, 360102, 168787, 336192, 268419, 225998, 94010, 231773, 278426, 206088, 108625, 82096, 151113, 239027, 200227, 208311, 109416, 373327, 60866, 245824, 332572, 131791, 251603, 200958, 18238, 52422, 65378, 128662, 36208, 276631, 42474, 340423, 207334, 158652, 81531, 120447, 245546, 283641, 70839, 346704, 348308, 25631, 5802, 334775, 220770, 158075, 291183, 130738, 186261, 249193, 264858, 318282, 380790, 370800, 180600, 253545, 160694, 136023, 334945, 323250, 193512, 83309, 49238, 345871, 348798, 322495, 363607, 237680, 126471, 208215, 335283, 134590, 171482, 114510, 8358, 320163, 167661, 77550, 72219, 93895, 341773, 229752, 263887, 252651, 274986, 218902, 277268, 91503, 253539, 121439, 129078, 285175, 159581, 292274, 194024, 148457, 108314, 293403, 196875, 382629, 364673, 243012, 218183, 134665, 368880, 349859, 310521, 43048, 337888, 126923, 69523, 349681, 332643, 344330, 289391, 308918, 257947, 159953, 217329, 179422, 10986, 89897, 299971, 90974, 37954, 173256, 78404, 272065, 195911, 274281, 346089, 164049, 258100, 206544, 33377, 280952, 360605, 219826, 343269, 111478, 374972, 56866, 2059, 331405, 345155, 228554, 99151, 241283, 170253, 359317, 332916, 255663, 300008, 286060, 361981, 173469, 380379, 352804, 269229, 184820, 234559, 138790, 305555, 284409, 26090, 282623, 363719, 67850, 21403, 221632, 382090, 253432, 153049, 295286, 295824, 7658, 64633, 202261, 64330, 3444, 174906, 284889, 271459, 9033, 8451, 58973, 185028, 273861, 51953, 249272, 28484, 372548, 381791, 106731, 32471, 352870, 64001, 31927, 227739, 245956, 97877, 161020, 186377, 293373, 35337, 147132, 77141, 359810, 241255, 339795, 210391, 57378, 73887, 16634, 100960, 307269, 104800, 206667, 360928, 227294, 236352, 34706, 148639, 154167, 79853, 349518, 273153, 121731, 33324, 345696, 69799, 241932, 124000, 350994, 247762, 330152, 203427, 342391, 292988, 247928, 193240, 375896, 348832, 158844, 299654, 31834, 143006, 248248, 70417, 99278, 217720, 341173, 195838, 132519, 336511, 321387, 280972, 347697, 43327, 262356, 161874, 101650, 124120, 341677, 380489, 230249, 24407, 329364, 261890, 245404, 307594, 288122, 55641, 353019, 109239, 301077, 52844, 306274, 269566, 362262, 283346, 266846, 348240, 200698, 23878, 297671, 257902, 340112, 358202, 310269, 291184, 376619, 201403, 94064, 153480, 182435, 140746, 341056, 22636, 84086, 319783, 816, 228908, 359307, 126407, 361918, 123797, 144822, 99830, 12006, 49150, 201768, 251933, 328043, 208210, 189725, 28476, 147709, 264415, 337640, 212406, 62080, 288799, 245638, 44181, 177419, 170690, 221812, 135695, 80654, 143039, 342107, 216147, 232520, 65973, 294932, 26982, 258567, 308356, 5717, 326986, 297118, 286878, 272094, 230637, 199498, 366790, 170309, 235235, 213331, 194394, 280418, 373125, 248345, 41903, 178622, 339377, 112441, 273095, 305887, 282688, 352277, 240580, 178954, 53180, 20811, 285288, 135436, 278925, 523, 120218, 163994, 366327, 204320, 20449, 9130, 140601, 340401, 277798, 69220, 240551, 183960, 299125, 272062, 306687, 112220, 335241, 36622, 263727, 208289, 327677, 38754, 252967, 66239, 381473, 267216, 107400, 210377, 94623, 284732, 30001, 225353, 283197, 76011, 374848, 150638, 125582, 91666, 318454, 285117, 295970, 338416, 210933, 287399, 363105, 304210, 61740, 299606, 164880, 304780, 320763, 348185, 115690, 42538, 68333, 300977, 268231, 214510, 252177, 97978, 320656, 4839, 169849, 98307, 2190, 32260, 49297, 302975, 13213, 228276, 286052, 363825, 319852, 173028, 81300, 322149, 233420, 39112, 245621, 215027, 352107, 84254, 145293, 306401, 152195, 161424, 380889, 11686, 50719, 150760, 281890, 27348, 33694, 135716, 265906, 309508, 337389, 157485, 30990, 358364, 99563, 178028, 329983, 159511, 252613, 256559, 293511, 307098, 21513, 248512, 302629, 19930, 189628, 228633, 13793, 180802, 63698, 5310, 330417, 162907, 15215, 110350, 277831, 350051, 295585, 277861, 7203, 154570, 79400, 351054, 125212, 237366, 301559, 323034, 311150, 108521, 175101, 169794, 362709, 337483, 266702, 121349, 347520, 231464, 187518, 189294, 233686, 293104, 102372, 315652, 45097, 94236, 18822, 55664, 340895, 112487, 331589, 266818, 331951, 264549, 243993, 87501, 370852, 258513, 257797, 98122, 367757, 95103, 213963, 16922, 81197, 260345, 206101, 379681, 87138, 3244, 42773, 239655, 265389, 57945, 93790, 172538, 268503, 336057, 208885, 20355, 214555, 385600, 297506, 7016, 333767, 68638, 17677, 292836, 132011, 220961, 47950, 40476, 310047, 371952, 100632, 74372, 317561, 314143, 261364, 47058, 236518, 337637, 287349, 92189, 198275, 70196, 385272, 256655, 94044, 83928, 84628, 147076, 238403, 194613, 299879, 276655, 5897, 36572, 209803, 223421, 206948, 247893, 231616, 250917, 116596, 179466, 372612, 150084, 71024, 10662, 363952, 222991, 328841, 127903, 94452, 111132, 301404, 129719, 194388, 209455, 165178, 154498, 267015, 96679, 337939, 148792, 313730, 24069, 10382, 128037, 259999, 163624, 270673, 144962, 153861, 3100, 25807, 208357, 219562, 57948, 166723, 292864, 320725, 228762, 231314, 17703, 86151, 86295, 102249, 226861, 348139, 22177, 116070, 6969, 57225, 7537, 258598, 351767, 16612, 380200, 353980, 255453, 102470, 110636, 222650, 291851, 128659, 199810, 36377, 64930, 122059, 206941, 106938, 135289, 76303, 384068, 172502, 278782, 25876, 116856, 295676, 32307, 379118, 335301, 347469, 203031, 253589, 294389, 200504, 385877, 173081, 287295, 366210, 124904, 317220, 267326, 350380, 298108, 117083, 13587, 375999, 261870, 308653, 370289, 287934, 69290, 164421, 283349, 167163, 278538, 215165, 316723, 91546, 165766, 96180, 136472, 339376, 322823, 65932, 29476, 302516, 335216, 381493, 105150, 90152, 22776, 12113, 222446, 77729, 374758, 163185, 336902, 275973, 373912, 245525, 177746, 384151, 212324, 169426, 313332, 59346, 31513, 233401, 148169, 247675, 129224, 152870, 171653, 103382, 13632, 87354, 57358, 351420, 298062, 58049, 356499, 51904, 314038, 69100, 327320, 249864, 35349, 178479, 255764, 234180, 56676, 180706, 304906, 226229, 63559, 229042, 187467, 144637, 202274, 319945, 69323, 331219, 60719, 262794, 364583, 110655, 183609, 91219, 137693, 1942, 105541, 17612, 193937, 129083, 109790, 258631, 40656, 275340, 345130, 166841, 365157, 11179, 281587, 330167, 118213, 109532, 289706, 308297, 11123, 126716, 127886, 263037, 335530, 12454, 40092, 136450, 379542, 96530, 147736, 203938, 112343, 350944, 268965, 58486, 220491, 143562, 62396, 54727, 8702, 222348, 51814, 41093, 251394, 377000, 141058, 22068, 39441, 287231, 32641, 94893, 237619, 174233, 91108, 299846, 115090, 100950, 192057, 212300, 62838, 78960, 281108, 13896, 96125, 178632, 149818, 367903, 279781, 226114, 333787, 295975, 283784, 125823, 326061, 176494, 292483, 294764, 139227, 49321, 137041, 190164, 313059, 246304, 172111, 239203, 259495, 353557, 156768, 343599, 166750, 117175, 327479, 339307, 119343, 223437, 64379, 57369, 383907, 66513, 198937, 188674, 165488, 126233, 110212, 372001, 22204, 55011, 2907, 34166, 190514, 248734, 123626, 376454, 28377, 94604, 182366, 32810, 280864, 137832, 249081, 247218, 89115, 52449, 367995, 355669, 6110, 94933, 98814, 124849, 139005, 354962, 276360, 172292, 24457, 253689, 205270, 280887, 82595, 79258, 287187, 236496, 301603, 198350, 335674, 285974, 50988, 3858, 273606, 405, 294197, 323718, 173528, 306978, 347711, 242113, 217324, 234868, 38419, 347528, 21674, 347510, 152516, 248651, 101818, 369840, 137187, 357689, 284278, 225664, 119610, 212050, 55721, 152593, 136659, 145885, 55411, 235858, 259805, 232322, 49797, 121910, 176240, 277006, 180115, 246782, 149782, 207117, 339503, 34235, 283501, 360918, 225531, 279862, 197651, 12988, 101578, 327872, 314837, 233017, 386075, 103260, 289484, 145857, 324697, 167378, 202903, 101230, 210176, 75335, 155148, 84635, 318106, 116818, 116141, 263553, 148495, 373158, 334808, 34876, 281498, 311682, 327270, 227715, 103968, 219472, 10189, 330454, 124663, 204633, 3449, 165921, 266113, 210807, 224645, 281370, 193164, 366904, 241712, 100928, 86957, 245748, 39506, 364153, 256556, 351086, 308142, 213170, 232871, 94868, 374400, 230365, 158388, 76808, 25568, 334505, 353041, 54359, 142553, 223448, 105438, 34037, 340684, 89219, 190941, 351667, 293365, 154711, 382564, 215189, 297801, 96292, 368310, 174915, 137034, 102260, 153373, 246103, 242586, 83410, 184301, 77972, 94968, 219994, 90127, 214436, 244539, 313455, 364243, 360174, 300682, 269628, 125010, 285251, 100678, 251822, 56863, 234280, 283951, 45076, 279602, 348559, 108845, 170327, 154501, 180858, 53693, 132198, 71116, 289847, 104739, 69375, 266087, 291779, 157291, 343214, 222403, 35631, 325561, 25128, 273655, 254792, 89424, 127083, 52099, 323044, 369428, 137754, 184293, 281860, 127785, 102500, 126223, 281119, 165467, 139283, 80219, 115487, 336929, 301621, 76347, 278475, 6968, 203871, 197324, 384867, 261781, 135668, 43436, 315061, 234204, 218417, 289214, 86019, 257219, 83365, 372926, 348088, 160363, 141210, 193289, 247342, 368893, 148266, 347437, 90812, 37444, 34025, 344162, 327281, 331120, 162388, 204174, 142046, 288730, 156046, 136209, 225655, 69650, 244742, 156127, 75784, 286381, 300006, 21662, 82172, 52031, 268152, 306523, 247572, 270978, 329670, 149593, 133222, 226199, 38668, 240656, 37769, 63245, 51244, 354976, 335255, 314360, 230536, 234666, 100452, 320885, 146079, 14487, 244482, 28791, 154557, 278649, 19969, 98264, 349346, 359527, 234304, 343454, 252048, 244681, 283925, 268331, 64031, 341347, 48332, 281798, 298818, 98973, 199248, 126549, 350606, 145654, 237757, 16503, 345989, 335987, 48148, 234086, 87499, 78425, 14477, 262277, 155444, 191280, 324208, 20569, 255057, 118116, 369277, 47688, 195447, 373403, 170546, 33956, 154965, 191665, 374910, 326130, 119852, 247009, 320067, 221355, 194970, 185139, 341674, 367984, 266001, 30838, 186035, 373342, 276233, 20248, 195856, 36635, 363163, 200145, 169838, 53210, 103387, 380921, 62668, 350561, 256818, 334102, 244822, 219197, 216625, 59360, 371120, 253046, 360413, 380820, 15338, 286747, 158514, 233143, 63199, 358792, 337702, 180567, 340079, 216979, 99280, 178012, 91875, 78016, 129149, 69837, 353675, 159300, 215039, 45079, 353847, 269264, 226822, 144294, 36784, 209166, 256327, 37046, 53233, 16228, 33665, 371315, 52542, 347669, 255690, 240134, 153712, 295238, 170830, 245580, 145141, 331166, 246452, 56393, 195347, 214440, 230437, 160674, 70952, 269572, 295260, 243773, 133078, 124442, 370393, 146340, 205941, 384890, 103629, 146515, 2629, 274793, 364970, 341367, 113114, 82612, 114036, 210067, 111713, 227761, 257168, 169297, 150065, 227803, 6529, 267405, 119712, 294610, 63125, 255050, 33283, 97605, 212364, 169342, 343963, 356702, 74329, 265337, 34149, 304123, 249949, 248369, 238649, 54661, 297895, 156317, 93347, 283447, 312347, 33002, 245010, 318887, 59066, 47864, 163900, 21976, 318572, 219335, 51658, 338756, 39994, 167537, 354666, 304654, 69254, 250964, 351545, 164092, 197799, 307488, 82247, 329069, 73612, 29826, 116323, 267574, 293197, 54263, 298256, 164664, 151, 151970, 310469, 152114, 30280, 367063, 166545, 179478, 220580, 378813, 370906, 147600, 21832, 68830, 282437, 21999, 182238, 150661, 206247, 55790, 296375, 306276, 108813, 310583, 249325, 131382, 54022, 76340, 146250, 222990, 34845, 115168, 141547, 285250, 177940, 255548, 206998, 99592, 123000, 331201, 305317, 349023, 145253, 70178, 212542, 248279, 300088, 384804, 220482, 320967, 153348, 21458, 331231, 125965, 112593, 65890, 171004, 279073, 243871, 352773, 354172, 94039, 128490, 294797, 330879, 108755, 169841, 106132, 215344, 41812, 160999, 285890, 83193, 89576, 321071, 20175, 302328, 286658, 224596, 217681, 121379, 173037, 273650, 289133, 307821, 98054, 197230, 308741, 186233, 140195, 255165, 231973, 299361, 159461, 242252, 338480, 206906, 154765, 310525, 226770, 353986, 314936, 246092, 32715, 312217, 337303, 6702, 361069, 338331, 90958, 273605, 190327, 38664, 326086, 174407, 279943, 331047, 201054, 207792, 215056, 200739, 240848, 146949, 364020, 243770, 293768, 354088, 218078, 219739, 221036, 162401, 181765, 323092, 138546, 103220, 131320, 45484, 24400, 335337, 2240, 8990, 141993, 82298, 297005, 115196, 351831, 384923, 281212, 371549, 92723, 104539, 284734, 281651, 126802, 268464, 36390, 280136, 191113, 89307, 210828, 311698, 157683, 18983, 221005, 92976, 369832, 369405, 96987, 330812, 110132, 276551, 191270, 192478, 98736, 332583, 166447, 195299, 205254, 219095, 172741, 118196, 170197, 59067, 199376, 18848, 383100, 233501, 360596, 47402, 270854, 117854, 34751, 68779, 156714, 47671, 363499, 6885, 207033, 338853, 155518, 139159, 5502, 236203, 282092, 260193, 382678, 162571, 330784, 196160, 252321, 299538, 246904, 123295, 220336, 300485, 198460, 129301, 275906, 76336, 229925, 171968, 36930, 151600, 86229, 35660, 35075, 290037, 5652, 185976, 279707, 87553, 277873, 264907, 278036, 13067, 141588, 208409, 217030, 240233, 96148, 136172, 74606, 127052, 163546, 128232, 101189, 287108, 79284, 208365, 200668, 147920, 348663, 266479, 242835, 282859, 180578, 262748, 54711, 272802, 250651, 146775, 183443, 378097, 338530, 361281, 265000, 41965, 187545, 24978, 75410, 44504, 310113, 250719, 176394, 140505, 101210, 346849, 12547, 82162, 311512, 156803, 98418, 277886, 276865, 114203, 213796, 203791, 141133, 177261, 132663, 202918, 60857, 277295, 164768, 41705, 37105, 96768, 176803, 339121, 37134, 227162, 32308, 145289, 321121, 133033, 55388, 7503, 229657, 177441, 288840, 355797, 303878, 169415, 208827, 248303, 116940, 138793, 49639, 155507, 101878, 852, 80292, 296284, 277497, 366595, 330821, 341690, 264559, 136178, 109680, 239691, 332301, 262875, 293416, 316463, 185220, 24143, 103868, 299176, 293872, 1069, 230466, 345924, 63478, 317835, 340391, 212103, 296896, 64974, 167791, 314480, 372040, 324800, 147294, 76343, 50027, 260803, 317279, 341705, 267934, 193873, 76614, 324506, 324780, 278229, 129546, 334227, 328566, 10239, 8736, 289211, 123287, 263738, 144654, 143807, 351678, 361026, 139386, 372808, 102039, 280350, 133301, 115427, 239109, 145490, 244142, 334075, 60176, 96154, 129411, 86653, 315278, 29723, 84573, 336042, 21512, 340163, 35067, 190995, 234107, 156811, 325327, 294369, 234729, 29912, 127824, 103044, 383438, 52837, 82473, 224223, 49584, 40812, 351922, 85981, 91590, 28948, 179837, 3910, 283625, 270161, 26364, 307387, 237768, 1603, 289577, 51423, 310936, 216185]), (158008, [12985, 91177, 288653, 68212, 25150, 14397, 87433, 217471, 315812, 319911, 307202, 177172, 54386, 314086, 25323, 221730, 302247, 123630, 305991, 291341, 243769, 177486, 52478, 244143, 241705, 289658, 311604, 333259, 334187, 192716, 248603, 277126, 243307, 24825, 165401, 183796, 384072, 212702, 170541, 266750, 311262, 86545, 348629, 115162, 45592, 281075, 190006, 142602, 310418, 373947, 19682, 357810, 2078, 302369, 242151, 177574, 245936, 207916, 38941, 52176, 329834, 107193, 126831, 233632, 301674, 261596, 49781, 105434, 192425, 307140, 351764, 26935, 329869, 97972, 334240, 183790, 195955, 337625, 16174, 292298, 353700, 8402, 180413, 187097, 190270, 74321, 208383, 207935, 222088, 16220, 362714, 55364, 109807, 211334, 354625, 335634, 212017, 383719, 142745, 74558, 319788, 285387, 341456, 138672, 57500, 90822, 223714, 353035, 3525, 154559, 65358, 359476, 129495, 108137, 12554, 11011, 167248, 339774, 251150, 40311, 245012, 345265, 307414, 115274, 289238, 105694, 132813, 311702, 309384, 259912, 172688, 123457, 196619, 251101, 30643, 62467, 231280, 165753, 6449, 297177, 205438, 114624, 322843, 28632, 273894, 295919, 49770, 49469, 284507, 242558, 157386, 282116, 333064, 128469, 82113, 25706, 202995, 300918, 103524, 69165, 302031, 374902, 127365, 117727, 314350, 281102, 137197, 134402, 346138, 335200, 212753, 287628, 341506, 206288, 365793, 207699, 195624, 161257, 170222, 107825, 135287, 341964, 136611, 170645, 75497, 37133, 326792, 233124, 198994, 290375, 253868, 122591, 309672, 301669, 125707, 154239, 225108, 315546, 175099, 93787, 362652, 220809, 357202, 8661, 73317, 70949, 248176, 233793, 189538, 305383, 307268, 149371, 191533, 139086, 126648, 287657, 385556, 86689, 79814, 50871, 50740, 359613, 291569, 7612, 232040, 261901, 30292, 327563, 311363, 262242, 13187, 188333, 51070, 115101, 243846, 234609, 353640, 251010, 157562, 362643, 40539, 359201, 379742, 351241, 112304, 134909, 235657, 280827, 106583, 84387, 49724, 207108, 186927, 48688, 68729, 6146, 134057, 164696, 2242, 309748, 256499, 296099, 160287, 23789, 136139, 83123, 218342, 243516, 215861, 296742, 282103, 236978, 334158, 39401, 841, 305804, 231613, 139370, 228613, 84395, 37214, 186533, 339094, 10208, 16116, 197153, 37271, 216535, 55106, 305541, 14903, 154151, 309958, 256130, 191003, 214742, 171320, 374516, 76417, 142493, 207426, 252531, 128247, 229348, 283134, 48333, 16989, 167128, 273887, 117309, 292369, 225221, 363559, 384037, 116185, 343061, 82581, 212675, 268474, 326432, 239262, 349536, 332771, 350908, 126327, 111771, 191499, 283314, 189433, 318169, 1248, 25262, 324455, 168430, 305444, 47391, 5592, 205995, 328524, 170306, 183682, 196700, 345969, 101204, 340072, 301690, 354593, 123769, 71547, 186701, 279154, 189050, 316038, 330392, 98924, 182917, 27676, 369289, 121733, 148050, 345815, 314114, 516, 305496, 282298, 225153, 90106, 311933, 11631, 220520, 33438, 138010, 105213, 203463, 73369, 200171, 212852, 364051, 293778, 120304, 102034, 238581, 283244, 180175, 119433, 168618, 150684, 127276, 183720, 147248, 238410, 155424, 250930, 270288, 222878, 256263, 378274, 343182, 72314, 188549, 220731, 285257, 142382, 341073, 138136, 20801, 211200, 206229, 38470, 322987, 183998, 321930, 315425, 68826, 69259, 175675, 362235, 245704, 33534, 6982, 211749, 320522, 144511, 69487, 150116, 324981, 54368, 265420, 4947, 163838, 312416, 284759, 307668, 178571, 151596, 224878, 145952, 46477, 24622, 278861, 261783, 192089, 116409, 130077, 200091, 368622, 373848, 371071, 57825, 361137, 280794, 239676, 222672, 60252, 362321, 374326, 266606, 247570, 71476, 134150, 247046, 129519, 37054, 354487, 251757, 208780, 236511, 259576, 307628, 179479, 239018, 343207, 129142, 295651, 277014, 220787, 43152, 372412, 176139, 75998, 351817, 37465, 180961, 267178, 220273, 322168, 346394, 220688, 15925, 98159, 277613, 327413, 118588, 92566, 222416, 166650, 305244, 99425, 173680, 231139, 318235]), (751700, [12985, 91177, 288653, 68212, 25150, 14397, 87433, 217471, 315812, 319911, 307202, 177172, 54386, 314086, 25323, 221730, 302247, 123630, 305991, 291341, 243769, 177486, 52478, 244143, 241705, 289658, 311604, 333259, 334187, 192716, 248603, 277126, 243307, 24825, 165401, 183796, 384072, 212702, 170541, 266750, 311262, 86545, 348629, 115162, 45592, 281075, 190006, 142602, 310418, 373947, 19682, 357810, 2078, 302369, 242151, 177574, 245936, 207916, 38941, 52176, 329834, 107193, 126831, 233632, 301674, 261596, 49781, 105434, 192425, 307140, 351764, 26935, 329869, 97972, 334240, 183790, 195955, 337625, 16174, 292298, 353700, 8402, 180413, 187097, 190270, 74321, 208383, 207935, 222088, 16220, 362714, 55364, 109807, 211334, 354625, 335634, 212017, 383719, 142745, 74558, 319788, 285387, 341456, 138672, 57500, 90822, 223714, 353035, 3525, 154559, 65358, 359476, 129495, 108137, 12554, 11011, 167248, 339774, 251150, 40311, 245012, 345265, 307414, 115274, 289238, 105694, 132813, 311702, 309384, 259912, 172688, 123457, 196619, 251101, 30643, 62467, 231280, 165753, 6449, 297177, 205438, 114624, 322843, 28632, 273894, 295919, 49770, 49469, 284507, 242558, 157386, 282116, 333064, 128469, 82113, 25706, 202995, 300918, 103524, 69165, 302031, 374902, 127365, 117727, 314350, 281102, 137197, 134402, 346138, 335200, 212753, 287628, 341506, 206288, 365793, 207699, 195624, 161257, 170222, 107825, 135287, 341964, 136611, 170645, 75497, 37133, 326792, 233124, 198994, 290375, 253868, 122591, 309672, 301669, 125707, 154239, 225108, 315546, 175099, 93787, 362652, 220809, 357202, 8661, 73317, 70949, 248176, 233793, 189538, 305383, 307268, 149371, 191533, 139086, 126648, 287657, 385556, 86689, 79814, 50871, 50740, 359613, 291569, 7612, 232040, 261901, 30292, 327563, 311363, 262242, 13187, 188333, 51070, 115101, 243846, 234609, 353640, 251010, 157562, 362643, 40539, 359201, 379742, 351241, 112304, 134909, 235657, 280827, 106583, 84387, 49724, 207108, 186927, 48688, 68729, 6146, 134057, 164696, 2242, 309748, 256499, 296099, 160287, 23789, 136139, 83123, 218342, 243516, 215861, 296742, 282103, 236978, 334158, 39401, 841, 305804, 231613, 139370, 228613, 84395, 37214, 186533, 339094, 10208, 16116, 197153, 37271, 216535, 55106, 305541, 14903, 154151, 309958, 256130, 191003, 214742, 171320, 374516, 76417, 142493, 207426, 252531, 128247, 229348, 283134, 48333, 16989, 167128, 273887, 117309, 292369, 225221, 363559, 384037, 116185, 343061, 82581, 212675, 268474, 326432, 239262, 349536, 332771, 350908, 126327, 111771, 191499, 283314, 189433, 318169, 1248, 25262, 324455, 168430, 305444, 47391, 5592, 205995, 328524, 170306, 183682, 196700, 345969, 101204, 340072, 301690, 354593, 123769, 71547, 186701, 279154, 189050, 316038, 330392, 98924, 182917, 27676, 369289, 121733, 148050, 345815, 314114, 516, 305496, 282298, 225153, 90106, 311933, 11631, 220520, 33438, 138010, 105213, 203463, 73369, 200171, 212852, 364051, 293778, 120304, 102034, 238581, 283244, 180175, 119433, 168618, 150684, 127276, 183720, 147248, 238410, 155424, 250930, 270288, 222878, 256263, 378274, 343182, 72314, 188549, 220731, 285257, 142382, 341073, 138136, 20801, 211200, 206229, 38470, 322987, 183998, 321930, 315425, 68826, 69259, 175675, 362235, 245704, 33534, 6982, 211749, 320522, 144511, 69487, 150116, 324981, 54368, 265420, 4947, 163838, 312416, 284759, 307668, 178571, 151596, 224878, 145952, 46477, 24622, 278861, 261783, 192089, 116409, 130077, 200091, 368622, 373848, 371071, 57825, 361137, 280794, 239676, 222672, 60252, 362321, 374326, 266606, 247570, 71476, 134150, 247046, 129519, 37054, 354487, 251757, 208780, 236511, 259576, 307628, 179479, 239018, 343207, 129142, 295651, 277014, 220787, 43152, 372412, 176139, 75998, 351817, 37465, 180961, 267178, 220273, 322168, 346394, 220688, 15925, 98159, 277613, 327413, 118588, 92566, 222416, 166650, 305244, 99425, 173680, 231139, 318235, 346955, 155015, 265955, 148941, 182010, 297678, 78642, 74115, 184241, 342654, 177514, 153273, 344876, 315493, 174070, 51296, 278243, 96041, 297989, 210673, 115589, 74238, 349271, 9119, 138837, 36681, 190448, 106003, 136621, 314491, 364125, 187655, 349184, 58821, 100897, 321802, 37096, 41786, 281333, 4604, 346912, 161507, 158646]), (123706, [12985, 91177, 288653, 68212, 25150, 14397, 87433, 217471, 315812, 319911, 307202, 177172, 54386, 314086, 25323, 221730, 302247, 123630, 305991, 291341, 243769, 177486, 52478, 244143, 241705, 289658, 311604, 333259, 334187, 192716, 248603, 277126, 243307, 24825, 165401, 183796, 384072, 212702, 170541, 266750, 311262, 86545, 348629, 115162, 45592, 281075, 190006, 142602, 310418, 373947, 19682, 357810, 2078, 302369, 242151, 177574, 245936, 207916, 38941, 52176, 329834, 107193, 126831, 233632, 301674, 261596, 49781, 105434, 192425, 307140, 351764, 26935, 329869, 97972, 334240, 183790, 195955, 337625, 16174, 292298, 353700, 8402, 180413, 187097, 190270, 74321, 208383, 207935, 222088, 16220, 362714, 55364, 109807, 211334, 354625, 335634, 212017, 383719, 142745, 74558, 319788, 285387, 341456, 138672, 57500, 90822, 223714, 353035, 3525, 154559, 65358, 359476, 129495, 108137, 12554, 11011, 167248, 339774, 251150, 40311, 245012, 345265, 307414, 115274, 289238, 105694, 132813, 311702, 309384, 259912, 172688, 123457, 196619, 251101, 30643, 62467, 231280, 165753, 6449, 297177, 205438, 114624, 322843, 28632, 273894, 295919, 49770, 49469, 284507, 242558, 157386, 282116, 333064, 128469, 82113, 25706, 202995, 300918, 103524, 69165, 302031, 374902, 127365, 117727, 314350, 281102, 137197, 134402, 346138, 335200, 212753, 287628, 341506, 206288, 365793, 207699, 195624, 161257, 170222, 107825, 135287, 341964, 136611, 170645, 75497, 37133, 326792, 233124, 198994, 290375, 253868, 122591, 309672, 301669, 125707, 154239, 225108, 315546, 175099, 93787, 362652, 220809, 357202, 8661, 73317, 70949, 248176, 233793, 189538, 305383, 307268, 149371, 191533, 139086, 126648, 287657, 385556, 86689, 79814, 50871, 50740, 359613, 291569, 7612, 232040, 261901, 30292, 327563, 311363, 262242, 13187, 188333, 51070, 115101, 243846, 234609, 353640, 251010, 157562, 362643, 40539, 359201, 379742, 351241, 112304, 134909, 235657, 280827, 106583, 84387, 49724, 207108, 186927, 48688, 68729, 6146, 134057, 164696, 2242, 309748, 256499, 296099, 160287, 23789, 136139, 83123, 218342, 243516, 215861, 296742, 282103, 236978, 334158, 39401, 841, 305804, 231613, 139370, 228613, 84395, 37214, 186533, 339094, 10208, 16116, 197153, 37271, 216535, 55106, 305541, 14903, 154151, 309958, 256130, 191003, 214742, 171320, 374516, 76417, 142493, 207426, 252531, 128247, 229348, 283134, 48333, 16989, 167128, 273887, 117309, 292369, 225221]), (559403, [12985, 91177, 288653, 68212, 25150, 14397, 87433, 217471, 315812, 319911, 307202, 177172, 54386, 314086, 25323, 221730, 302247, 123630, 305991, 291341, 243769, 177486, 52478, 244143, 241705, 289658, 311604, 333259, 334187, 192716, 248603, 277126, 243307, 24825, 165401, 183796, 384072, 212702, 170541, 266750, 311262, 86545, 348629, 115162, 45592, 281075, 190006, 142602, 310418, 373947, 19682, 357810, 2078, 302369, 242151, 177574, 245936, 207916, 38941, 52176, 329834, 107193, 126831, 233632, 301674, 261596, 49781, 105434, 192425, 307140, 351764, 26935, 329869, 97972, 334240, 183790, 195955, 337625, 16174, 292298, 353700, 8402, 180413, 187097, 190270, 74321, 208383, 207935, 222088, 16220, 362714, 55364, 109807, 211334, 354625, 335634, 212017, 383719, 142745, 74558, 319788, 285387, 341456, 138672, 57500, 90822, 223714, 353035, 3525, 154559, 65358, 359476, 129495, 108137, 12554, 11011, 167248, 339774, 251150, 40311, 245012, 345265, 307414, 115274, 289238, 105694, 132813, 311702, 309384, 259912, 172688, 123457, 196619, 251101, 30643, 62467, 231280, 165753, 6449, 297177, 205438, 114624, 322843, 28632, 273894, 295919, 49770, 49469, 284507, 242558, 157386, 282116, 333064, 128469, 82113, 25706, 202995, 300918, 103524, 69165, 302031, 374902, 127365, 117727, 314350, 281102, 137197, 134402, 346138, 335200, 212753, 287628, 341506, 206288, 365793, 207699, 195624, 161257, 170222, 107825, 135287, 341964, 136611, 170645, 75497, 37133, 326792, 233124, 198994, 290375, 253868, 122591, 309672, 301669, 125707, 154239, 225108, 315546, 175099, 93787, 362652, 220809, 357202, 8661, 73317, 70949, 248176, 233793, 189538, 305383, 307268, 149371, 191533, 139086, 126648, 287657, 385556, 86689, 79814, 50871, 50740, 359613, 291569, 7612, 232040, 261901, 30292, 327563, 311363, 262242, 13187, 188333, 51070, 115101, 243846, 234609, 353640, 251010, 157562, 362643, 40539, 359201, 379742, 351241, 112304, 134909, 235657, 280827, 106583, 84387, 49724, 207108, 186927, 48688, 68729, 6146, 134057, 164696, 2242, 309748, 256499, 296099, 160287, 23789, 136139, 83123, 218342, 243516, 215861, 296742, 282103, 236978, 334158, 39401, 841, 305804, 231613, 139370, 228613, 84395, 37214, 186533, 339094, 10208, 16116, 197153, 37271, 216535, 55106, 305541, 14903, 154151, 309958, 256130, 191003, 214742, 171320, 374516, 76417, 142493, 207426, 252531, 128247, 229348, 283134, 48333, 16989, 167128, 273887, 117309, 292369, 225221, 363559, 384037, 116185, 343061, 82581, 212675, 268474, 326432, 239262, 349536, 332771, 350908, 126327, 111771, 191499, 283314, 189433, 318169, 1248, 25262, 324455, 168430, 305444, 47391, 5592, 205995, 328524, 170306, 183682, 196700, 345969, 101204, 340072, 301690, 354593, 123769, 71547, 186701, 279154, 189050, 316038, 330392, 98924, 182917, 27676, 369289, 121733, 148050, 345815, 314114, 516, 305496, 282298, 225153, 90106, 311933, 11631, 220520, 33438, 138010, 105213, 203463, 73369, 200171, 212852, 364051, 293778, 120304, 102034, 238581, 283244, 180175, 119433, 168618, 150684, 127276, 183720, 147248, 238410, 155424, 250930, 270288, 222878, 256263, 378274, 343182, 72314, 188549, 220731, 285257, 142382, 341073, 138136, 20801, 211200, 206229, 38470, 322987, 183998, 321930, 315425, 68826, 69259, 175675, 362235, 245704, 33534, 6982, 211749, 320522, 144511, 69487, 150116, 324981, 54368, 265420, 4947, 163838, 312416, 284759, 307668, 178571, 151596, 224878, 145952, 46477, 24622, 278861, 261783, 192089, 116409, 130077, 200091, 368622, 373848, 371071, 57825, 361137, 280794, 239676, 222672, 60252]), (721108, [12985, 91177, 288653, 68212, 25150, 14397, 87433, 217471, 315812, 319911, 307202, 177172, 54386, 314086, 25323, 221730, 302247, 123630, 305991, 291341, 243769, 177486, 52478, 244143, 241705, 289658, 311604, 333259, 334187, 192716, 248603, 277126, 243307, 24825, 165401, 183796, 384072, 212702, 170541, 266750, 311262, 86545, 348629, 115162, 45592, 281075, 190006, 142602, 310418, 373947, 19682, 357810, 2078, 302369, 242151, 177574, 245936, 207916, 38941, 52176, 329834, 107193, 126831, 233632, 301674, 261596, 49781, 105434, 192425, 307140, 351764, 26935, 329869, 97972, 334240, 183790, 195955, 337625, 16174, 292298, 353700, 8402, 180413, 187097, 190270, 74321, 208383, 207935, 222088, 16220, 362714, 55364, 109807, 211334, 354625, 335634, 212017, 383719, 142745, 74558, 319788, 285387, 341456, 138672, 57500, 90822, 223714, 353035, 3525, 154559, 65358, 359476, 129495, 108137, 12554, 11011, 167248, 339774, 251150, 40311, 245012, 345265, 307414, 115274, 289238, 105694, 132813, 311702, 309384, 259912, 172688, 123457, 196619, 251101, 30643, 62467, 231280, 165753, 6449, 297177, 205438, 114624, 322843, 28632, 273894, 295919, 49770, 49469, 284507, 242558, 157386, 282116, 333064, 128469, 82113, 25706, 202995, 300918, 103524, 69165, 302031, 374902, 127365, 117727, 314350, 281102, 137197, 134402, 346138, 335200, 212753, 287628, 341506, 206288, 365793, 207699, 195624, 161257, 170222, 107825, 135287, 341964, 136611, 170645, 75497, 37133, 326792, 233124, 198994, 290375, 253868, 122591, 309672, 301669, 125707, 154239, 225108, 315546, 175099, 93787, 362652, 220809, 357202, 8661, 73317, 70949, 248176, 233793, 189538, 305383, 307268, 149371, 191533, 139086, 126648, 287657, 385556, 86689, 79814, 50871, 50740, 359613, 291569, 7612, 232040, 261901, 30292, 327563, 311363, 262242, 13187, 188333, 51070, 115101, 243846, 234609, 353640, 251010, 157562, 362643, 40539, 359201, 379742, 351241, 112304, 134909, 235657, 280827, 106583, 84387, 49724, 207108, 186927, 48688, 68729, 6146, 134057, 164696, 2242, 309748, 256499, 296099, 160287, 23789, 136139, 83123, 218342, 243516, 215861, 296742, 282103, 236978, 334158, 39401, 841, 305804, 231613, 139370, 228613, 84395, 37214, 186533, 339094, 10208, 16116, 197153, 37271, 216535, 55106, 305541, 14903, 154151, 309958, 256130, 191003, 214742, 171320, 374516, 76417, 142493, 207426, 252531, 128247, 229348, 283134, 48333, 16989, 167128, 273887, 117309, 292369, 225221, 363559, 384037, 116185, 343061, 82581, 212675, 268474, 326432]), (241124, [12985, 91177, 288653, 68212, 25150, 14397, 87433, 217471, 315812, 319911, 307202, 177172, 54386, 314086, 25323, 221730, 302247, 123630, 305991, 291341, 243769, 177486, 52478, 244143, 241705, 289658, 311604, 333259, 334187, 192716, 248603, 277126, 243307, 24825, 165401, 183796, 384072, 212702, 170541, 266750, 311262, 86545, 348629, 115162, 45592, 281075, 190006, 142602, 310418, 373947, 19682, 357810, 2078, 302369, 242151, 177574, 245936, 207916, 38941, 52176, 329834, 107193, 126831, 233632, 301674, 261596, 49781, 105434, 192425, 307140, 351764, 26935, 329869, 97972, 334240, 183790, 195955, 337625, 16174, 292298, 353700, 8402, 180413, 187097, 190270, 74321, 208383, 207935, 222088, 16220, 362714, 55364, 109807, 211334, 354625, 335634, 212017, 383719, 142745, 74558, 319788, 285387, 341456, 138672, 57500, 90822, 223714, 353035, 3525, 154559, 65358, 359476, 129495, 108137, 12554, 11011, 167248, 339774, 251150, 40311, 245012, 345265, 307414, 115274, 289238, 105694, 132813, 311702, 309384, 259912, 172688, 123457, 196619, 251101, 30643, 62467, 231280, 165753, 6449, 297177, 205438, 114624, 322843, 28632, 273894, 295919, 49770, 49469, 284507, 242558, 157386, 282116, 333064, 128469, 82113, 25706, 202995, 300918, 103524, 69165, 302031, 374902, 127365, 117727, 314350, 281102, 137197, 134402, 346138, 335200, 212753, 287628, 341506, 206288, 365793, 207699, 195624, 161257, 170222, 107825, 135287, 341964, 136611, 170645, 75497, 37133, 326792, 233124, 198994, 290375, 253868, 122591, 309672, 301669, 125707, 154239, 225108, 315546, 175099, 93787, 362652, 220809, 357202, 8661, 73317, 70949, 248176, 233793, 189538, 305383, 307268, 149371, 191533, 139086, 126648, 287657, 385556, 86689, 79814, 50871, 50740, 359613, 291569, 7612, 232040, 261901, 30292, 327563, 311363, 262242, 13187, 188333, 51070, 115101, 243846, 234609, 353640, 251010, 157562]), (562909, [12985, 91177, 288653, 68212, 25150, 14397, 87433, 217471, 315812, 319911, 307202, 177172, 54386, 314086, 25323, 221730, 302247, 123630, 305991, 291341, 243769, 177486, 52478, 244143, 241705, 289658, 311604, 333259, 334187, 192716, 248603, 277126, 243307, 24825, 165401, 183796, 384072, 212702, 170541, 266750, 311262, 86545, 348629, 115162, 45592, 281075, 190006, 142602, 310418, 373947, 19682, 357810, 2078, 302369, 242151, 177574, 245936, 207916, 38941, 52176, 329834, 107193, 126831, 233632, 301674, 261596, 49781, 105434, 192425, 307140, 351764, 26935, 329869, 97972, 334240, 183790, 195955, 337625, 16174, 292298, 353700, 8402, 180413, 187097, 190270, 74321, 208383, 207935, 222088, 16220, 362714, 55364, 109807, 211334, 354625, 335634, 212017, 383719, 142745, 74558, 319788]), (798643, [12985, 91177, 288653, 68212, 25150, 14397, 87433, 217471, 315812, 319911, 307202, 177172, 54386, 314086, 25323, 221730, 302247, 123630, 305991, 291341, 243769, 177486, 52478, 244143, 241705, 289658, 311604, 333259, 334187, 192716, 248603, 277126, 243307, 24825, 165401, 183796, 384072, 212702, 170541, 266750, 311262, 86545, 348629, 115162, 45592, 281075, 190006, 142602, 310418, 373947, 19682, 357810, 2078, 302369, 242151, 177574, 245936, 207916, 38941, 52176, 329834, 107193, 126831, 233632, 301674, 261596, 49781, 105434, 192425, 307140, 351764, 26935, 329869, 97972, 334240, 183790, 195955, 337625, 16174, 292298, 353700, 8402, 180413, 187097, 190270, 74321, 208383, 207935, 222088, 16220, 362714, 55364, 109807, 211334, 354625, 335634, 212017, 383719, 142745, 74558, 319788, 285387, 341456, 138672, 57500, 90822, 223714, 353035, 3525, 154559, 65358, 359476, 129495, 108137, 12554, 11011, 167248, 339774, 251150, 40311, 245012, 345265, 307414, 115274, 289238, 105694, 132813, 311702, 309384, 259912, 172688, 123457, 196619, 251101, 30643, 62467, 231280, 165753, 6449, 297177, 205438, 114624, 322843, 28632, 273894, 295919, 49770, 49469, 284507, 242558, 157386, 282116, 333064, 128469, 82113, 25706, 202995, 300918, 103524, 69165, 302031, 374902, 127365, 117727, 314350, 281102, 137197, 134402, 346138, 335200, 212753, 287628, 341506, 206288, 365793, 207699, 195624, 161257, 170222, 107825, 135287, 341964, 136611, 170645, 75497, 37133, 326792, 233124, 198994, 290375, 253868, 122591, 309672, 301669, 125707, 154239, 225108, 315546, 175099, 93787, 362652, 220809, 357202, 8661, 73317, 70949, 248176, 233793, 189538, 305383, 307268, 149371, 191533, 139086, 126648, 287657, 385556, 86689, 79814, 50871, 50740, 359613, 291569, 7612, 232040, 261901, 30292, 327563, 311363, 262242, 13187, 188333, 51070, 115101, 243846, 234609, 353640, 251010, 157562, 362643, 40539, 359201, 379742, 351241, 112304])]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1.481598072605E12,"submitTime":1.481598006642E12,"finishTime":1.481598149006E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0dadfe63-a76b-4c81-8fe1-c00594e37428"},{"version":"CommandV1","origId":809,"guid":"8d787023-b4db-4b2b-92f2-5466dff7cfce","subtype":"command","commandType":"auto","position":28.5,"command":"# Remove songs already in user history\nproduct_history_by_user = test_by_users_split\\\n  .map(lambda x: (x[0], [pair[0] for pair in x[1][0]]))\npredictions_and_history = predictions_by_user.join(product_history_by_user)\npredictions = predictions_and_history.map(lambda x: (x[0], [s for s in x[1][0] if s not in x[1][1]]))\n\n# Join predictions and hidden by user keys\npredictions_and_labels = predictions_by_user.join(test_hidden_by_users).map(lambda x: x[1])\n\n# Get mAP\nfrom pyspark.mllib.evaluation import RankingMetrics\nmetrics = RankingMetrics(predictions_and_labels)\nmAP = metrics.meanAveragePrecision\nprint mAP\n#return (fold_i, mAP)\n  \n\n# from multiprocessing.pool import ThreadPool\n# tpool = ThreadPool(processes=n_folds)\n\n# mAP_scores = tpool.map(perform_cv, range(5))\n# print mAP_scores","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">0.0830430782727\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1.48159883611E12,"submitTime":1.481598624096E12,"finishTime":1.481598915157E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3487e920-8d36-4355-a13d-1895031023ce"},{"version":"CommandV1","origId":773,"guid":"ccd513b9-112e-4951-b5fb-7abd13039d39","subtype":"command","commandType":"auto","position":32.0,"command":"# Question: Do historical items still exist in prediction?\n\nuser_id = test_users[0]\n# Get the predictions and history of a user\npreds_and_hist =  predictions_and_history.filter(lambda x: x[0] == user_id).collect()[0]\npreds = preds_and_hist[1][0]\nhist = preds_and_hist[1][1]\n\nprint 'all predictions'\nfor p in preds:\n  if p in hist:\n    print p # these should be removed in final predictions\n\n# Get predictions after history was removed\npreds_new = predictions.filter(lambda x: x[0] == user_id).collect()[0][1]\n\nprint 'new predictions'\nfor p in preds_new:\n  if p in hist:\n    print p","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">all predictions\n64813\n226512\n50027\nnew predictions\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">AttributeError</span>: &apos;list&apos; object has no attribute &apos;take&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AttributeError</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-13-5b84536c6a96&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansired\"># Question: Do historical items still exist in prediction?</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      2</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 3</span><span class=\"ansiyellow\"> </span>user_id <span class=\"ansiyellow\">=</span> test_users<span class=\"ansiyellow\">.</span>take<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      4</span> <span class=\"ansired\"># Get the predictions and history of a user</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      5</span> preds_and_hist <span class=\"ansiyellow\">=</span>  predictions_and_history<span class=\"ansiyellow\">.</span>filter<span class=\"ansiyellow\">(</span><span class=\"ansigreen\">lambda</span> x<span class=\"ansiyellow\">:</span> x<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">0</span><span class=\"ansiyellow\">]</span> <span class=\"ansiyellow\">==</span> user_id<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>collect<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">0</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AttributeError</span>: &apos;list&apos; object has no attribute &apos;take&apos;\n</div>","workflows":[],"startTime":1.481584963502E12,"submitTime":1.481584966934E12,"finishTime":1.481584984888E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"73113723-c44a-496b-9d03-2baf05b6f7d1"}],"dashboards":[],"guid":"6af24297-5270-4427-81f3-f1f9fed2f0d8","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}};</script>
<script
 src="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/js/notebook-main.js"
 onerror="window.mainJsLoadError = true;"></script>
<script>var tableOfContentsCell = {"version":"CommandV1","origId":0,"guid":"58faffe8-bc79-4720-a1a5-3552306aad34","subtype":"command","commandType":"auto","position":0.0,"command":"%md [&lsaquo; Back to Table of Contents](../index.html)","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{}};</script>
</head>
<body>
  <script>
if (window.mainJsLoadError) {
  var u = 'https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/js/notebook-main.js';
  var b = document.getElementsByTagName('body')[0];
  var c = document.createElement('div');
  c.innerHTML = ('<h1>Network Error</h1>' +
    '<p><b>Please check your network connection and try again.</b></p>' +
    '<p>Could not load a required resource: ' + u + '</p>');
  c.style.margin = '30px';
  c.style.padding = '20px 50px';
  c.style.backgroundColor = '#f5f5f5';
  c.style.borderRadius = '5px';
  b.appendChild(c);
}
</script>
</body>
</html>