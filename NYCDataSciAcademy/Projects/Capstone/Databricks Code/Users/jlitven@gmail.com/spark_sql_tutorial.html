<!DOCTYPE html>
<html>
<head>
  <meta name="databricks-html-version" content="1">
<title>jlitven@gmail.com / spark_sql_tutorial - Databricks</title>

<meta charset="utf-8">
<meta name="google" content="notranslate">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=UTF8">
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700">

<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/lib/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/lib/jquery-ui-bundle/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/css/main.css">
<link rel="stylesheet" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/css/print.css" media="print">
<link rel="icon" type="image/png" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/img/favicon.ico"/>
<script>window.settings = {"enableSshKeyUI":true,"enableAutoCompleteAsYouType":[],"devTierName":"Community Edition","workspaceFeaturedLinks":[{"linkURI":"https://docs.databricks.com/index.html","displayName":"Documentation","icon":"question"},{"linkURI":"https://docs.databricks.com/release-notes/product/latest.html","displayName":"Release Notes","icon":"code"},{"linkURI":"https://docs.databricks.com/spark/latest/training/index.html","displayName":"Training & Tutorials","icon":"graduation-cap"}],"enableClearStateFeature":false,"dbcForumURL":"http://forums.databricks.com/","maxCustomTags":45,"enableInstanceProfilesUIInJobs":true,"nodeInfo":{"node_types":[{"spark_heap_memory":21145,"instance_type_id":"r3.xlarge","node_type_id":"r3.xlarge","description":"r3.xlarge (beta)","support_cluster_tags":true,"container_memory_mb":26432,"memory_mb":31232,"category":"Memory Optimized","num_cores":4.0,"support_ebs_volumes":true},{"spark_heap_memory":46131,"instance_type_id":"r3.2xlarge","node_type_id":"r3.2xlarge","description":"r3.2xlarge (beta)","support_cluster_tags":true,"container_memory_mb":57664,"memory_mb":62464,"category":"Memory Optimized","num_cores":8.0,"support_ebs_volumes":true},{"spark_heap_memory":96102,"instance_type_id":"r3.4xlarge","node_type_id":"r3.4xlarge","description":"r3.4xlarge (beta)","support_cluster_tags":true,"container_memory_mb":120128,"memory_mb":124928,"category":"Memory Optimized","num_cores":16.0,"support_ebs_volumes":true},{"spark_heap_memory":196044,"instance_type_id":"r3.8xlarge","node_type_id":"r3.8xlarge","description":"r3.8xlarge (beta)","support_cluster_tags":true,"container_memory_mb":245056,"memory_mb":249856,"category":"Memory Optimized","num_cores":32.0,"support_ebs_volumes":true},{"spark_heap_memory":8448,"instance_type_id":"c3.2xlarge","node_type_id":"c3.2xlarge","description":"c3.2xlarge (beta)","support_cluster_tags":true,"container_memory_mb":10560,"memory_mb":15360,"category":"Compute Optimized","num_cores":8.0,"support_ebs_volumes":true},{"spark_heap_memory":20736,"instance_type_id":"c3.4xlarge","node_type_id":"c3.4xlarge","description":"c3.4xlarge (beta)","support_cluster_tags":true,"container_memory_mb":25920,"memory_mb":30720,"category":"Compute Optimized","num_cores":16.0,"support_ebs_volumes":true},{"spark_heap_memory":45312,"instance_type_id":"c3.8xlarge","node_type_id":"c3.8xlarge","description":"c3.8xlarge (beta)","support_cluster_tags":true,"container_memory_mb":56640,"memory_mb":61440,"category":"Compute Optimized","num_cores":32.0,"support_ebs_volumes":true},{"spark_heap_memory":21145,"instance_type_id":"i2.xlarge","node_type_id":"i2.xlarge","description":"i2.xlarge (beta)","support_cluster_tags":true,"container_memory_mb":26432,"memory_mb":31232,"category":"Storage Optimized","num_cores":4.0,"support_ebs_volumes":true},{"spark_heap_memory":46131,"instance_type_id":"i2.2xlarge","node_type_id":"i2.2xlarge","description":"i2.2xlarge (beta)","support_cluster_tags":true,"container_memory_mb":57664,"memory_mb":62464,"category":"Storage Optimized","num_cores":8.0,"support_ebs_volumes":true},{"spark_heap_memory":96102,"instance_type_id":"i2.4xlarge","node_type_id":"i2.4xlarge","description":"i2.4xlarge (beta)","support_cluster_tags":true,"container_memory_mb":120128,"memory_mb":124928,"category":"Storage Optimized","num_cores":16.0,"support_ebs_volumes":true},{"spark_heap_memory":196044,"instance_type_id":"i2.8xlarge","node_type_id":"i2.8xlarge","description":"i2.8xlarge (beta)","support_cluster_tags":true,"container_memory_mb":245056,"memory_mb":249856,"category":"Storage Optimized","num_cores":32.0,"support_ebs_volumes":true},{"spark_heap_memory":23800,"instance_type_id":"r3.2xlarge","node_type_id":"memory-optimized","description":"Memory Optimized","support_cluster_tags":false,"container_memory_mb":28000,"memory_mb":30720,"category":"Memory Optimized","num_cores":4.0,"support_ebs_volumes":false},{"spark_heap_memory":9702,"instance_type_id":"c3.4xlarge","node_type_id":"compute-optimized","description":"Compute Optimized","support_cluster_tags":false,"container_memory_mb":12128,"memory_mb":15360,"category":"Compute Optimized","num_cores":8.0,"support_ebs_volumes":false}],"default_node_type_id":"memory-optimized"},"enableThirdPartyApplicationsUI":false,"enableClusterAcls":true,"notebookRevisionVisibilityHorizon":0,"enableTableHandler":true,"maxEbsVolumesPerInstance":10,"isAdmin":true,"deltaProcessingBatchSize":1000,"enableLargeResultDownload":true,"zoneInfos":[{"id":"us-east-1e","isDefault":true},{"id":"us-east-1b","isDefault":false},{"id":"us-east-1c","isDefault":false},{"id":"us-east-1d","isDefault":false}],"enableEBSVolumesUIForJobs":true,"enablePublishNotebooks":false,"enableMaxConcurrentRuns":false,"enableJobAclsConfig":true,"enableFullTextSearch":true,"enableElasticSparkUI":true,"enableNewClustersCreate":false,"clusters":true,"allowRunOnPendingClusters":true,"applications":false,"fileStoreBase":"FileStore","enableSshKeyUIInJobs":true,"enableDetachAndAttachSubMenu":false,"configurableSparkOptionsSpec":[{"keyPattern":"spark\\.kryo(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.kryo.*","valuePatternDisplay":"*","description":"Configuration options for Kryo serialization"},{"keyPattern":"spark\\.io\\.compression\\.codec","valuePattern":"(lzf|snappy|org\\.apache\\.spark\\.io\\.LZFCompressionCodec|org\\.apache\\.spark\\.io\\.SnappyCompressionCodec)","keyPatternDisplay":"spark.io.compression.codec","valuePatternDisplay":"snappy|lzf","description":"The codec used to compress internal data such as RDD partitions, broadcast variables and shuffle outputs."},{"keyPattern":"spark\\.serializer","valuePattern":"(org\\.apache\\.spark\\.serializer\\.JavaSerializer|org\\.apache\\.spark\\.serializer\\.KryoSerializer)","keyPatternDisplay":"spark.serializer","valuePatternDisplay":"org.apache.spark.serializer.JavaSerializer|org.apache.spark.serializer.KryoSerializer","description":"Class to use for serializing objects that will be sent over the network or need to be cached in serialized form."},{"keyPattern":"spark\\.rdd\\.compress","valuePattern":"(true|false)","keyPatternDisplay":"spark.rdd.compress","valuePatternDisplay":"true|false","description":"Whether to compress serialized RDD partitions (e.g. for StorageLevel.MEMORY_ONLY_SER). Can save substantial space at the cost of some extra CPU time."},{"keyPattern":"spark\\.speculation","valuePattern":"(true|false)","keyPatternDisplay":"spark.speculation","valuePatternDisplay":"true|false","description":"Whether to use speculation (recommended off for streaming)"},{"keyPattern":"spark\\.es(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"es(\\.([^\\.]+))+","valuePattern":".*","keyPatternDisplay":"es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"spark\\.(storage|shuffle)\\.memoryFraction","valuePattern":"0?\\.0*([1-9])([0-9])*","keyPatternDisplay":"spark.(storage|shuffle).memoryFraction","valuePatternDisplay":"(0.0,1.0)","description":"Fraction of Java heap to use for Spark's shuffle or storage"},{"keyPattern":"spark\\.streaming\\.backpressure\\.enabled","valuePattern":"(true|false)","keyPatternDisplay":"spark.streaming.backpressure.enabled","valuePatternDisplay":"true|false","description":"Enables or disables Spark Streaming's internal backpressure mechanism (since 1.5). This enables the Spark Streaming to control the receiving rate based on the current batch scheduling delays and processing times so that the system receives only as fast as the system can process. Internally, this dynamically sets the maximum receiving rate of receivers. This rate is upper bounded by the values `spark.streaming.receiver.maxRate` and `spark.streaming.kafka.maxRatePerPartition` if they are set."},{"keyPattern":"spark\\.streaming\\.receiver\\.maxRate","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.receiver.maxRate","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which each receiver will receive data. Effectively, each stream will consume at most this number of records per second. Setting this configuration to 0 or a negative number will put no limit on the rate. See the deployment guide in the Spark Streaming programing guide for mode details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRatePerPartition","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRatePerPartition","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which data will be read from each Kafka partition when using the Kafka direct stream API introduced in Spark 1.3. See the Kafka Integration guide for more details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRetries","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRetries","valuePatternDisplay":"numeric","description":"Maximum number of consecutive retries the driver will make in order to find the latest offsets on the leader of each partition (a default value of 1 means that the driver will make a maximum of 2 attempts). Only applies to the Kafka direct stream API introduced in Spark 1.3."},{"keyPattern":"spark\\.streaming\\.ui\\.retainedBatches","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.ui.retainedBatches","valuePatternDisplay":"numeric","description":"How many batches the Spark Streaming UI and status APIs remember before garbage collecting."}],"enableReactNotebookComments":true,"enableAdminPasswordReset":true,"enableResetPassword":true,"maxClusterTagValueLength":255,"enableJobsSparkUpgrade":true,"sparkVersions":[{"key":"1.6.x-ubuntu15.10","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"1.4.x-ubuntu15.10","displayName":"Spark 1.4.1 (Hadoop 1)","packageLabel":"spark-image-f710650fb8aaade8e4e812368ea87c45cd8cd0b5e6894ca6c94f3354e8daa6dc","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.0-ubuntu15.10-scala2.10","displayName":"Spark 2.0.0 (Scala 2.10)","packageLabel":"spark-image-073c1b52ace74f251fae2680624a0d8d184a8b57096d1c21c5ce56c29be6a37a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db1-scala2.11","displayName":"Spark 2.1.0 RC5 (Scala 2.11)","packageLabel":"spark-image-20833506f690f3a49c53fb08837cb9b98f7f2e15380f1fb26efc158d953e94c8","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.x-ubuntu15.10-hadoop1","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"1.6.1-ubuntu15.10-hadoop1","displayName":"Spark 1.6.1 (Hadoop 1)","packageLabel":"spark-image-21d1cac181b7b8856dd1b4214a3a734f95b5289089349db9d9c926cb87d843db","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.x-gpu-scala2.11","displayName":"Spark 2.0 (Auto-updating, GPU, Scala 2.11 experimental)","packageLabel":"spark-image-6c2dd678fff350c03ba0e945bab52d0080cd857a39c99a22131b3e824bb8096f","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.2-ubuntu15.10-hadoop1","displayName":"Spark 1.6.2 (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.3-db1-hadoop2-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 2, Scala 2.10)","packageLabel":"spark-image-eaa8d9b990015a14e032fb2e2e15be0b8d5af9627cd01d855df728b67969d5d9","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.2-ubuntu15.10-hadoop2","displayName":"Spark 1.6.2 (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.1-ubuntu15.10-hadoop2","displayName":"Spark 1.6.1 (Hadoop 2)","packageLabel":"spark-image-4cafdf8bc6cba8edad12f441e3b3f0a8ea27da35c896bc8290e16b41fd15496a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db2-scala2.10","displayName":"Spark 2.0.2-db2 (Scala 2.10)","packageLabel":"spark-image-36d48f22cca7a907538e07df71847dd22aaf84a852c2eeea2dcefe24c681602f","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.x-ubuntu15.10-scala2.11","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.11, deprecated)","packageLabel":"spark-image-8e1c50d626a52eac5a6c8129e09ae206ba9890f4523775f77af4ad6d99a64c44","upgradable":true,"deprecated":true,"customerVisible":true},{"key":"2.0.x-scala2.10","displayName":"Spark 2.0 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-4f22a8d3016bc3dce9e839b10418815a7d28afff3a027b43bd2b041c42b2a89d","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db1-scala2.11","displayName":"Spark 2.0.2-db1 (Scala 2.11)","packageLabel":"spark-image-c2d623f03dd44097493c01aa54a941fc31978ebe6d759b36c75b716b2ff6ab9c","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.5.x-ubuntu15.10","displayName":"Spark 1.5.2 (Hadoop 1)","packageLabel":"spark-image-c9d2a8abf41f157a4acc6d52bc721090346f6fea2de356f3a66e388f54481698","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.x-scala2.11","displayName":"Spark 2.0 (Auto-updating, Scala 2.11)","packageLabel":"spark-image-596490ba3e0ca4b62abb048923fc70de84e319cf527bb7a5a8f609bbf780bed8","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db2-scala2.11","displayName":"Spark 2.0.2-db2 (Scala 2.11)","packageLabel":"spark-image-4fa852ba378e97815083b96c9cada7b962a513ec23554a5fc849f7f1dd8c065a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.3.x-ubuntu15.10","displayName":"Spark 1.3.0 (Hadoop 1)","packageLabel":"spark-image-40d2842670bc3dc178b14042501847d76171437ccf70613fa397a7a24c48b912","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.1-db1-scala2.11","displayName":"Spark 2.0.1-db1 (Scala 2.11)","packageLabel":"spark-image-10ab19f634bbfdb860446c326a9f76dc25bfa87de6403b980566279142a289ea","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.3-db1-hadoop1-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 1, Scala 2.10)","packageLabel":"spark-image-d50af1032799546b8ccbeeb76889a20c819ebc2a0e68ea20920cb30d3895d3ae","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db1-scala2.10","displayName":"Spark 2.0.2-db1 (Scala 2.10)","packageLabel":"spark-image-654bdd6e9bad70079491987d853b4b7abf3b736fff099701501acaabe0e75c41","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.x-ubuntu15.10","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.10, deprecated)","packageLabel":"spark-image-a659f3909d51b38d297b20532fc807ecf708cfb7440ce9b090c406ab0c1e4b7e","upgradable":true,"deprecated":true,"customerVisible":true},{"key":"2.0.1-db1-scala2.10","displayName":"Spark 2.0.1-db1 (Scala 2.10)","packageLabel":"spark-image-5a13c2db3091986a4e7363006cc185c5b1108c7761ef5d0218506cf2e6643840","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db1-scala2.10","displayName":"Spark 2.1.0 RC5 (Scala 2.10)","packageLabel":"spark-image-f430b652793cbc27e454dc629737ae2bc04b75a1fecd68a5d90c44eca7543756","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.0-ubuntu15.10","displayName":"Spark 1.6.0 (Hadoop 1)","packageLabel":"spark-image-10ef758029b8c7e19cd7f4fb52fff9180d75db92ca071bd94c47f3c1171a7cb5","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.x-ubuntu15.10-hadoop2","displayName":"Spark 1.6.x (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"2.0.0-ubuntu15.10-scala2.11","displayName":"Spark 2.0.0 (Scala 2.11)","packageLabel":"spark-image-b4ec141e751f201399f8358a82efee202560f7ed05e1a04a2ae8778f6324b909","upgradable":true,"deprecated":false,"customerVisible":true}],"enableRestrictedClusterCreation":false,"enableFeedback":true,"enableClusterAutoScaling":true,"enableUserVisibleDefaultTags":false,"defaultNumWorkers":8,"serverContinuationTimeoutMillis":10000,"driverStderrFilePrefix":"stderr","enableNotebookRefresh":true,"accountsOwnerUrl":"https://accounts.cloud.databricks.com/registration.html#login","driverStdoutFilePrefix":"stdout","defaultNodeTypeToPricingUnitsMap":{"r3.2xlarge":2,"class-node":1,"p2.8xlarge":16,"r3.8xlarge":8,"dev-tier-node":1,"c3.8xlarge":4,"r3.4xlarge":4,"i2.4xlarge":6,"development-node":1,"i2.2xlarge":3,"g2.8xlarge":6,"memory-optimized":1,"p2.16xlarge":24,"c3.2xlarge":1,"c4.2xlarge":1,"i2.xlarge":1.5,"compute-optimized":1,"c4.4xlarge":2,"c3.4xlarge":2,"g2.2xlarge":1.5,"p2.xlarge":2,"c4.8xlarge":4,"r3.xlarge":1,"i2.8xlarge":12},"enableSparkDocsSearch":true,"sparkHistoryServerEnabled":true,"enableEBSVolumesUI":true,"sanitizeMarkdownHtml":true,"enableIPythonImportExport":true,"enableClusterTagsUIForJobs":false,"enableClusterTagsUI":false,"enableNotebookHistoryDiffing":true,"branch":"2.33.220","accountsLimit":-1,"enableX509Authentication":false,"enableNotebookGitBranching":true,"local":false,"enableClusterAutoScalingForJobs":false,"enableStrongPassword":false,"displayDefaultContainerMemoryGB":30,"disableS3TableImport":false,"deploymentMode":"production","useSpotForWorkers":true,"enableUserInviteWorkflow":true,"enableStaticNotebooks":true,"enableCssTransitions":true,"minClusterTagKeyLength":1,"showHomepageFeaturedLinks":true,"pricingURL":"https://databricks.com/product/pricing","enableClusterAclsConfig":true,"useTempS3UrlForTableUpload":false,"notifyLastLogin":false,"enableNotebookGitVersioning":true,"files":"files/","feedbackEmail":"support@databricks.com","enableDriverLogsUI":true,"disableLegacyDashboards":false,"enableWorkspaceAclsConfig":true,"dropzoneMaxFileSize":4096,"enableNewClustersList":false,"enableNewDashboardViews":true,"driverLog4jFilePrefix":"log4j","enableSingleSignOn":true,"enableMavenLibraries":true,"displayRowLimit":1000,"deltaProcessingAsyncEnabled":true,"defaultSparkVersion":{"key":"2.0.x-scala2.10","displayName":"Spark 2.0 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-4f22a8d3016bc3dce9e839b10418815a7d28afff3a027b43bd2b041c42b2a89d","upgradable":true,"deprecated":false,"customerVisible":true},"enableCustomSpotPricing":true,"enableMountAclsConfig":false,"useDevTierHomePage":false,"enablePublishHub":false,"notebookHubUrl":"http://hub.dev.databricks.com/","showSqlEndpoints":true,"enableClusterAclsByTier":true,"databricksDocsBaseUrl":"https://docs.databricks.com/","disallowAddingAdmins":false,"enableSparkConfUI":true,"featureTier":"UNKNOWN_TIER","enableOrgSwitcherUI":false,"clustersLimit":-1,"enableJdbcImport":true,"logfiles":"logfiles/","enableWebappSharding":false,"enableClusterDeltaUpdates":true,"enableSingleSignOnLogin":false,"ebsVolumeSizeLimitGB":{"GENERAL_PURPOSE_SSD":[100,4096],"THROUGHPUT_OPTIMIZED_HDD":[500,4096]},"enableMountAcls":false,"requireEmailUserName":true,"enableDashboardViews":false,"dbcFeedbackURL":"http://feedback.databricks.com/forums/263785-product-feedback","enableMountAclService":true,"enableWorkspaceAcls":true,"maxClusterTagKeyLength":127,"gitHash":"8719902676c4e1cefbc31755c1726979bdf286d0","showWorkspaceFeaturedLinks":true,"signupUrl":"https://databricks.com/try-databricks","allowFeedbackForumAccess":true,"enableImportFromUrl":true,"enableMiniClusters":false,"enableDebugUI":false,"allowNonAdminUsers":true,"enableSingleSignOnByTier":true,"enableJobsRetryOnTimeout":true,"staticNotebookResourceUrl":"https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/","enableSparkPackages":true,"dynamicSparkVersions":true,"enableNotebookHistoryUI":true,"showDebugCounters":false,"enableInstanceProfilesUI":true,"enableFolderHtmlExport":true,"enableSparkVersionsUI":true,"homepageFeaturedLinks":[{"linkURI":"https://docs.databricks.com/_static/notebooks/gentle-introduction-to-apache-spark.html","displayName":"Introduction to Apache Spark on Databricks","icon":"img/home/Python_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/databricks-for-data-scientists.html","displayName":"Databricks for Data Scientists","icon":"img/home/Scala_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/structured-streaming-python.html","displayName":"Introduction to Structured Streaming","icon":"img/home/Python_icon.svg"}],"upgradeURL":"","notebookLoadingBackground":"#fff","sshContainerForwardedPort":2200,"enableServerAutoComplete":true,"enableStaticHtmlImport":true,"enableInstanceProfilesByTier":true,"enableTerminal":false,"defaultMemoryPerContainerMB":28000,"enablePresenceUI":true,"accounts":true,"useFramedStaticNotebooks":false,"enableNewProgressReportUI":true,"defaultCoresPerContainer":4,"enableNewClustersGet":false,"showSqlProxyUI":true};</script>
<script>var __DATABRICKS_NOTEBOOK_MODEL = {"version":"NotebookV1","origId":180,"name":"jlitven@gmail.com / spark_sql_tutorial","language":"python","commands":[{"version":"CommandV1","origId":182,"guid":"0cb7fa09-fb53-4491-909a-420f410c9e6d","subtype":"command","commandType":"auto","position":0.0,"command":"%md <img src=\"http://spark-mooc.github.io/web-assets/images/ta_Spark-logo-small.png\" align=left>\n<img src=\"http://spark-mooc.github.io/web-assets/images/python-logo-master-v3-TM-flattened_small.png\" align=left>","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"6e9b3902-e64c-40ec-8db1-90e1295f2208"},{"version":"CommandV1","origId":183,"guid":"e2c68b32-37a4-41cd-a257-50c016d9c2da","subtype":"command","commandType":"auto","position":1.0,"command":"%md # **Spark Tutorial: Spark SQL and DataFrames**\n\n## 0. Overview\n\nSpark SQL is a Spark module for structured data processing. Unlike the basic Spark RDD API, the interfaces provided by Spark SQL provide Spark with more information about the structure of both the data and the computation being performed. Internally, Spark SQL uses this extra information to perform extra optimizations. \n\nThere are several ways to interact with Spark SQL including SQL and the Dataset API. When computing a result the same execution engine is used, independent of which API/language you are using to express the computation. This unification means that developers can easily switch back and forth between different APIs based on which provides the most natural way to express a given transformation.\n\n### 0.1 SQL\n\nOne use of Spark SQL is to execute SQL queries. Spark SQL can also be used to read data from an existing Hive installation. When running SQL from within another programming language the results will be returned as a DataFrame.\n\n### 0.2 DataFrames\n\nA DataFrame is conceptually equivalent to a table in a relational database or a data frame in R/Python, but with richer optimizations under the hood. \n\nDataFrames can be constructed from a wide array of sources such as: structured data files, tables in Hive, external databases, or existing RDDs. The DataFrame API is available in Scala, Java, Python, and R. ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"1442d8a6-3971-422b-9b14-ff13e8cb2538"},{"version":"CommandV1","origId":184,"guid":"010d3689-ca4f-45f6-b8a2-71291583a3de","subtype":"command","commandType":"auto","position":2.0,"command":"# Run this cell to setup data path\nimport os\n\ndatapath = os.getcwd()\nif datapath.find('databricks') != -1:\n    ACCESS_KEY = \"AKIAI2P5MSEO2JYXJVQQ\"\n    SECRET_KEY = \"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\"\n    AWS_BUCKET_NAME = \"nycdsabootcamp\"\n    datapath = \"s3a://%s:%s@%s/\" %(ACCESS_KEY, SECRET_KEY, AWS_BUCKET_NAME)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481209155493E12,"submitTime":1.481209155374E12,"finishTime":1.481209155534E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":true},"streamStates":{},"nuid":"90353dc0-58ee-4445-b2da-029eae07f8ea"},{"version":"CommandV1","origId":185,"guid":"63b3b230-02c8-4d9c-bb49-283aeafe38f7","subtype":"command","commandType":"auto","position":3.0,"command":"%md ## 1. Starting Point: SparkSession\n\n`SparkSession` is the entry point to programming Spark with the DataFrame API.\n\nSparkSession in Spark 2.0 provides builtin support for Hive features including the ability to write queries using HiveQL, access to Hive UDFs, and the ability to read data from Hive tables. To use these features, you do not need to have an existing Hive setup.\n\nIn pyspark, `spark` is an existing `SparkSession`.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"9712127f-2443-4896-a934-bfc3ef69e435"},{"version":"CommandV1","origId":186,"guid":"b14af6ea-5412-402b-8bfb-7fa8b20a2e52","subtype":"command","commandType":"auto","position":4.0,"command":"print type(spark)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">&lt;class &apos;pyspark.sql.session.SparkSession&apos;&gt;\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481209158841E12,"submitTime":1.481209158727E12,"finishTime":1.481209158912E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":true},"streamStates":{},"nuid":"f193b60e-1897-45dd-abd9-7062d11fef6e"},{"version":"CommandV1","origId":187,"guid":"89526914-609f-40f9-8759-836ac6f4e324","subtype":"command","commandType":"auto","position":5.0,"command":"%md If launching applications with spark-submit, then we need to create a basic SparkSession using `SparkSession.builder()`:","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"e310e235-8c4b-41e8-ac0c-9f9014b82036"},{"version":"CommandV1","origId":188,"guid":"2b9c65a7-c60f-443f-8a08-37ecb51a68f4","subtype":"command","commandType":"auto","position":6.0,"command":"# Don't Run!\n\nspark = SparkSession\\\n    .builder\\\n    .appName(\"PythonSQL\")\\\n    .config(\"spark.some.config.option\", \"some-value\")\\\n    .getOrCreate()","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":true},"streamStates":{},"nuid":"cb4c41ef-2c81-4cbb-b617-9baaeeef2742"},{"version":"CommandV1","origId":189,"guid":"a26717a5-07ab-4d30-b06c-d40509e53774","subtype":"command","commandType":"auto","position":7.0,"command":"%md ## 2. Working with DataFrames","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"c6739299-7588-450f-9cc4-e4213f7f53fc"},{"version":"CommandV1","origId":190,"guid":"13be3e00-f75b-4621-883c-24183e0c0ca8","subtype":"command","commandType":"auto","position":8.0,"command":"%md `DataFrames` can be constructed from a wide array of sources such as: structured data files, tables in Hive, external databases, or existing RDDs.\n\nHere we will be using the file `./ml-100k/u.user` as an example to illustrate how we can create a DataFrame from an existing RDD. \n\nThe column names are: `userId | age | gender | occupation | zipCode`.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"e9191794-ad40-4aa4-82c0-49a5ed1d16be"},{"version":"CommandV1","origId":191,"guid":"0e0b29d5-a1cd-43f7-9162-9f6b1a732392","subtype":"command","commandType":"auto","position":9.0,"command":"filepath = os.path.join(datapath, \"./ml-100k/u.user\")\n\nuserRDD = sc.textFile(filepath)\nprint userRDD.take(2)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">[u&apos;1|24|M|technician|85711&apos;, u&apos;2|53|F|other|94043&apos;]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.48120916117E12,"submitTime":1.481209161048E12,"finishTime":1.481209164389E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":true},"streamStates":{},"nuid":"aeba95fa-8c1c-4fc2-96b9-89ae155fba96"},{"version":"CommandV1","origId":192,"guid":"99aef4e6-34e5-41d7-96e2-96fe8c4ca879","subtype":"command","commandType":"auto","position":10.0,"command":"parts = userRDD.map(lambda l: l.split(\"|\"))\nprint parts.take(2)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">[[u&apos;1&apos;, u&apos;24&apos;, u&apos;M&apos;, u&apos;technician&apos;, u&apos;85711&apos;], [u&apos;2&apos;, u&apos;53&apos;, u&apos;F&apos;, u&apos;other&apos;, u&apos;94043&apos;]]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481209164402E12,"submitTime":1.481209164141E12,"finishTime":1.481209166717E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":true},"streamStates":{},"nuid":"f4e63b33-e06f-4530-a813-a6595bff5d44"},{"version":"CommandV1","origId":193,"guid":"471f2684-28af-46d6-a555-5600965a1959","subtype":"command","commandType":"auto","position":11.0,"command":"%md ### 2.1. Interoperating with RDDs\n\nSpark SQL supports two different methods for converting existing RDDs into DataFrames. \n\n* uses reflection to infer the schema of an RDD that contains specific types of objects. \n\n* through a programmatic interface that allows you to construct a schema and then apply it to an existing RDD.\n\n**Inferring the Schema Using Reflection**","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"e91e6996-0329-4e0c-9f82-c2c15840324b"},{"version":"CommandV1","origId":194,"guid":"7108d49b-e6e6-481a-994c-93f6b7c51fc5","subtype":"command","commandType":"auto","position":12.0,"command":"# spark is an existing SparkSession.\nfrom pyspark.sql import Row\n\n# Convert each line to a Row.\nuser = parts.map(lambda p: Row(userId=int(p[0]), \n                               age=int(p[1]),\n                               gender=p[2],\n                               occupation=p[3],\n                               zipCode=p[4]))\n\n# Infer the schema.\nuserDF = spark.createDataFrame(user)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481209172011E12,"submitTime":1.48120917184E12,"finishTime":1.481209172446E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":true},"streamStates":{},"nuid":"c22336e8-4919-4f6f-b91a-bfcd3fcb403e"},{"version":"CommandV1","origId":195,"guid":"cfc7b654-9715-45f0-8b11-e796c0a2f7e4","subtype":"command","commandType":"auto","position":13.0,"command":"# Once a DataFrame has been created, we can check it's schema.\nuserDF.printSchema()\n\n# Instead of using take(), a better way is to use show() to display the first few rows.\nuserDF.show(5)\n\n# DataFrame.dgtypes returns a list of tuples that contains the datatype of each column object.\nprint userDF.dtypes","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">root\n |-- age: long (nullable = true)\n |-- gender: string (nullable = true)\n |-- occupation: string (nullable = true)\n |-- userId: long (nullable = true)\n |-- zipCode: string (nullable = true)\n\n+---+------+----------+------+-------+\n|age|gender|occupation|userId|zipCode|\n+---+------+----------+------+-------+\n| 24|     M|technician|     1|  85711|\n| 53|     F|     other|     2|  94043|\n| 23|     M|    writer|     3|  32067|\n| 24|     M|technician|     4|  43537|\n| 33|     F|     other|     5|  15213|\n+---+------+----------+------+-------+\nonly showing top 5 rows\n\n[(&apos;age&apos;, &apos;bigint&apos;), (&apos;gender&apos;, &apos;string&apos;), (&apos;occupation&apos;, &apos;string&apos;), (&apos;userId&apos;, &apos;bigint&apos;), (&apos;zipCode&apos;, &apos;string&apos;)]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481209323833E12,"submitTime":1.481209323731E12,"finishTime":1.481209325244E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"203e987b-f1f1-4483-afe5-5861014dfdf1"},{"version":"CommandV1","origId":196,"guid":"c2f47f08-8458-4ddb-917f-cbc11aae098d","subtype":"command","commandType":"auto","position":14.0,"command":"%md **Programmatically Specifying the Schema**","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"a82dc882-7888-4464-94ae-2ad81aad736e"},{"version":"CommandV1","origId":197,"guid":"67ddc2b2-63c9-4b51-b161-cec94c26f4fd","subtype":"command","commandType":"auto","position":15.0,"command":"from pyspark.sql.types import *\n\nuserSchema = StructType([StructField(\"userId\", IntegerType(), True),\n                         StructField(\"age\", IntegerType(), True),\n                         StructField(\"gender\", StringType(), True),\n                         StructField(\"occupation\", StringType(), True),\n                         StructField(\"zipCode\", StringType(), True)]) # Note: some zipCodes are strings","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481209623515E12,"submitTime":1.481209623398E12,"finishTime":1.481209623554E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"9e434737-6aac-44ae-9bcb-587a218923e5"},{"version":"CommandV1","origId":198,"guid":"d1adc8c5-0825-4279-9a12-d2eab1f29582","subtype":"command","commandType":"auto","position":16.0,"command":"typedPart = parts.map(lambda p: (int(p[0]), int(p[1]), p[2], p[3], p[4]))\nuserDFb = spark.createDataFrame(typedPart, userSchema)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481209802225E12,"submitTime":1.481209802119E12,"finishTime":1.481209802298E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":true},"streamStates":{},"nuid":"20a7c953-9e1d-4e15-b63d-38c54274f1aa"},{"version":"CommandV1","origId":199,"guid":"21adb413-b66c-423d-9fb1-7c799582a128","subtype":"command","commandType":"auto","position":17.0,"command":"userDFb.printSchema()\nuserDFb.show(5)","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"1ecc9ebc-953d-4887-aab9-dbc78687ccaa"},{"version":"CommandV1","origId":200,"guid":"a605bbe9-61a4-4dfa-be61-83f6a53fb25a","subtype":"command","commandType":"auto","position":18.0,"command":"%md ### Exercise 1\n\nThe u.data contains 100000 ratings by 943 users on 1682 items:\n\n* path=\"./ml-100k/u.data\"\n* column name: userId | itemId | rating | timestamp\n* sample row: u'196\\t242\\t3\\t881250949'\n  \n1.1 Create a DataFrame called `ratingDF` with the `u.data` file from the `path` above.\n\n1.2 Show schema and the first 5 rows of `ratingDF`.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"20a6d5ff-8723-4d69-bb0b-730ac2536ea5"},{"version":"CommandV1","origId":201,"guid":"654a5651-f272-41da-96ea-2935cd7d3933","subtype":"command","commandType":"auto","position":19.0,"command":"# Your code goes here\n\nratingPath = os.path.join(datapath, \"./ml-100k/u.data\")\n\n# 1.1\nratingRDD = sc.textFile(ratingPath).map(lambda l: l.split(\"\\t\"))\nprint ratingRDD.take(2)\nratings = ratingRDD.map(lambda p: Row(userId=int(p[0]),\n                                      itemId = int(p[1]),\n                                      rating=int(p[2]),\n                                      timestamp=int(p[3])))\nratingsDF = spark.createDataFrame(ratings)\n\n# 1.2 \nratingsDF.printSchema()\n\nratingsDF.show(5)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">[[u&apos;196&apos;, u&apos;242&apos;, u&apos;3&apos;, u&apos;881250949&apos;], [u&apos;186&apos;, u&apos;302&apos;, u&apos;3&apos;, u&apos;891717742&apos;]]\nroot\n |-- itemId: long (nullable = true)\n |-- rating: long (nullable = true)\n |-- timestamp: long (nullable = true)\n |-- userId: long (nullable = true)\n\n+------+------+---------+------+\n|itemId|rating|timestamp|userId|\n+------+------+---------+------+\n|   242|     3|881250949|   196|\n|   302|     3|891717742|   186|\n|   377|     1|878887116|    22|\n|    51|     2|880606923|   244|\n|   346|     1|886397596|   166|\n+------+------+---------+------+\nonly showing top 5 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">AttributeError</span>: &apos;PipelinedRDD&apos; object has no attribute &apos;createDataFrame&apos;","error":"<div class=\"ansiout\">[[u&apos;196&apos;, u&apos;242&apos;, u&apos;3&apos;, u&apos;881250949&apos;], [u&apos;186&apos;, u&apos;302&apos;, u&apos;3&apos;, u&apos;891717742&apos;]]\n<span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AttributeError</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-15-b27ad940789c&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">     10</span>                                       rating<span class=\"ansiyellow\">=</span>int<span class=\"ansiyellow\">(</span>p<span class=\"ansiyellow\">[</span><span class=\"ansicyan\">2</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     11</span>                                       timestamp=p[3]))\n<span class=\"ansigreen\">---&gt; 12</span><span class=\"ansiyellow\"> </span>ratingsDF <span class=\"ansiyellow\">=</span> ratings<span class=\"ansiyellow\">.</span>createDataFrame<span class=\"ansiyellow\">(</span>ratings<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     13</span> <span class=\"ansired\"># 1.2</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AttributeError</span>: &apos;PipelinedRDD&apos; object has no attribute &apos;createDataFrame&apos;\n</div>","workflows":[],"startTime":1.48121407425E12,"submitTime":1.481214074214E12,"finishTime":1.481214077064E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"4166f29d-5d28-40df-9205-e1f5c6cdf1d8"},{"version":"CommandV1","origId":202,"guid":"3d641794-bfa4-4181-b272-50180df13218","subtype":"command","commandType":"auto","position":20.0,"command":"%md ### 2.2 DataFrames Operations\n\nHere we will perform some basic DataFrames operations in pyspark. For a complete list of the types of operations that can be performed on a DataFrame refer to the [API Documentation](http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.DataFrame).","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"55dbd48c-4539-47d5-8ae4-31040bced3ca"},{"version":"CommandV1","origId":203,"guid":"2c3109fb-b6a4-4fd1-83b5-f305e0153d78","subtype":"command","commandType":"auto","position":21.0,"command":"%md `columns` returns all column names as a list.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"bd78bb19-57ae-4cf0-9e28-83c7d521c261"},{"version":"CommandV1","origId":204,"guid":"dfc503ec-51b8-4a4e-b86c-a031ea9d3f7d","subtype":"command","commandType":"auto","position":22.0,"command":"userDF.columns","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">19</span><span class=\"ansired\">]: </span>[&apos;age&apos;, &apos;gender&apos;, &apos;occupation&apos;, &apos;userId&apos;, &apos;zipCode&apos;]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481210698844E12,"submitTime":1.481210698767E12,"finishTime":1.481210698915E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"33127d2e-5b1a-4a47-9356-929148cbd3e4"},{"version":"CommandV1","origId":205,"guid":"f1457fec-deb6-461a-8148-61db6da14e0d","subtype":"command","commandType":"auto","position":23.0,"command":"%md `describe(*cols)`\nshows statistics for numeric columns. This include count, mean, stddev, min, and max.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"4e7a6dbd-ff2b-4779-ad70-7b58f3ff8ec7"},{"version":"CommandV1","origId":206,"guid":"76bd542f-e8bf-403e-bed3-3fc2305514b8","subtype":"command","commandType":"auto","position":24.0,"command":"userDF.describe().show()","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+-------+-----------------+-----------------+\n|summary|              age|           userId|\n+-------+-----------------+-----------------+\n|  count|              943|              943|\n|   mean|34.05196182396607|            472.0|\n| stddev|12.19273973305903|272.3649512449549|\n|    min|                7|                1|\n|    max|               73|              943|\n+-------+-----------------+-----------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481210759029E12,"submitTime":1.481210758958E12,"finishTime":1.481210761445E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"5f947d14-19b8-4525-ba8e-938a22d511f8"},{"version":"CommandV1","origId":207,"guid":"0632e590-4bc5-417a-9664-7a1fe6d887fc","subtype":"command","commandType":"auto","position":25.0,"command":"%md **Selection**\n\nselect(*cols)\nprojects a set of expressions and returns a new DataFrame.\n\ndrop(col)\nreturns a new DataFrame that drops the specified column.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"3f06d6c3-6f33-4c90-9381-a7e48bea34f6"},{"version":"CommandV1","origId":208,"guid":"aca80156-bb50-4b87-b14b-6f9ed85038f8","subtype":"command","commandType":"auto","position":26.0,"command":"# cols can be column names or column objects\n# in the following example \"userId\" is column name\n# userDF.gender and userDF[\"occupation\"] are both column objects\nuserDF.select(\"userId\", userDF.gender, userDF[\"age\"]).show(5)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+------+------+---+\n|userId|gender|age|\n+------+------+---+\n|     1|     M| 24|\n|     2|     F| 53|\n|     3|     M| 23|\n|     4|     M| 24|\n|     5|     F| 33|\n+------+------+---+\nonly showing top 5 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481211263334E12,"submitTime":1.481211263275E12,"finishTime":1.481211263907E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"9c4d883b-f547-4182-a637-7c95682f573a"},{"version":"CommandV1","origId":209,"guid":"1fa3abc2-efe2-4cb0-9b4e-36b59850f2f4","subtype":"command","commandType":"auto","position":27.0,"command":"userDF.drop(\"zipCode\").show(5)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---+------+----------+------+\n|age|gender|occupation|userId|\n+---+------+----------+------+\n| 24|     M|technician|     1|\n| 53|     F|     other|     2|\n| 23|     M|    writer|     3|\n| 24|     M|technician|     4|\n| 33|     F|     other|     5|\n+---+------+----------+------+\nonly showing top 5 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481211267391E12,"submitTime":1.481211267335E12,"finishTime":1.481211267963E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"d5f85d2b-6cf7-4851-a0d0-8c67daa5b9e1"},{"version":"CommandV1","origId":210,"guid":"93c97ee4-0625-4ad4-bb51-294cad59c499","subtype":"command","commandType":"auto","position":28.0,"command":"# When using column object, we can also apply operations on it very easily.\n\n# cast(dataType) convert the column into type dataType.\n# between(lowerBound, upperBound) returns true if the value of this \n# expression is between the given columns.\n\nuserDF.select(userDF[\"userId\"].cast(\"string\"), userDF[\"age\"].between(20, 40)).show(5)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+------+-----------------------------+\n|userId|((age &gt;= 20) AND (age &lt;= 40))|\n+------+-----------------------------+\n|     1|                         true|\n|     2|                        false|\n|     3|                         true|\n|     4|                         true|\n|     5|                         true|\n+------+-----------------------------+\nonly showing top 5 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481212132559E12,"submitTime":1.481212132499E12,"finishTime":1.481212134971E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"c0cf8f2d-3cb0-426e-9434-850a1fef107b"},{"version":"CommandV1","origId":211,"guid":"34b5b1d8-5674-40c8-9ca4-a605b5772789","subtype":"command","commandType":"auto","position":29.0,"command":"%md Although there's no difference to access a DataFrames columns either by attribute (df.age) or by indexing (df['age']), users are highly encouraged to use the latter form, which is future proof and wont break with column names that are also attributes on the DataFrame class.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"0345e6c6-0458-4bb6-a300-edb78ca2441f"},{"version":"CommandV1","origId":212,"guid":"5e582543-fa28-4336-95fe-0f33ef666cbd","subtype":"command","commandType":"auto","position":30.0,"command":"%md **Filter**\n\nfilter(condition)\nfilters rows using the given condition.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"7cc4f322-d868-42ca-84ce-29be94feac57"},{"version":"CommandV1","origId":213,"guid":"bb391abe-c204-4661-b02c-7a2978fb3023","subtype":"command","commandType":"auto","position":31.0,"command":"# using a Column of types.BooleanType as condition\nuserDF.filter(userDF[\"occupation\"] == \"programmer\").show(5)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---+------+----------+------+-------+\n|age|gender|occupation|userId|zipCode|\n+---+------+----------+------+-------+\n| 30|     M|programmer|    17|  06355|\n| 41|     M|programmer|    29|  94043|\n| 29|     M|programmer|    45|  50233|\n| 26|     M|programmer|    53|  55414|\n| 37|     M|programmer|    55|  01331|\n+---+------+----------+------+-------+\nonly showing top 5 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481212255613E12,"submitTime":1.481212255565E12,"finishTime":1.481212256036E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"628862cc-4852-4968-9435-32342c5ac4de"},{"version":"CommandV1","origId":214,"guid":"8211b1ee-343c-42ae-8b72-269604294ae6","subtype":"command","commandType":"auto","position":32.0,"command":"# using a string of SQL expression\nuserDF.filter(\"age between 20 and 40\").show(5)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---+------+-------------+------+-------+\n|age|gender|   occupation|userId|zipCode|\n+---+------+-------------+------+-------+\n| 24|     M|   technician|     1|  85711|\n| 23|     M|       writer|     3|  32067|\n| 24|     M|   technician|     4|  43537|\n| 33|     F|        other|     5|  15213|\n| 36|     M|administrator|     8|  05201|\n+---+------+-------------+------+-------+\nonly showing top 5 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481212411922E12,"submitTime":1.481212411864E12,"finishTime":1.481212412394E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"55589e41-a31f-4a1b-9bb1-9225f968e39b"},{"version":"CommandV1","origId":215,"guid":"39a10134-f1fb-4219-88bf-fcddda80a5b0","subtype":"command","commandType":"auto","position":33.0,"command":"%md **Grouping and Aggregation**\n\n`groupBy(*cols)`\ngroups the DataFrame using the specified columns, so we can run aggregation on them.\n\nThe available aggregation functions include:\n* `avg(*cols)`\n* `count()`\n* `max(*cols)`\n* `min(*cols)`\n* `sum(*cols)`","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"68ee3933-a4ad-4c55-9e6f-1b3b2053d61b"},{"version":"CommandV1","origId":216,"guid":"1007bc57-3755-422f-9e5a-9089fa1eb120","subtype":"command","commandType":"auto","position":34.0,"command":"userDF.groupBy(userDF[\"occupation\"]).avg(\"age\").show(10)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+----------+------------------+\n|occupation|          avg(age)|\n+----------+------------------+\n| librarian|              40.0|\n|   retired| 63.07142857142857|\n|    lawyer|             36.75|\n|      none|26.555555555555557|\n|    writer| 36.31111111111111|\n|programmer|33.121212121212125|\n| marketing| 37.61538461538461|\n|     other|34.523809523809526|\n| executive|          38.71875|\n| scientist| 35.54838709677419|\n+----------+------------------+\nonly showing top 10 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481212521017E12,"submitTime":1.481212520977E12,"finishTime":1.481212523533E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"328e930c-4054-4fb7-af98-df188f44ba99"},{"version":"CommandV1","origId":217,"guid":"b8f2d405-94e0-4951-96f1-af3395560109","subtype":"command","commandType":"auto","position":35.0,"command":"%md We can also use `agg(*exprs)` to compute multiple aggregates and returns the result as a DataFrame. `exprs` can be a dict mapping from column name (string) to aggregate functions (string),\n\nThe available aggregate functions are `avg`, `max`, `min`, `sum`, `count`.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"3be3039e-9b78-4794-ba39-db090bbe062f"},{"version":"CommandV1","origId":218,"guid":"44a12cbb-9c31-4c0b-8d5f-9ef92ca2d019","subtype":"command","commandType":"auto","position":36.0,"command":"userDF.groupBy(\"gender\").agg({\"age\":\"avg\", \"*\":\"count\"}).show()","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+------+--------+------------------+\n|gender|count(1)|          avg(age)|\n+------+--------+------------------+\n|     F|     273| 33.81318681318681|\n|     M|     670|34.149253731343286|\n+------+--------+------------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481212583589E12,"submitTime":1.481212583526E12,"finishTime":1.481212584803E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"db131d8b-8936-452e-a58b-2efc5b0094a7"},{"version":"CommandV1","origId":219,"guid":"f6610172-c127-40f2-b75d-49e328ca7445","subtype":"command","commandType":"auto","position":37.0,"command":"%md ### Exercise 2\n\n2.1 Find all the movies that have average ratings greater than 4.0.\n\n2.2 Find all the movies that have average ratings greater than 4.0 and have recieved more than 400 reviews.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"0cab4b5d-2f56-48f8-a9cd-8c09e046fe69"},{"version":"CommandV1","origId":220,"guid":"846575fc-21dc-4b19-b7ed-60c1f67ef20e","subtype":"command","commandType":"auto","position":38.0,"command":"# Your code goes here\n\n# 2.1\nratingsDF.groupBy(\"itemId\")\\\n  .avg(\"rating\")\\\n  .filter(\"avg(rating) > 4.0\").show()\n\n# 2.2\nratingsDF.groupBy(\"itemId\")\\\n  .agg({\"rating\":\"avg\", \"*\":\"count\"})\\\n  .filter(\"avg(rating) > 4.0 AND count(1) > 400\")\\\n  .show()","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+------+------------------+\n|itemId|       avg(rating)|\n+------+------------------+\n|   474| 4.252577319587629|\n|   191| 4.163043478260869|\n|  1642|               4.5|\n|  1594|               4.5|\n|   113| 4.111111111111111|\n|  1599|               5.0|\n|   198|4.0078740157480315|\n|    22| 4.151515151515151|\n|   530|             4.025|\n|   427| 4.292237442922374|\n|   487| 4.102941176470588|\n|    50|4.3584905660377355|\n|  1064|              4.25|\n|   190| 4.137096774193548|\n|   275|4.0111940298507465|\n|   136| 4.123809523809523|\n|   513| 4.333333333333333|\n|   963|4.2926829268292686|\n|   119|               4.5|\n|    98|  4.28974358974359|\n+------+------------------+\nonly showing top 20 rows\n\n+------+------------------+--------+\n|itemId|       avg(rating)|count(1)|\n+------+------------------+--------+\n|    50|4.3584905660377355|     583|\n|   181| 4.007889546351085|     507|\n|   174| 4.252380952380952|     420|\n|   100| 4.155511811023622|     508|\n|   127| 4.283292978208232|     413|\n+------+------------------+--------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">ParseException</span>: u&quot;\\nextraneous input &apos;4.0&apos; expecting {&lt;EOF&gt;, &apos;(&apos;, &apos;.&apos;, &apos;[&apos;, &apos;SELECT&apos;, &apos;FROM&apos;, &apos;ADD&apos;, &apos;AS&apos;, &apos;ALL&apos;, &apos;DISTINCT&apos;, &apos;WHERE&apos;, &apos;GROUP&apos;, &apos;BY&apos;, &apos;GROUPING&apos;, &apos;SETS&apos;, &apos;CUBE&apos;, &apos;ROLLUP&apos;, &apos;ORDER&apos;, &apos;HAVING&apos;, &apos;LIMIT&apos;, &apos;AT&apos;, &apos;OR&apos;, &apos;AND&apos;, &apos;IN&apos;, NOT, &apos;NO&apos;, &apos;EXISTS&apos;, &apos;BETWEEN&apos;, &apos;LIKE&apos;, RLIKE, &apos;IS&apos;, &apos;NULL&apos;, &apos;TRUE&apos;, &apos;FALSE&apos;, &apos;NULLS&apos;, &apos;ASC&apos;, &apos;DESC&apos;, &apos;FOR&apos;, &apos;INTERVAL&apos;, &apos;CASE&apos;, &apos;WHEN&apos;, &apos;THEN&apos;, &apos;ELSE&apos;, &apos;END&apos;, &apos;JOIN&apos;, &apos;CROSS&apos;, &apos;OUTER&apos;, &apos;INNER&apos;, &apos;LEFT&apos;, &apos;SEMI&apos;, &apos;RIGHT&apos;, &apos;FULL&apos;, &apos;NATURAL&apos;, &apos;ON&apos;, &apos;LATERAL&apos;, &apos;WINDOW&apos;, &apos;OVER&apos;, &apos;PARTITION&apos;, &apos;RANGE&apos;, &apos;ROWS&apos;, &apos;UNBOUNDED&apos;, &apos;PRECEDING&apos;, &apos;FOLLOWING&apos;, &apos;CURRENT&apos;, &apos;ROW&apos;, &apos;WITH&apos;, &apos;VALUES&apos;, &apos;CREATE&apos;, &apos;TABLE&apos;, &apos;VIEW&apos;, &apos;REPLACE&apos;, &apos;INSERT&apos;, &apos;DELETE&apos;, &apos;INTO&apos;, &apos;DESCRIBE&apos;, &apos;EXPLAIN&apos;, &apos;FORMAT&apos;, &apos;LOGICAL&apos;, &apos;CODEGEN&apos;, &apos;CAST&apos;, &apos;SHOW&apos;, &apos;TABLES&apos;, &apos;COLUMNS&apos;, &apos;COLUMN&apos;, &apos;USE&apos;, &apos;PARTITIONS&apos;, &apos;FUNCTIONS&apos;, &apos;DROP&apos;, &apos;UNION&apos;, &apos;EXCEPT&apos;, &apos;INTERSECT&apos;, &apos;TO&apos;, &apos;TABLESAMPLE&apos;, &apos;STRATIFY&apos;, &apos;ALTER&apos;, &apos;RENAME&apos;, &apos;ARRAY&apos;, &apos;MAP&apos;, &apos;STRUCT&apos;, &apos;COMMENT&apos;, &apos;SET&apos;, &apos;RESET&apos;, &apos;DATA&apos;, &apos;START&apos;, &apos;TRANSACTION&apos;, &apos;COMMIT&apos;, &apos;ROLLBACK&apos;, &apos;MACRO&apos;, &apos;IF&apos;, EQ, &apos;&lt;=&gt;&apos;, &apos;&lt;&gt;&apos;, &apos;!=&apos;, &apos;&lt;&apos;, LTE, &apos;&gt;&apos;, GTE, &apos;+&apos;, &apos;-&apos;, &apos;*&apos;, &apos;/&apos;, &apos;%&apos;, &apos;DIV&apos;, &apos;&amp;&apos;, &apos;|&apos;, &apos;^&apos;, &apos;PERCENT&apos;, &apos;BUCKET&apos;, &apos;OUT&apos;, &apos;OF&apos;, &apos;SORT&apos;, &apos;CLUSTER&apos;, &apos;DISTRIBUTE&apos;, &apos;OVERWRITE&apos;, &apos;TRANSFORM&apos;, &apos;REDUCE&apos;, &apos;USING&apos;, &apos;SERDE&apos;, &apos;SERDEPROPERTIES&apos;, &apos;RECORDREADER&apos;, &apos;RECORDWRITER&apos;, &apos;DELIMITED&apos;, &apos;FIELDS&apos;, &apos;TERMINATED&apos;, &apos;COLLECTION&apos;, &apos;ITEMS&apos;, &apos;KEYS&apos;, &apos;ESCAPED&apos;, &apos;LINES&apos;, &apos;SEPARATED&apos;, &apos;FUNCTION&apos;, &apos;EXTENDED&apos;, &apos;REFRESH&apos;, &apos;CLEAR&apos;, &apos;CACHE&apos;, &apos;UNCACHE&apos;, &apos;LAZY&apos;, &apos;FORMATTED&apos;, TEMPORARY, &apos;OPTIONS&apos;, &apos;UNSET&apos;, &apos;TBLPROPERTIES&apos;, &apos;DBPROPERTIES&apos;, &apos;BUCKETS&apos;, &apos;SKEWED&apos;, &apos;STORED&apos;, &apos;DIRECTORIES&apos;, &apos;LOCATION&apos;, &apos;EXCHANGE&apos;, &apos;ARCHIVE&apos;, &apos;UNARCHIVE&apos;, &apos;FILEFORMAT&apos;, &apos;TOUCH&apos;, &apos;COMPACT&apos;, &apos;CONCATENATE&apos;, &apos;CHANGE&apos;, &apos;CASCADE&apos;, &apos;RESTRICT&apos;, &apos;CLUSTERED&apos;, &apos;SORTED&apos;, &apos;PURGE&apos;, &apos;INPUTFORMAT&apos;, &apos;OUTPUTFORMAT&apos;, DATABASE, DATABASES, &apos;DFS&apos;, &apos;TRUNCATE&apos;, &apos;ANALYZE&apos;, &apos;COMPUTE&apos;, &apos;LIST&apos;, &apos;STATISTICS&apos;, &apos;PARTITIONED&apos;, &apos;EXTERNAL&apos;, &apos;DEFINED&apos;, &apos;REVOKE&apos;, &apos;GRANT&apos;, &apos;LOCK&apos;, &apos;UNLOCK&apos;, &apos;MSCK&apos;, &apos;REPAIR&apos;, &apos;RECOVER&apos;, &apos;EXPORT&apos;, &apos;IMPORT&apos;, &apos;LOAD&apos;, &apos;ROLE&apos;, &apos;ROLES&apos;, &apos;COMPACTIONS&apos;, &apos;PRINCIPALS&apos;, &apos;TRANSACTIONS&apos;, &apos;INDEX&apos;, &apos;INDEXES&apos;, &apos;LOCKS&apos;, &apos;OPTION&apos;, &apos;ANTI&apos;, &apos;LOCAL&apos;, &apos;INPATH&apos;, &apos;CURRENT_DATE&apos;, &apos;CURRENT_TIMESTAMP&apos;, IDENTIFIER, BACKQUOTED_IDENTIFIER}(line 1, pos 12)\\n\\n== SQL ==\\navg(rating) 4.0\\n------------^^^\\n&quot;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">ParseException</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-36-90130c84b0c4&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      5</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      6</span> <span class=\"ansired\"># 2.2</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 7</span><span class=\"ansiyellow\"> </span>ratingsDF<span class=\"ansiyellow\">.</span>groupBy<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;itemId&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>agg<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">{</span><span class=\"ansiblue\">&quot;rating&quot;</span><span class=\"ansiyellow\">:</span><span class=\"ansiblue\">&quot;avg&quot;</span><span class=\"ansiyellow\">,</span> <span class=\"ansiblue\">&quot;*&quot;</span><span class=\"ansiyellow\">:</span><span class=\"ansiblue\">&quot;count&quot;</span><span class=\"ansiyellow\">}</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>filter<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;avg(rating) 4.0&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/dataframe.py</span> in <span class=\"ansicyan\">filter</span><span class=\"ansiblue\">(self, condition)</span>\n<span class=\"ansigreen\">    914</span>         &quot;&quot;&quot;\n<span class=\"ansigreen\">    915</span>         <span class=\"ansigreen\">if</span> isinstance<span class=\"ansiyellow\">(</span>condition<span class=\"ansiyellow\">,</span> basestring<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 916</span><span class=\"ansiyellow\">             </span>jdf <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>_jdf<span class=\"ansiyellow\">.</span>filter<span class=\"ansiyellow\">(</span>condition<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    917</span>         <span class=\"ansigreen\">elif</span> isinstance<span class=\"ansiyellow\">(</span>condition<span class=\"ansiyellow\">,</span> Column<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    918</span>             jdf <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>_jdf<span class=\"ansiyellow\">.</span>filter<span class=\"ansiyellow\">(</span>condition<span class=\"ansiyellow\">.</span>_jc<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.3-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">   1131</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1132</span>         return_value = get_return_value(\n<span class=\"ansigreen\">-&gt; 1133</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">   1134</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1135</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.py</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     71</span>                 <span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     72</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.catalyst.parser.ParseException: &apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 73</span><span class=\"ansiyellow\">                 </span><span class=\"ansigreen\">raise</span> ParseException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     74</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.streaming.StreamingQueryException: &apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     75</span>                 <span class=\"ansigreen\">raise</span> StreamingQueryException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">ParseException</span>: u&quot;\\nextraneous input &apos;4.0&apos; expecting {&lt;EOF&gt;, &apos;(&apos;, &apos;.&apos;, &apos;[&apos;, &apos;SELECT&apos;, &apos;FROM&apos;, &apos;ADD&apos;, &apos;AS&apos;, &apos;ALL&apos;, &apos;DISTINCT&apos;, &apos;WHERE&apos;, &apos;GROUP&apos;, &apos;BY&apos;, &apos;GROUPING&apos;, &apos;SETS&apos;, &apos;CUBE&apos;, &apos;ROLLUP&apos;, &apos;ORDER&apos;, &apos;HAVING&apos;, &apos;LIMIT&apos;, &apos;AT&apos;, &apos;OR&apos;, &apos;AND&apos;, &apos;IN&apos;, NOT, &apos;NO&apos;, &apos;EXISTS&apos;, &apos;BETWEEN&apos;, &apos;LIKE&apos;, RLIKE, &apos;IS&apos;, &apos;NULL&apos;, &apos;TRUE&apos;, &apos;FALSE&apos;, &apos;NULLS&apos;, &apos;ASC&apos;, &apos;DESC&apos;, &apos;FOR&apos;, &apos;INTERVAL&apos;, &apos;CASE&apos;, &apos;WHEN&apos;, &apos;THEN&apos;, &apos;ELSE&apos;, &apos;END&apos;, &apos;JOIN&apos;, &apos;CROSS&apos;, &apos;OUTER&apos;, &apos;INNER&apos;, &apos;LEFT&apos;, &apos;SEMI&apos;, &apos;RIGHT&apos;, &apos;FULL&apos;, &apos;NATURAL&apos;, &apos;ON&apos;, &apos;LATERAL&apos;, &apos;WINDOW&apos;, &apos;OVER&apos;, &apos;PARTITION&apos;, &apos;RANGE&apos;, &apos;ROWS&apos;, &apos;UNBOUNDED&apos;, &apos;PRECEDING&apos;, &apos;FOLLOWING&apos;, &apos;CURRENT&apos;, &apos;ROW&apos;, &apos;WITH&apos;, &apos;VALUES&apos;, &apos;CREATE&apos;, &apos;TABLE&apos;, &apos;VIEW&apos;, &apos;REPLACE&apos;, &apos;INSERT&apos;, &apos;DELETE&apos;, &apos;INTO&apos;, &apos;DESCRIBE&apos;, &apos;EXPLAIN&apos;, &apos;FORMAT&apos;, &apos;LOGICAL&apos;, &apos;CODEGEN&apos;, &apos;CAST&apos;, &apos;SHOW&apos;, &apos;TABLES&apos;, &apos;COLUMNS&apos;, &apos;COLUMN&apos;, &apos;USE&apos;, &apos;PARTITIONS&apos;, &apos;FUNCTIONS&apos;, &apos;DROP&apos;, &apos;UNION&apos;, &apos;EXCEPT&apos;, &apos;INTERSECT&apos;, &apos;TO&apos;, &apos;TABLESAMPLE&apos;, &apos;STRATIFY&apos;, &apos;ALTER&apos;, &apos;RENAME&apos;, &apos;ARRAY&apos;, &apos;MAP&apos;, &apos;STRUCT&apos;, &apos;COMMENT&apos;, &apos;SET&apos;, &apos;RESET&apos;, &apos;DATA&apos;, &apos;START&apos;, &apos;TRANSACTION&apos;, &apos;COMMIT&apos;, &apos;ROLLBACK&apos;, &apos;MACRO&apos;, &apos;IF&apos;, EQ, &apos;&lt;=&gt;&apos;, &apos;&lt;&gt;&apos;, &apos;!=&apos;, &apos;&lt;&apos;, LTE, &apos;&gt;&apos;, GTE, &apos;+&apos;, &apos;-&apos;, &apos;*&apos;, &apos;/&apos;, &apos;%&apos;, &apos;DIV&apos;, &apos;&amp;&apos;, &apos;|&apos;, &apos;^&apos;, &apos;PERCENT&apos;, &apos;BUCKET&apos;, &apos;OUT&apos;, &apos;OF&apos;, &apos;SORT&apos;, &apos;CLUSTER&apos;, &apos;DISTRIBUTE&apos;, &apos;OVERWRITE&apos;, &apos;TRANSFORM&apos;, &apos;REDUCE&apos;, &apos;USING&apos;, &apos;SERDE&apos;, &apos;SERDEPROPERTIES&apos;, &apos;RECORDREADER&apos;, &apos;RECORDWRITER&apos;, &apos;DELIMITED&apos;, &apos;FIELDS&apos;, &apos;TERMINATED&apos;, &apos;COLLECTION&apos;, &apos;ITEMS&apos;, &apos;KEYS&apos;, &apos;ESCAPED&apos;, &apos;LINES&apos;, &apos;SEPARATED&apos;, &apos;FUNCTION&apos;, &apos;EXTENDED&apos;, &apos;REFRESH&apos;, &apos;CLEAR&apos;, &apos;CACHE&apos;, &apos;UNCACHE&apos;, &apos;LAZY&apos;, &apos;FORMATTED&apos;, TEMPORARY, &apos;OPTIONS&apos;, &apos;UNSET&apos;, &apos;TBLPROPERTIES&apos;, &apos;DBPROPERTIES&apos;, &apos;BUCKETS&apos;, &apos;SKEWED&apos;, &apos;STORED&apos;, &apos;DIRECTORIES&apos;, &apos;LOCATION&apos;, &apos;EXCHANGE&apos;, &apos;ARCHIVE&apos;, &apos;UNARCHIVE&apos;, &apos;FILEFORMAT&apos;, &apos;TOUCH&apos;, &apos;COMPACT&apos;, &apos;CONCATENATE&apos;, &apos;CHANGE&apos;, &apos;CASCADE&apos;, &apos;RESTRICT&apos;, &apos;CLUSTERED&apos;, &apos;SORTED&apos;, &apos;PURGE&apos;, &apos;INPUTFORMAT&apos;, &apos;OUTPUTFORMAT&apos;, DATABASE, DATABASES, &apos;DFS&apos;, &apos;TRUNCATE&apos;, &apos;ANALYZE&apos;, &apos;COMPUTE&apos;, &apos;LIST&apos;, &apos;STATISTICS&apos;, &apos;PARTITIONED&apos;, &apos;EXTERNAL&apos;, &apos;DEFINED&apos;, &apos;REVOKE&apos;, &apos;GRANT&apos;, &apos;LOCK&apos;, &apos;UNLOCK&apos;, &apos;MSCK&apos;, &apos;REPAIR&apos;, &apos;RECOVER&apos;, &apos;EXPORT&apos;, &apos;IMPORT&apos;, &apos;LOAD&apos;, &apos;ROLE&apos;, &apos;ROLES&apos;, &apos;COMPACTIONS&apos;, &apos;PRINCIPALS&apos;, &apos;TRANSACTIONS&apos;, &apos;INDEX&apos;, &apos;INDEXES&apos;, &apos;LOCKS&apos;, &apos;OPTION&apos;, &apos;ANTI&apos;, &apos;LOCAL&apos;, &apos;INPATH&apos;, &apos;CURRENT_DATE&apos;, &apos;CURRENT_TIMESTAMP&apos;, IDENTIFIER, BACKQUOTED_IDENTIFIER}(line 1, pos 12)\\n\\n== SQL ==\\navg(rating) 4.0\\n------------^^^\\n&quot;\n</div>","workflows":[],"startTime":1.481213125361E12,"submitTime":1.481213125312E12,"finishTime":1.481213128378E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"f912b247-356d-444f-946d-a96532a1a080"},{"version":"CommandV1","origId":221,"guid":"cda84c6b-e39a-43ca-a39d-3075a14a3995","subtype":"command","commandType":"auto","position":39.0,"command":"%md ### 2.3 Converting Column Format\n\nEach column in a DataFrame has it own data format. Some time you need to convert column format. In the `ratingDF` DataFrame the timestamp column uses Unix time which is not human readable.\n\n`from_unixtime` converts the number of seconds from unix epoch (1970-01-01 00:00:00 UTC) to a string representing the timestamp of that moment in the current system time zone in the given format.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"bc4c90a1-7d8d-474d-99e8-44c4adbaf2b9"},{"version":"CommandV1","origId":222,"guid":"a747d060-4b43-4290-8cb4-7e970e4bf7a5","subtype":"command","commandType":"auto","position":40.0,"command":"from pyspark.sql.functions import from_unixtime\nratingsDF = ratingsDF.withColumn('timestamp', from_unixtime(ratingsDF.timestamp).cast(TimestampType()))","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;ratingDF&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-41-f175da66722e&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansigreen\">from</span> pyspark<span class=\"ansiyellow\">.</span>sql<span class=\"ansiyellow\">.</span>functions <span class=\"ansigreen\">import</span> from_unixtime<span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 2</span><span class=\"ansiyellow\"> </span>ratingsDF <span class=\"ansiyellow\">=</span> ratingsDF<span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;timestamp&apos;</span><span class=\"ansiyellow\">,</span> from_unixtime<span class=\"ansiyellow\">(</span>ratingDF<span class=\"ansiyellow\">.</span>timestamp<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;ratingDF&apos; is not defined\n</div>","workflows":[],"startTime":1.481213774747E12,"submitTime":1.481213774727E12,"finishTime":1.481213774785E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"c40e5cf2-09fd-4a95-94c0-17b4aa641bef"},{"version":"CommandV1","origId":223,"guid":"b956c972-fffc-4942-82e2-10b69b18d3df","subtype":"command","commandType":"auto","position":41.0,"command":"ratingsDF.printSchema()\nratingsDF.show(3)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">root\n |-- itemId: long (nullable = true)\n |-- rating: long (nullable = true)\n |-- timestamp: string (nullable = true)\n |-- userId: long (nullable = true)\n\n+------+------+-------------------+------+\n|itemId|rating|          timestamp|userId|\n+------+------+-------------------+------+\n|   242|     3|1997-12-04 15:55:49|   196|\n|   302|     3|1998-04-04 19:22:22|   186|\n|   377|     1|1997-11-07 07:18:36|    22|\n+------+------+-------------------+------+\nonly showing top 3 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;ratingDF&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-43-d90621761365&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>ratingDF<span class=\"ansiyellow\">.</span>printSchema<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      2</span> ratingDF<span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">3</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;ratingDF&apos; is not defined\n</div>","workflows":[],"startTime":1.481213784626E12,"submitTime":1.481213784612E12,"finishTime":1.481213785098E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"4c613e9f-700c-44dd-898c-b664e211d2fc"},{"version":"CommandV1","origId":224,"guid":"238a5ef9-f620-4ca6-b5fa-e49c63f72684","subtype":"command","commandType":"auto","position":42.0,"command":"%md We can further conver the string format into TimestampType by applying cast() to the column:\n\n`cast(dataType)`: Convert the column into type `dataType`.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"27775501-19cd-4c46-8f52-fb3f8f433e04"},{"version":"CommandV1","origId":225,"guid":"ad84d1a2-a879-4fba-99f5-cca01969aa0c","subtype":"command","commandType":"auto","position":43.0,"command":"ratingsDF = ratingsDF.withColumn('timestamp', ratingsDF.timestamp.cast(TimestampType()))","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;ratingDF&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-45-404740cf1976&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>ratingDF <span class=\"ansiyellow\">=</span> ratingDF<span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;timestamp&apos;</span><span class=\"ansiyellow\">,</span> ratingDF<span class=\"ansiyellow\">.</span>timestamp<span class=\"ansiyellow\">.</span>cast<span class=\"ansiyellow\">(</span>TimestampType<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;ratingDF&apos; is not defined\n</div>","workflows":[],"startTime":1.481214092909E12,"submitTime":1.481214092885E12,"finishTime":1.481214092978E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":true},"streamStates":{},"nuid":"acd35e26-87a5-49f3-823c-805859f1cd50"},{"version":"CommandV1","origId":226,"guid":"58c36c66-8eac-4268-9219-71fc35775016","subtype":"command","commandType":"auto","position":44.0,"command":"ratingsDF.printSchema()\nratingsDF.show(3)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">root\n |-- itemId: long (nullable = true)\n |-- rating: long (nullable = true)\n |-- timestamp: timestamp (nullable = true)\n |-- userId: long (nullable = true)\n\n+------+------+--------------------+------+\n|itemId|rating|           timestamp|userId|\n+------+------+--------------------+------+\n|   242|     3|1997-12-04 15:55:...|   196|\n|   302|     3|1998-04-04 19:22:...|   186|\n|   377|     1|1997-11-07 07:18:...|    22|\n+------+------+--------------------+------+\nonly showing top 3 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481214095762E12,"submitTime":1.481214095751E12,"finishTime":1.481214096234E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"a830c947-e700-45ad-9021-a1090fb01376"},{"version":"CommandV1","origId":227,"guid":"20a105e1-b5d2-4280-b1a7-faee894e1cb0","subtype":"command","commandType":"auto","position":45.0,"command":"%md ### 2.4 User Defined Functions\n\nWe can define our own function and apply it to a column in DataFrame. The following code creates a new column called \"ageGroup\" by applying the function `ageToGroup` to the `age` column.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"ccfe06f6-7c5f-4e71-a31a-1a352366ef76"},{"version":"CommandV1","origId":228,"guid":"791ee203-ae28-49a8-b547-ca954c8d55de","subtype":"command","commandType":"auto","position":46.0,"command":"# define UDF\ndef ageToGroup(num):\n    if num < 40:\n        return \"young\"\n    elif num > 64:\n        return \"old\"\n    else:\n        return \"middle\"\n    \nfrom pyspark.sql.functions import udf\n# Create a Column expression representing a UDF.\nudfAgeGroup=udf(ageToGroup, StringType())\n\n# apply UDF to age column\nuserDF.withColumn(\"ageGroup\", udfAgeGroup(\"age\")).show(10)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---+------+-------------+------+-------+--------+\n|age|gender|   occupation|userId|zipCode|ageGroup|\n+---+------+-------------+------+-------+--------+\n| 24|     M|   technician|     1|  85711|   young|\n| 53|     F|        other|     2|  94043|  middle|\n| 23|     M|       writer|     3|  32067|   young|\n| 24|     M|   technician|     4|  43537|   young|\n| 33|     F|        other|     5|  15213|   young|\n| 42|     M|    executive|     6|  98101|  middle|\n| 57|     M|administrator|     7|  91344|  middle|\n| 36|     M|administrator|     8|  05201|   young|\n| 29|     M|      student|     9|  01002|   young|\n| 53|     M|       lawyer|    10|  90703|  middle|\n+---+------+-------------+------+-------+--------+\nonly showing top 10 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.48121507276E12,"submitTime":1.481215072776E12,"finishTime":1.481215073282E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"4c22e26b-a486-4d4a-8f7e-3231c6870fc9"},{"version":"CommandV1","origId":229,"guid":"b20ab147-ad88-4004-8407-e8c2cb557a97","subtype":"command","commandType":"auto","position":47.0,"command":"%md ### Exercise 3\n\nAssume we want to evaluate the movies based on both the average rating and the review counts using the expression below:\n\n$\\exp{avg(rating)}\\times \\log{count(1)}$ \n\nCreate a DataFrame that includes average rating, review count and score calculated based on the expression above for each movie. You may want to define a UDF and use your UDF to calculate the scores.\n\nWhat are the top 10 movies based on this score? You can use `DataFrame.sort(*cols, ascending)` to sort the DataFrame.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"2cf0b0b1-1b9e-41ba-b073-49158bf4bfa9"},{"version":"CommandV1","origId":230,"guid":"207e979b-f8a7-42ae-9671-7e69ca6a6818","subtype":"command","commandType":"auto","position":48.0,"command":"# Your code goes here\n\nimport math\n\ndef scoring(rating, cnt):\n    score = math.exp(rating) * math.log(cnt)\n    return score\n  \n# Create column expression representing the UDF\nfrom pyspark.sql.functions import udf\nudfScoreMovie = udf(scoring, FloatType())\n\n# Apply to aggregated column\nratingsDF.groupBy(\"itemId\")\\\n.agg({\"rating\": \"avg\", \"*\": \"count\"})\\\n.withColumn(\"score\", udfScoreMovie(\"avg(rating)\", \"count(1)\"))\\\n.sort('score', ascending=False)\\\n.show()\n    ","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+------+------------------+--------+---------+\n|itemId|       avg(rating)|count(1)|    score|\n+------+------------------+--------+---------+\n|    50|4.3584905660377355|     583| 497.6044|\n|   318| 4.466442953020135|     298| 495.9123|\n|    64| 4.445229681978798|     283|481.10187|\n|   483|  4.45679012345679|     243| 473.5587|\n|    12| 4.385767790262173|     267|448.65524|\n|   127| 4.283292978208232|     413|436.57175|\n|    98|  4.28974358974359|     390|435.21704|\n|   603|4.3875598086124405|     209| 429.7581|\n|   174| 4.252380952380952|     420|424.46396|\n|   408| 4.491071428571429|     112|420.97025|\n|   169| 4.466101694915254|     118| 415.1299|\n|   313|4.2457142857142856|     350|408.91656|\n|   357| 4.291666666666667|     264|407.53598|\n|   100| 4.155511811023622|     508|397.40878|\n|   172| 4.204359673024523|     367|395.52753|\n|   427| 4.292237442922374|     219|394.10233|\n|   134| 4.292929292929293|     198|386.99814|\n|   480| 4.284916201117318|     179|376.58588|\n|   272| 4.262626262626263|     198|375.44684|\n|   173| 4.172839506172839|     324| 375.1672|\n+------+------------------+--------+---------+\nonly showing top 20 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">AttributeError</span>: &apos;NoneType&apos; object has no attribute &apos;withColumn&apos;","error":"<div class=\"ansiout\">+------+------------------+--------+\n|itemId|       avg(rating)|count(1)|\n+------+------------------+--------+\n|   474| 4.252577319587629|     194|\n|    29|2.6666666666666665|     114|\n|    26| 3.452054794520548|      73|\n|   964|3.3333333333333335|       9|\n|  1677|               3.0|       1|\n|    65|3.5391304347826087|     115|\n|   191| 4.163043478260869|     276|\n|  1224|2.6666666666666665|      12|\n|   558|3.6714285714285713|      70|\n|  1010|              3.25|      44|\n|   418|3.5813953488372094|     129|\n|  1277|3.4210526315789473|      19|\n|  1258|2.5217391304347827|      23|\n|   541| 2.877551020408163|      49|\n|  1360|               1.5|       2|\n|   222|  3.66027397260274|     365|\n|   938|              2.88|      25|\n|   293| 3.802721088435374|     147|\n|   270|3.5955882352941178|     136|\n|  1127| 2.909090909090909|      11|\n+------+------------------+--------+\nonly showing top 20 rows\n\n<span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AttributeError</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-52-7ff81846fa25&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">     12</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     13</span> <span class=\"ansired\"># Apply to aggregated column</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 14</span><span class=\"ansiyellow\"> </span>ratingsDF<span class=\"ansiyellow\">.</span>groupBy<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;itemId&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>agg<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">{</span><span class=\"ansiblue\">&quot;rating&quot;</span><span class=\"ansiyellow\">:</span> <span class=\"ansiblue\">&quot;avg&quot;</span><span class=\"ansiyellow\">,</span> <span class=\"ansiblue\">&quot;*&quot;</span><span class=\"ansiyellow\">:</span> <span class=\"ansiblue\">&quot;count&quot;</span><span class=\"ansiyellow\">}</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;score&quot;</span><span class=\"ansiyellow\">,</span> udfScoreMovie<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;avg(rating)&quot;</span><span class=\"ansiyellow\">,</span> <span class=\"ansiblue\">&quot;count(1)&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AttributeError</span>: &apos;NoneType&apos; object has no attribute &apos;withColumn&apos;\n</div>","workflows":[],"startTime":1.481215870364E12,"submitTime":1.481215870372E12,"finishTime":1.481215872477E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"c5ee6c90-00a7-4ce6-9f2f-2659d67883a5"},{"version":"CommandV1","origId":252,"guid":"7ceae3c9-2e21-424c-8ac4-ae9b7c7c292b","subtype":"command","commandType":"auto","position":48.5,"command":"# Cool display\ndisplay(ratingsDF)","commandVersion":0,"state":"finished","results":{"type":"table","data":[[242.0,3.0,"1997-12-04T15:55:49.000+0000",196.0],[302.0,3.0,"1998-04-04T19:22:22.000+0000",186.0],[377.0,1.0,"1997-11-07T07:18:36.000+0000",22.0],[51.0,2.0,"1997-11-27T05:02:03.000+0000",244.0],[346.0,1.0,"1998-02-02T05:33:16.000+0000",166.0],[474.0,4.0,"1998-01-07T14:20:06.000+0000",298.0],[265.0,2.0,"1997-12-03T17:51:28.000+0000",115.0],[465.0,5.0,"1998-04-03T18:34:27.000+0000",253.0],[451.0,3.0,"1998-02-01T09:20:17.000+0000",305.0],[86.0,3.0,"1997-12-31T21:16:53.000+0000",6.0],[257.0,2.0,"1997-11-12T22:07:14.000+0000",62.0],[1014.0,5.0,"1997-11-17T15:38:45.000+0000",286.0],[222.0,5.0,"1997-10-05T09:05:40.000+0000",200.0],[40.0,3.0,"1998-03-27T21:59:54.000+0000",210.0],[29.0,3.0,"1998-02-21T23:40:57.000+0000",224.0],[785.0,3.0,"1997-11-14T05:28:38.000+0000",303.0],[387.0,5.0,"1997-11-11T17:47:39.000+0000",122.0],[274.0,2.0,"1997-11-14T20:36:34.000+0000",194.0],[1042.0,4.0,"1997-09-21T09:42:24.000+0000",291.0],[1184.0,2.0,"1998-04-08T23:47:17.000+0000",234.0],[392.0,4.0,"1998-01-30T16:13:34.000+0000",119.0],[486.0,4.0,"1998-04-16T14:54:12.000+0000",167.0],[144.0,4.0,"1997-10-26T15:55:20.000+0000",299.0],[118.0,2.0,"1997-09-21T09:24:38.000+0000",291.0],[1.0,4.0,"1998-02-17T17:28:52.000+0000",308.0],[546.0,2.0,"1997-11-10T21:16:06.000+0000",95.0],[95.0,5.0,"1998-04-13T01:14:54.000+0000",38.0],[768.0,2.0,"1998-01-02T13:40:50.000+0000",102.0],[277.0,4.0,"1997-10-01T23:10:01.000+0000",63.0],[234.0,5.0,"1997-10-14T20:33:05.000+0000",160.0],[246.0,3.0,"1997-10-17T01:38:49.000+0000",50.0],[98.0,4.0,"1997-12-14T05:03:47.000+0000",301.0],[193.0,4.0,"1997-11-14T20:35:27.000+0000",225.0],[88.0,4.0,"1997-11-28T15:46:03.000+0000",290.0],[194.0,3.0,"1998-01-08T05:54:20.000+0000",97.0],[274.0,4.0,"1998-02-07T22:33:55.000+0000",157.0],[1081.0,1.0,"1997-11-08T04:17:03.000+0000",181.0],[603.0,5.0,"1998-03-30T22:02:10.000+0000",278.0],[796.0,1.0,"1997-09-20T21:45:32.000+0000",276.0],[32.0,4.0,"1998-03-31T13:28:52.000+0000",7.0],[16.0,4.0,"1997-10-26T18:01:17.000+0000",10.0],[304.0,4.0,"1998-01-20T20:48:42.000+0000",284.0],[979.0,2.0,"1998-01-06T19:17:13.000+0000",201.0],[564.0,3.0,"1997-09-20T21:43:25.000+0000",276.0],[327.0,5.0,"1997-09-27T04:18:36.000+0000",287.0],[201.0,5.0,"1998-01-16T03:33:14.000+0000",246.0],[1137.0,5.0,"1997-11-17T04:33:16.000+0000",242.0],[241.0,5.0,"1997-11-16T00:46:34.000+0000",249.0],[4.0,5.0,"1998-02-03T15:18:17.000+0000",99.0],[332.0,3.0,"1997-12-22T20:43:57.000+0000",178.0],[100.0,4.0,"1998-01-31T18:38:04.000+0000",251.0],[432.0,2.0,"1997-10-11T01:58:51.000+0000",81.0],[322.0,4.0,"1998-03-23T02:08:18.000+0000",260.0],[181.0,5.0,"1998-01-26T22:23:35.000+0000",25.0],[196.0,5.0,"1998-02-23T03:38:08.000+0000",59.0],[679.0,2.0,"1997-11-20T14:46:04.000+0000",72.0],[384.0,4.0,"1997-11-18T18:18:47.000+0000",87.0],[143.0,5.0,"1997-11-25T16:11:33.000+0000",290.0],[423.0,5.0,"1997-12-03T00:08:07.000+0000",42.0],[515.0,4.0,"1997-12-02T23:06:17.000+0000",292.0],[20.0,3.0,"1997-12-03T17:43:29.000+0000",115.0],[288.0,1.0,"1997-11-16T08:06:24.000+0000",20.0],[219.0,4.0,"1998-01-06T18:51:13.000+0000",201.0],[526.0,3.0,"1997-12-14T23:10:53.000+0000",13.0],[919.0,4.0,"1998-01-16T03:22:29.000+0000",246.0],[26.0,5.0,"1997-11-08T21:23:52.000+0000",138.0],[232.0,1.0,"1998-04-16T14:52:21.000+0000",167.0],[427.0,5.0,"1997-12-28T16:30:20.000+0000",60.0],[304.0,5.0,"1998-01-01T23:49:41.000+0000",57.0],[274.0,4.0,"1998-04-02T20:48:14.000+0000",223.0],[512.0,4.0,"1998-04-22T20:41:42.000+0000",189.0],[15.0,3.0,"1997-11-20T00:57:20.000+0000",243.0],[1049.0,1.0,"1998-03-18T20:10:26.000+0000",92.0],[416.0,3.0,"1998-01-16T03:57:27.000+0000",246.0],[165.0,4.0,"1997-11-14T22:32:03.000+0000",194.0],[690.0,2.0,"1998-02-12T02:11:22.000+0000",241.0],[248.0,4.0,"1997-12-22T20:52:34.000+0000",178.0],[1444.0,3.0,"1998-02-03T03:12:38.000+0000",254.0],[5.0,3.0,"1998-03-03T06:29:36.000+0000",293.0],[229.0,5.0,"1998-01-09T16:54:27.000+0000",127.0],[237.0,5.0,"1997-11-14T20:34:03.000+0000",225.0],[229.0,3.0,"1997-10-30T06:20:29.000+0000",299.0],[480.0,5.0,"1997-11-14T20:52:28.000+0000",225.0],[54.0,3.0,"1997-09-20T21:30:25.000+0000",276.0],[144.0,5.0,"1997-09-21T09:44:51.000+0000",291.0],[366.0,4.0,"1997-10-30T03:49:41.000+0000",222.0],[518.0,5.0,"1997-11-08T06:49:33.000+0000",267.0],[403.0,3.0,"1997-12-03T00:24:44.000+0000",42.0],[111.0,4.0,"1998-04-06T23:04:22.000+0000",11.0],[625.0,4.0,"1998-03-03T19:46:52.000+0000",95.0],[338.0,4.0,"1997-11-12T19:11:13.000+0000",8.0],[25.0,4.0,"1997-10-23T19:39:33.000+0000",162.0],[1016.0,4.0,"1997-11-18T18:03:14.000+0000",87.0],[154.0,5.0,"1997-09-26T17:51:31.000+0000",279.0],[275.0,2.0,"1998-01-23T12:11:45.000+0000",145.0],[1153.0,5.0,"1997-09-20T18:46:38.000+0000",119.0],[498.0,4.0,"1997-11-12T22:30:48.000+0000",62.0],[382.0,3.0,"1997-11-12T22:58:57.000+0000",62.0],[209.0,4.0,"1997-12-12T21:13:34.000+0000",28.0],[23.0,4.0,"1997-11-18T12:56:05.000+0000",135.0],[294.0,3.0,"1998-01-02T02:57:43.000+0000",32.0],[382.0,5.0,"1998-03-31T22:37:15.000+0000",90.0],[208.0,4.0,"1997-10-22T14:52:22.000+0000",286.0],[685.0,3.0,"1998-03-03T06:06:10.000+0000",293.0],[144.0,4.0,"1997-11-22T21:37:19.000+0000",216.0],[328.0,5.0,"1998-02-02T05:35:22.000+0000",166.0],[496.0,4.0,"1997-10-29T02:01:39.000+0000",250.0],[132.0,5.0,"1998-01-26T21:04:32.000+0000",271.0],[174.0,5.0,"1997-10-14T20:26:47.000+0000",160.0],[118.0,4.0,"1997-09-27T00:38:34.000+0000",265.0],[498.0,3.0,"1998-01-07T21:11:32.000+0000",198.0],[96.0,5.0,"1997-12-02T23:59:38.000+0000",42.0],[151.0,5.0,"1998-01-08T19:34:18.000+0000",168.0],[307.0,4.0,"1998-02-09T01:21:00.000+0000",110.0],[144.0,4.0,"1998-01-09T00:15:36.000+0000",58.0],[648.0,4.0,"1998-03-31T22:52:34.000+0000",90.0],[346.0,4.0,"1998-01-26T19:53:50.000+0000",271.0],[21.0,3.0,"1997-11-12T22:24:20.000+0000",62.0],[832.0,3.0,"1997-12-06T02:37:34.000+0000",279.0],[514.0,4.0,"1997-11-12T23:17:21.000+0000",237.0],[789.0,4.0,"1998-04-04T20:14:47.000+0000",94.0],[485.0,3.0,"1997-11-19T19:14:55.000+0000",128.0],[317.0,4.0,"1998-01-07T14:20:06.000+0000",298.0],[195.0,5.0,"1997-11-01T01:31:14.000+0000",44.0],[200.0,5.0,"1998-01-30T01:05:52.000+0000",264.0],[385.0,2.0,"1997-11-14T16:24:03.000+0000",194.0],[195.0,5.0,"1997-11-20T14:55:02.000+0000",72.0],[750.0,5.0,"1998-01-03T08:12:00.000+0000",222.0],[264.0,3.0,"1997-10-29T01:39:42.000+0000",250.0],[265.0,3.0,"1998-03-23T21:04:02.000+0000",41.0],[245.0,3.0,"1998-02-21T17:30:16.000+0000",224.0],[135.0,3.0,"1997-11-05T22:40:29.000+0000",82.0],[1147.0,4.0,"1997-11-17T18:35:10.000+0000",262.0],[471.0,3.0,"1998-03-03T06:01:24.000+0000",293.0],[658.0,3.0,"1997-11-23T00:30:29.000+0000",216.0],[140.0,3.0,"1997-10-29T02:27:39.000+0000",250.0],[23.0,5.0,"1998-02-23T03:41:40.000+0000",59.0],[379.0,5.0,"1997-10-22T15:22:51.000+0000",286.0],[815.0,4.0,"1997-11-27T04:33:05.000+0000",244.0],[479.0,4.0,"1998-03-31T13:46:50.000+0000",7.0],[368.0,1.0,"1998-02-02T15:46:42.000+0000",174.0],[274.0,4.0,"1997-11-18T18:12:14.000+0000",87.0],[1211.0,2.0,"1997-11-14T23:49:40.000+0000",194.0],[1134.0,2.0,"1998-01-13T18:00:02.000+0000",82.0],[836.0,2.0,"1997-12-14T22:49:06.000+0000",13.0],[272.0,4.0,"1998-01-11T17:06:43.000+0000",13.0],[756.0,2.0,"1997-11-27T04:32:37.000+0000",244.0],[427.0,5.0,"1998-02-01T08:51:30.000+0000",305.0],[787.0,2.0,"1998-03-03T19:55:30.000+0000",95.0],[14.0,2.0,"1998-01-04T23:15:45.000+0000",43.0],[955.0,4.0,"1998-03-10T04:07:03.000+0000",299.0],[419.0,3.0,"1998-01-01T23:47:34.000+0000",57.0],[405.0,3.0,"1997-12-30T03:26:03.000+0000",84.0],[504.0,4.0,"1998-04-01T16:58:42.000+0000",269.0],[111.0,3.0,"1997-10-26T15:03:04.000+0000",299.0],[466.0,4.0,"1997-11-14T16:44:36.000+0000",194.0],[135.0,4.0,"1997-10-14T20:26:47.000+0000",160.0],[268.0,3.0,"1998-01-24T21:44:07.000+0000",99.0],[486.0,4.0,"1997-10-26T17:27:26.000+0000",10.0],[117.0,4.0,"1997-09-20T03:09:48.000+0000",259.0],[427.0,3.0,"1997-11-13T21:25:50.000+0000",85.0],[919.0,4.0,"1997-11-14T00:28:15.000+0000",303.0],[273.0,5.0,"1997-11-07T02:49:47.000+0000",213.0],[514.0,3.0,"1998-03-31T23:45:47.000+0000",121.0],[98.0,5.0,"1998-03-31T22:26:44.000+0000",90.0],[559.0,2.0,"1998-02-21T13:23:25.000+0000",49.0],[794.0,3.0,"1997-12-03T00:20:25.000+0000",42.0],[323.0,2.0,"1997-11-12T21:47:41.000+0000",155.0],[117.0,4.0,"1997-10-16T03:52:19.000+0000",68.0],[177.0,4.0,"1997-09-29T12:59:25.000+0000",172.0],[4.0,4.0,"1998-01-21T20:00:40.000+0000",19.0],[231.0,4.0,"1997-10-01T22:15:36.000+0000",268.0],[2.0,3.0,"1997-09-30T16:14:13.000+0000",5.0],[117.0,2.0,"1998-02-01T09:07:08.000+0000",305.0],[294.0,4.0,"1997-12-31T23:52:36.000+0000",44.0],[137.0,4.0,"1997-10-04T14:34:16.000+0000",43.0],[1336.0,1.0,"1997-09-26T18:25:53.000+0000",279.0],[466.0,5.0,"1998-02-13T20:28:21.000+0000",80.0],[164.0,4.0,"1998-02-03T02:26:08.000+0000",254.0],[281.0,3.0,"1998-01-07T14:28:56.000+0000",298.0],[1240.0,1.0,"1998-04-10T02:13:24.000+0000",279.0],[298.0,4.0,"1997-12-31T20:48:44.000+0000",66.0],[443.0,3.0,"1997-11-21T16:36:33.000+0000",18.0],[1035.0,2.0,"1997-09-29T14:09:34.000+0000",268.0],[79.0,4.0,"1998-01-24T22:15:38.000+0000",99.0],[98.0,4.0,"1997-12-07T17:16:51.000+0000",13.0],[258.0,3.0,"1998-03-31T12:39:09.000+0000",26.0],[455.0,4.0,"1998-03-31T14:04:46.000+0000",7.0],[755.0,4.0,"1997-10-30T03:51:21.000+0000",222.0],[673.0,5.0,"1998-01-06T23:15:54.000+0000",200.0],[328.0,4.0,"1997-10-15T13:58:33.000+0000",119.0],[172.0,5.0,"1997-11-08T02:17:22.000+0000",213.0],[322.0,3.0,"1997-09-20T20:13:12.000+0000",276.0],[1217.0,3.0,"1998-04-04T20:51:26.000+0000",94.0],[379.0,4.0,"1997-10-02T14:14:22.000+0000",130.0],[328.0,4.0,"1998-04-13T00:51:28.000+0000",38.0],[719.0,3.0,"1997-10-14T19:39:37.000+0000",160.0],[1267.0,3.0,"1998-03-03T06:36:06.000+0000",293.0],[930.0,2.0,"1998-03-31T23:13:05.000+0000",26.0],[216.0,4.0,"1997-09-25T19:42:25.000+0000",130.0],[1079.0,3.0,"1998-02-02T18:17:35.000+0000",92.0],[452.0,4.0,"1997-12-15T05:49:59.000+0000",256.0],[61.0,4.0,"1997-11-03T07:33:40.000+0000",1.0],[48.0,4.0,"1997-11-20T14:38:38.000+0000",72.0],[755.0,3.0,"1998-04-18T14:36:47.000+0000",56.0],[360.0,4.0,"1997-12-14T23:08:46.000+0000",13.0],[405.0,2.0,"1997-11-13T21:19:17.000+0000",15.0],[77.0,3.0,"1997-09-30T21:23:57.000+0000",92.0],[476.0,2.0,"1998-01-09T22:52:23.000+0000",207.0],[174.0,5.0,"1997-12-02T23:31:21.000+0000",292.0],[483.0,5.0,"1998-02-27T03:20:22.000+0000",232.0],[748.0,2.0,"1998-01-31T18:42:55.000+0000",251.0],[26.0,3.0,"1998-02-21T23:35:53.000+0000",224.0],[220.0,4.0,"1997-11-08T04:13:12.000+0000",181.0],[255.0,4.0,"1997-09-20T03:05:10.000+0000",259.0],[471.0,4.0,"1998-02-01T09:00:48.000+0000",305.0],[280.0,3.0,"1997-12-24T00:20:06.000+0000",52.0],[202.0,5.0,"1998-03-29T11:26:09.000+0000",161.0],[408.0,5.0,"1997-10-21T01:56:58.000+0000",148.0],[235.0,2.0,"1998-04-17T18:42:39.000+0000",125.0],[228.0,5.0,"1998-01-08T05:54:20.000+0000",97.0],[1098.0,4.0,"1998-01-09T00:15:36.000+0000",58.0],[234.0,4.0,"1998-02-16T21:45:48.000+0000",83.0],[347.0,4.0,"1998-03-31T22:28:39.000+0000",90.0],[178.0,5.0,"1997-11-13T21:05:13.000+0000",272.0],[181.0,3.0,"1997-11-14T15:29:56.000+0000",194.0],[478.0,4.0,"1997-11-13T20:57:08.000+0000",125.0],[688.0,1.0,"1998-02-09T01:26:45.000+0000",110.0],[14.0,4.0,"1997-10-26T14:56:15.000+0000",299.0],[10.0,5.0,"1997-11-14T16:28:41.000+0000",151.0],[127.0,4.0,"1998-04-01T15:56:05.000+0000",269.0],[14.0,5.0,"1997-12-31T20:14:09.000+0000",6.0],[106.0,3.0,"1997-12-01T00:58:02.000+0000",54.0],[69.0,5.0,"1997-11-14T00:32:22.000+0000",303.0],[944.0,1.0,"1997-10-24T21:05:22.000+0000",16.0],[790.0,4.0,"1997-12-14T05:50:21.000+0000",301.0],[1091.0,3.0,"1997-09-20T22:03:55.000+0000",276.0],[214.0,2.0,"1998-02-01T08:51:08.000+0000",305.0],[1028.0,2.0,"1997-11-14T20:59:08.000+0000",194.0],[323.0,2.0,"1998-04-01T13:46:37.000+0000",91.0],[554.0,4.0,"1997-11-18T17:59:00.000+0000",87.0],[109.0,4.0,"1997-10-25T22:46:39.000+0000",294.0],[171.0,4.0,"1997-10-22T14:49:51.000+0000",286.0],[318.0,5.0,"1998-01-06T23:14:18.000+0000",200.0],[328.0,1.0,"1998-04-03T19:35:42.000+0000",229.0],[568.0,4.0,"1997-12-22T21:35:55.000+0000",178.0],[842.0,2.0,"1997-11-14T05:20:04.000+0000",303.0],[65.0,4.0,"1997-11-12T22:44:46.000+0000",62.0],[591.0,3.0,"1997-10-05T02:30:08.000+0000",207.0],[172.0,4.0,"1997-09-30T21:01:11.000+0000",92.0],[401.0,4.0,"1997-12-14T05:40:40.000+0000",301.0],[339.0,5.0,"1997-12-15T03:46:21.000+0000",36.0],[746.0,3.0,"1998-01-07T05:17:37.000+0000",70.0],[242.0,3.0,"1997-10-01T23:06:30.000+0000",63.0],[201.0,3.0,"1997-12-12T21:21:11.000+0000",28.0],[68.0,4.0,"1997-09-26T20:56:47.000+0000",279.0],[7.0,4.0,"1997-10-29T01:48:36.000+0000",250.0],[98.0,3.0,"1998-03-26T03:02:15.000+0000",14.0],[1018.0,3.0,"1998-03-10T03:58:44.000+0000",299.0],[54.0,3.0,"1997-11-14T16:44:36.000+0000",194.0],[815.0,3.0,"1997-11-14T05:32:12.000+0000",303.0],[237.0,5.0,"1997-09-20T17:03:58.000+0000",119.0],[218.0,5.0,"1997-11-19T19:08:18.000+0000",295.0],[930.0,2.0,"1997-10-01T21:55:42.000+0000",268.0],[2.0,2.0,"1997-10-01T22:16:13.000+0000",268.0],[258.0,4.0,"1997-12-31T20:44:49.000+0000",66.0],[202.0,5.0,"1997-11-13T04:11:04.000+0000",233.0],[623.0,4.0,"1997-11-23T18:09:38.000+0000",83.0],[334.0,3.0,"1998-04-02T18:42:20.000+0000",214.0],[476.0,2.0,"1997-12-06T00:30:43.000+0000",192.0],[344.0,4.0,"1998-03-31T20:07:48.000+0000",100.0],[145.0,1.0,"1997-10-01T22:21:41.000+0000",268.0],[56.0,4.0,"1997-12-14T05:16:27.000+0000",301.0],[89.0,5.0,"1997-11-11T21:29:46.000+0000",307.0],[141.0,3.0,"1998-04-11T22:43:29.000+0000",234.0],[576.0,4.0,"1997-11-23T18:12:35.000+0000",83.0],[264.0,2.0,"1997-11-08T04:00:24.000+0000",181.0],[133.0,4.0,"1997-09-26T02:14:50.000+0000",297.0],[153.0,5.0,"1998-04-13T01:19:29.000+0000",38.0],[382.0,4.0,"1998-03-31T13:48:13.000+0000",7.0],[813.0,4.0,"1998-01-30T01:15:52.000+0000",264.0],[872.0,1.0,"1997-11-08T04:03:34.000+0000",181.0],[146.0,1.0,"1998-01-07T02:36:19.000+0000",201.0],[507.0,4.0,"1997-11-13T21:23:19.000+0000",85.0],[367.0,3.0,"1998-04-01T17:00:23.000+0000",269.0],[468.0,3.0,"1998-02-23T03:50:55.000+0000",59.0],[143.0,4.0,"1998-03-11T21:25:49.000+0000",286.0],[96.0,1.0,"1998-03-05T19:01:47.000+0000",193.0],[595.0,5.0,"1997-10-04T03:40:24.000+0000",113.0],[11.0,5.0,"1997-12-02T23:08:13.000+0000",292.0],[1014.0,3.0,"1997-10-07T18:58:38.000+0000",130.0],[98.0,4.0,"1997-09-25T02:39:00.000+0000",275.0],[520.0,5.0,"1998-04-22T17:16:20.000+0000",189.0],[82.0,1.0,"1998-03-09T14:07:35.000+0000",219.0],[209.0,5.0,"1997-10-22T02:49:06.000+0000",218.0],[427.0,3.0,"1997-11-18T17:10:20.000+0000",123.0],[222.0,5.0,"1997-09-20T17:08:31.000+0000",119.0],[177.0,4.0,"1997-11-21T17:46:47.000+0000",158.0],[118.0,4.0,"1997-10-22T23:43:22.000+0000",222.0],[322.0,2.0,"1997-11-13T16:01:15.000+0000",302.0],[501.0,3.0,"1997-09-26T21:20:43.000+0000",279.0],[79.0,5.0,"1997-12-14T05:13:23.000+0000",301.0],[3.0,2.0,"1997-11-08T04:30:41.000+0000",181.0],[695.0,1.0,"1998-01-07T02:28:35.000+0000",201.0],[198.0,3.0,"1997-12-07T17:19:53.000+0000",13.0],[189.0,3.0,"1998-03-01T06:15:28.000+0000",1.0],[237.0,5.0,"1997-09-26T10:42:50.000+0000",145.0],[385.0,4.0,"1997-09-20T20:14:22.000+0000",23.0],[767.0,4.0,"1998-01-06T19:21:45.000+0000",201.0],[705.0,5.0,"1998-01-07T18:19:53.000+0000",296.0],[546.0,3.0,"1997-12-02T23:36:57.000+0000",42.0],[872.0,3.0,"1998-04-07T15:50:30.000+0000",33.0],[554.0,3.0,"1997-12-14T05:53:50.000+0000",301.0],[64.0,5.0,"1997-10-24T19:11:37.000+0000",16.0],[135.0,3.0,"1997-11-10T21:32:42.000+0000",95.0],[357.0,4.0,"1997-11-10T05:11:53.000+0000",154.0],[484.0,5.0,"1998-01-13T23:22:46.000+0000",77.0],[508.0,5.0,"1998-01-07T18:09:44.000+0000",296.0],[303.0,2.0,"1997-11-13T15:59:45.000+0000",302.0],[673.0,3.0,"1997-11-27T04:57:47.000+0000",244.0],[77.0,4.0,"1997-10-30T03:53:36.000+0000",222.0],[215.0,5.0,"1997-12-14T23:03:08.000+0000",13.0],[705.0,5.0,"1997-10-24T19:52:16.000+0000",16.0],[452.0,4.0,"1997-10-15T22:57:44.000+0000",270.0],[15.0,2.0,"1997-09-26T10:44:15.000+0000",145.0],[64.0,5.0,"1997-11-14T00:00:31.000+0000",187.0],[304.0,5.0,"1997-10-05T08:54:04.000+0000",200.0],[749.0,5.0,"1998-02-16T16:22:50.000+0000",170.0],[829.0,3.0,"1997-10-18T00:55:38.000+0000",101.0],[218.0,3.0,"1998-03-14T21:10:40.000+0000",184.0],[204.0,4.0,"1997-11-19T19:24:38.000+0000",128.0],[1295.0,1.0,"1997-11-08T04:03:01.000+0000",181.0],[153.0,3.0,"1998-03-14T21:34:45.000+0000",184.0],[33.0,4.0,"1997-11-03T07:38:19.000+0000",1.0],[160.0,4.0,"1997-09-24T03:42:27.000+0000",1.0],[321.0,5.0,"1998-03-14T20:22:47.000+0000",184.0],[595.0,3.0,"1997-12-01T00:56:53.000+0000",54.0],[343.0,4.0,"1998-04-04T21:23:29.000+0000",94.0],[508.0,4.0,"1997-11-19T19:29:27.000+0000",128.0],[323.0,2.0,"1997-09-20T19:37:46.000+0000",23.0],[227.0,3.0,"1997-12-14T05:27:02.000+0000",301.0],[191.0,3.0,"1997-12-14T05:01:12.000+0000",301.0],[903.0,1.0,"1998-04-13T04:02:52.000+0000",112.0],[183.0,3.0,"1997-11-05T22:44:08.000+0000",82.0],[724.0,3.0,"1997-10-30T03:26:16.000+0000",222.0],[430.0,3.0,"1997-10-22T02:45:16.000+0000",218.0],[1197.0,4.0,"1998-02-17T18:18:41.000+0000",308.0],[134.0,5.0,"1997-11-14T00:39:19.000+0000",303.0],[751.0,3.0,"1998-03-22T17:42:27.000+0000",133.0],[212.0,2.0,"1998-04-01T13:01:20.000+0000",215.0],[256.0,5.0,"1997-12-14T19:02:36.000+0000",69.0],[662.0,4.0,"1998-02-13T05:22:30.000+0000",254.0],[2.0,4.0,"1997-09-20T21:53:56.000+0000",276.0],[984.0,1.0,"1998-02-25T21:36:15.000+0000",104.0],[1067.0,3.0,"1997-10-01T23:11:54.000+0000",63.0],[410.0,4.0,"1997-11-08T06:33:05.000+0000",267.0],[56.0,5.0,"1997-12-07T17:16:51.000+0000",13.0],[879.0,3.0,"1998-01-26T00:49:05.000+0000",240.0],[237.0,2.0,"1997-10-02T15:40:00.000+0000",286.0],[271.0,5.0,"1998-03-07T03:30:26.000+0000",294.0],[1086.0,4.0,"1998-03-31T22:47:04.000+0000",90.0],[26.0,4.0,"1997-11-21T16:28:51.000+0000",18.0],[229.0,3.0,"1997-09-30T21:50:01.000+0000",92.0],[649.0,4.0,"1998-02-17T18:14:52.000+0000",308.0],[89.0,3.0,"1998-02-22T00:01:31.000+0000",144.0],[302.0,4.0,"1998-04-02T23:37:33.000+0000",191.0],[951.0,3.0,"1998-02-23T04:00:09.000+0000",59.0],[96.0,5.0,"1998-01-06T23:30:09.000+0000",200.0],[197.0,5.0,"1997-10-24T20:49:06.000+0000",16.0],[678.0,3.0,"1998-04-11T13:45:09.000+0000",61.0],[199.0,4.0,"1998-01-26T21:00:48.000+0000",271.0],[709.0,3.0,"1998-01-26T21:15:25.000+0000",271.0],[169.0,5.0,"1998-02-28T04:32:36.000+0000",142.0],[597.0,3.0,"1997-10-07T04:14:38.000+0000",275.0],[151.0,3.0,"1997-10-30T03:28:29.000+0000",222.0],[40.0,3.0,"1997-11-18T18:15:17.000+0000",87.0],[258.0,4.0,"1997-10-26T15:19:32.000+0000",207.0],[1393.0,2.0,"1997-11-13T20:57:43.000+0000",272.0],[333.0,4.0,"1997-11-21T16:39:57.000+0000",177.0],[1115.0,2.0,"1997-11-16T07:21:46.000+0000",207.0],[577.0,3.0,"1998-03-10T04:23:26.000+0000",299.0],[378.0,4.0,"1998-01-26T21:17:27.000+0000",271.0],[425.0,4.0,"1998-02-01T09:14:46.000+0000",305.0],[959.0,2.0,"1998-02-21T13:48:32.000+0000",49.0],[1224.0,3.0,"1998-04-04T20:46:42.000+0000",94.0],[1017.0,3.0,"1997-09-22T18:44:55.000+0000",130.0],[175.0,3.0,"1997-10-26T17:57:57.000+0000",10.0],[321.0,3.0,"1997-11-25T04:50:18.000+0000",203.0],[286.0,4.0,"1998-04-02T23:47:22.000+0000",191.0],[323.0,3.0,"1997-10-04T14:25:10.000+0000",43.0],[558.0,5.0,"1997-09-22T18:08:15.000+0000",21.0],[96.0,5.0,"1998-04-01T05:50:39.000+0000",197.0],[344.0,2.0,"1998-02-21T15:07:15.000+0000",13.0],[66.0,3.0,"1997-11-14T17:07:44.000+0000",194.0],[206.0,4.0,"1998-04-11T22:42:23.000+0000",234.0],[402.0,4.0,"1998-02-17T18:38:20.000+0000",308.0],[640.0,4.0,"1998-02-17T17:37:16.000+0000",308.0],[522.0,5.0,"1998-04-01T16:22:53.000+0000",269.0],[265.0,4.0,"1998-04-04T20:31:29.000+0000",94.0],[62.0,3.0,"1997-09-26T21:53:44.000+0000",268.0],[12.0,5.0,"1997-11-13T21:07:34.000+0000",272.0],[291.0,3.0,"1998-04-01T00:27:57.000+0000",121.0],[20.0,5.0,"1998-01-07T18:15:21.000+0000",296.0],[286.0,3.0,"1998-04-04T23:25:34.000+0000",134.0],[462.0,5.0,"1997-10-22T18:16:58.000+0000",180.0],[612.0,3.0,"1998-04-08T23:45:40.000+0000",234.0],[117.0,2.0,"1998-02-26T04:06:12.000+0000",104.0],[758.0,1.0,"1998-04-13T02:30:26.000+0000",38.0],[845.0,1.0,"1998-04-01T18:44:15.000+0000",269.0],[163.0,4.0,"1998-03-31T14:10:44.000+0000",7.0],[1451.0,3.0,"1998-04-08T23:32:23.000+0000",234.0],[405.0,2.0,"1997-10-07T04:14:05.000+0000",275.0],[250.0,3.0,"1997-12-24T00:17:41.000+0000",52.0],[823.0,3.0,"1998-03-02T01:17:45.000+0000",102.0],[186.0,4.0,"1998-03-24T02:03:19.000+0000",13.0],[731.0,4.0,"1997-12-22T21:52:12.000+0000",178.0],[71.0,3.0,"1998-03-17T06:37:51.000+0000",236.0],[781.0,5.0,"1997-12-15T05:54:56.000+0000",256.0],[176.0,5.0,"1998-03-30T23:15:52.000+0000",263.0],[186.0,3.0,"1997-11-27T04:41:37.000+0000",244.0],[1181.0,4.0,"1997-09-26T22:46:41.000+0000",279.0],[815.0,4.0,"1998-01-04T23:23:09.000+0000",43.0],[78.0,2.0,"1997-11-23T18:18:09.000+0000",83.0],[197.0,5.0,"1997-11-14T17:31:50.000+0000",151.0],[436.0,2.0,"1998-02-03T02:50:16.000+0000",254.0],[631.0,3.0,"1997-11-26T21:22:51.000+0000",109.0],[716.0,3.0,"1997-09-26T02:03:42.000+0000",297.0],[188.0,4.0,"1997-11-16T00:44:27.000+0000",249.0],[699.0,4.0,"1998-02-22T00:08:26.000+0000",144.0],[604.0,4.0,"1997-12-14T05:06:34.000+0000",301.0],[392.0,3.0,"1998-03-12T21:19:02.000+0000",64.0],[501.0,2.0,"1997-09-30T21:07:45.000+0000",92.0],[97.0,4.0,"1997-10-30T03:22:19.000+0000",222.0],[436.0,3.0,"1997-09-26T21:52:25.000+0000",268.0],[135.0,5.0,"1998-03-03T06:12:30.000+0000",293.0],[173.0,5.0,"1997-11-08T02:17:22.000+0000",213.0],[460.0,2.0,"1997-10-14T20:33:05.000+0000",160.0],[498.0,4.0,"1997-12-14T22:51:41.000+0000",13.0],[715.0,5.0,"1998-02-23T03:52:01.000+0000",59.0],[17.0,4.0,"1997-09-30T16:16:38.000+0000",5.0],[163.0,5.0,"1997-11-13T21:02:36.000+0000",125.0],[315.0,5.0,"1998-02-02T15:19:09.000+0000",174.0],[505.0,3.0,"1997-12-04T18:30:03.000+0000",114.0],[515.0,4.0,"1997-11-07T02:41:58.000+0000",213.0],[196.0,2.0,"1997-09-20T20:22:06.000+0000",23.0],[15.0,4.0,"1997-11-19T19:47:07.000+0000",128.0],[56.0,4.0,"1998-03-06T10:17:58.000+0000",239.0],[279.0,1.0,"1997-11-08T04:22:35.000+0000",181.0],[80.0,4.0,"1997-09-24T07:32:34.000+0000",291.0],[238.0,4.0,"1997-10-29T01:52:43.000+0000",250.0],[649.0,3.0,"1998-01-06T19:17:55.000+0000",201.0],[60.0,5.0,"1997-12-28T16:48:54.000+0000",60.0],[325.0,2.0,"1997-11-08T04:03:34.000+0000",181.0],[407.0,3.0,"1998-02-09T15:37:45.000+0000",119.0],[1.0,5.0,"1997-09-27T04:21:28.000+0000",287.0],[228.0,3.0,"1997-11-23T00:40:42.000+0000",216.0],[531.0,4.0,"1997-11-22T21:23:30.000+0000",216.0],[471.0,4.0,"1997-11-25T05:07:43.000+0000",203.0],[587.0,3.0,"1997-09-30T23:00:08.000+0000",92.0],[892.0,3.0,"1997-12-22T07:03:44.000+0000",13.0],[176.0,4.0,"1997-11-08T02:32:18.000+0000",213.0],[288.0,5.0,"1997-10-02T15:37:52.000+0000",286.0],[1047.0,2.0,"1997-12-01T20:54:57.000+0000",117.0],[111.0,1.0,"1998-01-24T21:54:46.000+0000",99.0],[558.0,3.0,"1998-04-06T23:10:14.000+0000",11.0],[47.0,2.0,"1997-11-11T02:51:12.000+0000",65.0],[194.0,4.0,"1997-11-14T14:23:32.000+0000",295.0],[217.0,2.0,"1998-04-01T17:26:50.000+0000",269.0],[259.0,2.0,"1997-12-09T22:03:46.000+0000",85.0],[596.0,5.0,"1997-10-29T01:52:01.000+0000",250.0],[144.0,5.0,"1997-12-06T18:41:29.000+0000",137.0],[960.0,2.0,"1998-01-06T18:41:17.000+0000",201.0],[137.0,4.0,"1997-12-13T21:52:12.000+0000",257.0],[328.0,4.0,"1998-04-04T08:52:19.000+0000",111.0],[480.0,4.0,"1998-04-01T13:54:35.000+0000",91.0],[211.0,4.0,"1998-04-01T13:10:02.000+0000",215.0],[938.0,1.0,"1997-11-08T03:59:46.000+0000",181.0],[1060.0,5.0,"1998-04-22T16:58:21.000+0000",189.0],[20.0,4.0,"1998-02-14T04:51:23.000+0000",1.0],[404.0,4.0,"1997-11-14T00:46:15.000+0000",303.0],[305.0,3.0,"1997-11-17T03:28:34.000+0000",299.0],[210.0,4.0,"1997-11-13T23:54:02.000+0000",187.0],[278.0,2.0,"1997-10-22T23:45:13.000+0000",222.0],[568.0,4.0,"1998-04-15T19:23:17.000+0000",214.0],[770.0,3.0,"1998-03-03T06:30:55.000+0000",293.0],[191.0,4.0,"1998-03-22T19:44:19.000+0000",285.0],[252.0,3.0,"1997-11-14T21:59:51.000+0000",303.0],[156.0,4.0,"1998-01-10T03:27:40.000+0000",96.0],[1110.0,3.0,"1997-11-20T14:48:54.000+0000",72.0],[1067.0,4.0,"1997-12-03T17:43:29.000+0000",115.0],[430.0,3.0,"1998-03-31T13:49:38.000+0000",7.0],[350.0,3.0,"1998-02-08T22:45:26.000+0000",116.0],[480.0,4.0,"1998-02-28T00:29:13.000+0000",73.0],[246.0,5.0,"1998-04-01T18:57:47.000+0000",269.0],[419.0,5.0,"1998-03-30T23:11:54.000+0000",263.0],[431.0,3.0,"1998-01-07T05:17:37.000+0000",70.0],[475.0,4.0,"1997-09-26T03:23:24.000+0000",221.0],[182.0,5.0,"1997-11-20T14:35:15.000+0000",72.0],[357.0,4.0,"1998-01-26T22:12:37.000+0000",25.0],[50.0,5.0,"1997-11-25T15:59:42.000+0000",290.0],[526.0,4.0,"1998-04-22T17:30:05.000+0000",189.0],[303.0,3.0,"1997-10-23T14:56:24.000+0000",299.0],[294.0,3.0,"1998-01-30T00:51:56.000+0000",264.0],[365.0,5.0,"1998-01-06T23:39:22.000+0000",200.0],[135.0,4.0,"1997-11-14T00:00:53.000+0000",187.0],[187.0,4.0,"1998-03-14T20:57:04.000+0000",184.0],[289.0,2.0,"1997-10-01T23:03:05.000+0000",63.0],[229.0,4.0,"1997-12-17T22:27:30.000+0000",13.0],[486.0,3.0,"1998-01-07T14:24:23.000+0000",298.0],[185.0,4.0,"1998-03-11T22:30:35.000+0000",235.0],[712.0,4.0,"1997-11-12T23:09:38.000+0000",62.0],[94.0,2.0,"1998-01-16T04:05:05.000+0000",246.0],[742.0,5.0,"1997-12-01T00:06:46.000+0000",54.0],[762.0,3.0,"1997-10-01T23:14:48.000+0000",63.0],[732.0,3.0,"1998-04-06T23:16:36.000+0000",11.0],[168.0,4.0,"1997-09-30T21:08:43.000+0000",92.0],[550.0,3.0,"1997-11-12T19:19:16.000+0000",8.0],[174.0,4.0,"1997-11-11T21:24:40.000+0000",307.0],[200.0,4.0,"1997-11-14T00:47:39.000+0000",303.0],[849.0,2.0,"1997-12-15T05:43:23.000+0000",256.0],[54.0,3.0,"1997-11-20T14:40:54.000+0000",72.0],[406.0,2.0,"1998-03-09T00:13:09.000+0000",164.0],[150.0,4.0,"1997-11-21T15:11:41.000+0000",117.0],[77.0,4.0,"1998-02-21T23:31:12.000+0000",224.0],[869.0,3.0,"1998-03-05T19:56:51.000+0000",193.0],[184.0,2.0,"1998-04-04T20:14:22.000+0000",94.0],[338.0,2.0,"1997-12-04T01:54:17.000+0000",281.0],[109.0,3.0,"1997-09-22T18:43:14.000+0000",130.0],[371.0,1.0,"1997-11-19T19:15:54.000+0000",128.0],[720.0,1.0,"1998-04-04T20:59:53.000+0000",94.0],[845.0,3.0,"1998-01-24T03:37:47.000+0000",182.0],[873.0,1.0,"1997-12-27T17:57:32.000+0000",129.0],[229.0,4.0,"1998-02-03T02:56:20.000+0000",254.0],[381.0,4.0,"1997-11-12T20:11:31.000+0000",64.0],[176.0,2.0,"1997-11-14T16:18:13.000+0000",151.0],[25.0,4.0,"1997-12-01T22:06:55.000+0000",45.0],[879.0,3.0,"1998-03-05T18:40:57.000+0000",193.0],[922.0,4.0,"1998-03-06T09:00:49.000+0000",276.0],[57.0,3.0,"1997-09-20T20:32:06.000+0000",276.0],[187.0,4.0,"1998-04-08T23:45:40.000+0000",234.0],[306.0,1.0,"1997-11-08T04:06:46.000+0000",181.0],[370.0,1.0,"1997-09-22T18:01:33.000+0000",21.0],[249.0,3.0,"1998-03-03T06:07:09.000+0000",293.0],[721.0,5.0,"1998-01-30T01:27:36.000+0000",264.0],[611.0,5.0,"1997-10-26T17:25:22.000+0000",10.0],[346.0,3.0,"1998-04-01T05:37:50.000+0000",197.0],[142.0,3.0,"1997-09-20T22:02:25.000+0000",276.0],[427.0,4.0,"1998-02-17T17:29:44.000+0000",308.0],[943.0,4.0,"1997-09-26T04:05:59.000+0000",221.0],[126.0,4.0,"1998-01-01T19:05:14.000+0000",131.0],[824.0,2.0,"1997-10-10T21:22:37.000+0000",268.0],[8.0,3.0,"1997-11-26T19:30:42.000+0000",109.0],[58.0,3.0,"1998-01-07T21:22:53.000+0000",198.0],[680.0,4.0,"1997-11-25T18:58:06.000+0000",230.0],[741.0,1.0,"1997-11-08T04:21:58.000+0000",181.0],[1061.0,4.0,"1997-12-06T00:41:31.000+0000",192.0],[448.0,3.0,"1998-04-11T22:58:21.000+0000",234.0],[900.0,4.0,"1998-03-31T22:11:49.000+0000",90.0],[941.0,4.0,"1998-03-05T19:08:10.000+0000",193.0],[603.0,5.0,"1997-11-19T19:13:59.000+0000",128.0],[905.0,2.0,"1998-02-19T02:28:03.000+0000",126.0],[265.0,4.0,"1997-11-27T04:57:14.000+0000",244.0],[289.0,3.0,"1998-03-31T22:11:50.000+0000",90.0],[25.0,3.0,"1998-02-07T22:33:07.000+0000",157.0],[71.0,3.0,"1998-02-01T09:01:24.000+0000",305.0],[382.0,5.0,"1997-09-20T18:55:42.000+0000",119.0],[222.0,2.0,"1997-09-22T18:03:02.000+0000",21.0],[181.0,4.0,"1998-02-27T18:47:53.000+0000",231.0],[508.0,3.0,"1998-04-04T14:34:13.000+0000",280.0],[132.0,3.0,"1998-02-01T23:02:09.000+0000",288.0],[1497.0,2.0,"1998-03-24T23:02:56.000+0000",279.0],[33.0,4.0,"1997-12-14T05:43:48.000+0000",301.0],[699.0,3.0,"1997-11-20T14:39:43.000+0000",72.0],[259.0,2.0,"1998-03-31T22:13:12.000+0000",90.0],[55.0,3.0,"1998-02-17T18:06:00.000+0000",308.0],[742.0,3.0,"1998-02-23T03:04:13.000+0000",59.0],[744.0,4.0,"1998-04-04T20:24:22.000+0000",94.0],[642.0,4.0,"1997-09-25T19:48:53.000+0000",130.0],[1015.0,3.0,"1998-03-31T13:48:56.000+0000",26.0],[121.0,5.0,"1998-04-15T22:31:20.000+0000",56.0],[508.0,2.0,"1998-01-13T17:57:29.000+0000",82.0],[12.0,4.0,"1997-11-12T22:26:53.000+0000",62.0],[40.0,3.0,"1997-09-20T21:44:31.000+0000",276.0],[1015.0,1.0,"1997-11-08T04:25:21.000+0000",181.0],[301.0,3.0,"1997-11-21T21:23:27.000+0000",152.0],[845.0,4.0,"1997-12-22T20:58:11.000+0000",178.0],[597.0,4.0,"1998-03-05T03:54:47.000+0000",217.0],[303.0,4.0,"1998-03-30T15:20:03.000+0000",79.0],[484.0,4.0,"1997-11-08T21:22:07.000+0000",138.0],[81.0,5.0,"1998-02-17T17:41:33.000+0000",308.0],[284.0,2.0,"1998-01-06T01:33:13.000+0000",75.0],[198.0,4.0,"1998-04-01T16:11:02.000+0000",269.0],[94.0,3.0,"1997-10-17T21:11:35.000+0000",307.0],[781.0,3.0,"1997-12-02T10:47:57.000+0000",222.0],[740.0,3.0,"1998-04-01T00:29:04.000+0000",121.0],[22.0,1.0,"1998-04-01T16:27:52.000+0000",269.0],[864.0,4.0,"1997-12-14T23:25:24.000+0000",13.0],[742.0,5.0,"1997-11-25T19:10:43.000+0000",230.0],[507.0,4.0,"1998-04-01T16:40:00.000+0000",269.0],[1099.0,5.0,"1998-03-06T10:14:13.000+0000",239.0],[1028.0,5.0,"1998-02-26T17:17:27.000+0000",245.0],[546.0,3.0,"1998-04-15T22:31:00.000+0000",56.0],[961.0,5.0,"1997-11-14T14:59:16.000+0000",295.0],[1028.0,2.0,"1998-01-26T20:55:02.000+0000",271.0],[812.0,2.0,"1997-12-02T10:38:37.000+0000",222.0],[240.0,3.0,"1997-12-14T19:02:36.000+0000",69.0],[7.0,4.0,"1997-10-26T18:56:50.000+0000",10.0],[376.0,3.0,"1997-11-07T07:18:32.000+0000",22.0],[931.0,3.0,"1998-03-07T03:54:17.000+0000",294.0],[717.0,1.0,"1998-01-13T18:01:32.000+0000",82.0],[399.0,4.0,"1997-09-26T22:44:19.000+0000",279.0],[234.0,1.0,"1998-04-01T16:50:06.000+0000",269.0],[98.0,5.0,"1997-12-31T20:38:00.000+0000",6.0],[1039.0,4.0,"1997-11-20T01:09:44.000+0000",243.0],[181.0,4.0,"1998-01-06T22:27:09.000+0000",298.0],[325.0,1.0,"1997-12-09T21:30:44.000+0000",282.0],[323.0,1.0,"1997-11-15T22:39:27.000+0000",78.0],[200.0,5.0,"1997-09-27T18:24:07.000+0000",118.0],[1114.0,5.0,"1997-11-12T01:19:05.000+0000",283.0],[292.0,4.0,"1998-03-27T21:40:35.000+0000",171.0],[217.0,4.0,"1998-01-07T05:31:59.000+0000",70.0],[100.0,5.0,"1997-10-26T18:49:07.000+0000",10.0],[181.0,4.0,"1998-02-26T17:21:04.000+0000",245.0],[333.0,3.0,"1998-03-30T13:24:27.000+0000",107.0],[561.0,1.0,"1998-01-16T04:04:05.000+0000",246.0],[901.0,1.0,"1998-01-01T16:04:32.000+0000",13.0],[70.0,4.0,"1997-09-20T21:27:06.000+0000",276.0],[17.0,2.0,"1997-11-27T05:06:45.000+0000",244.0],[56.0,5.0,"1998-04-22T17:14:23.000+0000",189.0],[242.0,5.0,"1998-01-04T04:37:51.000+0000",226.0],[1016.0,4.0,"1997-11-12T22:16:48.000+0000",62.0],[417.0,4.0,"1997-09-20T22:01:47.000+0000",276.0],[478.0,4.0,"1998-04-02T19:07:32.000+0000",214.0],[235.0,4.0,"1997-10-10T17:25:54.000+0000",306.0],[26.0,3.0,"1997-10-30T03:44:03.000+0000",222.0],[631.0,5.0,"1998-04-04T14:39:11.000+0000",280.0],[430.0,5.0,"1997-12-28T16:22:02.000+0000",60.0],[71.0,4.0,"1998-04-15T23:34:35.000+0000",56.0],[274.0,5.0,"1997-12-02T23:36:57.000+0000",42.0],[202.0,5.0,"1997-09-24T03:40:42.000+0000",1.0],[809.0,4.0,"1997-12-17T22:26:22.000+0000",13.0],[289.0,4.0,"1997-10-22T21:49:48.000+0000",173.0],[749.0,1.0,"1997-11-13T21:08:31.000+0000",15.0],[23.0,4.0,"1997-12-30T23:24:09.000+0000",185.0],[540.0,3.0,"1998-04-04T15:05:04.000+0000",280.0],[381.0,4.0,"1997-11-27T04:14:37.000+0000",244.0],[293.0,4.0,"1997-11-05T16:22:26.000+0000",150.0],[497.0,4.0,"1998-03-31T13:48:54.000+0000",7.0],[317.0,4.0,"1997-12-22T21:41:55.000+0000",178.0],[742.0,3.0,"1997-12-22T20:50:33.000+0000",178.0],[1217.0,3.0,"1997-11-26T19:30:58.000+0000",95.0],[1462.0,3.0,"1998-04-11T22:31:05.000+0000",234.0],[222.0,5.0,"1998-01-08T05:54:47.000+0000",97.0],[127.0,2.0,"1997-11-26T16:57:51.000+0000",109.0],[268.0,5.0,"1997-11-21T14:58:26.000+0000",117.0],[705.0,2.0,"1998-04-01T16:40:50.000+0000",269.0],[1246.0,3.0,"1997-10-07T19:28:17.000+0000",130.0],[655.0,4.0,"1998-01-30T01:25:30.000+0000",264.0],[13.0,3.0,"1997-09-29T04:20:39.000+0000",207.0],[588.0,5.0,"1997-12-03T00:15:47.000+0000",42.0],[409.0,2.0,"1998-01-16T04:02:52.000+0000",246.0],[367.0,4.0,"1997-11-18T18:11:42.000+0000",87.0],[304.0,3.0,"1997-10-18T00:47:57.000+0000",101.0],[127.0,4.0,"1997-12-15T05:40:06.000+0000",256.0],[794.0,3.0,"1997-09-30T21:26:38.000+0000",92.0],[762.0,2.0,"1997-11-08T04:30:18.000+0000",181.0],[235.0,1.0,"1997-11-08T02:11:55.000+0000",213.0],[739.0,2.0,"1997-10-06T22:06:22.000+0000",92.0],[661.0,5.0,"1997-12-02T23:32:41.000+0000",292.0],[665.0,4.0,"1998-01-16T03:53:51.000+0000",246.0],[845.0,5.0,"1997-11-07T23:32:59.000+0000",274.0],[692.0,5.0,"1997-09-24T03:43:03.000+0000",188.0],[86.0,4.0,"1997-11-21T16:28:51.000+0000",18.0],[439.0,1.0,"1997-11-06T19:27:03.000+0000",5.0],[632.0,3.0,"1998-03-17T06:30:54.000+0000",236.0],[407.0,4.0,"1998-03-05T19:58:41.000+0000",193.0],[709.0,4.0,"1998-02-22T00:05:40.000+0000",144.0],[1198.0,5.0,"1998-03-31T22:37:46.000+0000",90.0],[609.0,4.0,"1997-11-13T15:26:59.000+0000",48.0],[225.0,2.0,"1997-09-30T16:08:43.000+0000",5.0],[128.0,5.0,"1997-11-07T07:33:03.000+0000",22.0],[432.0,4.0,"1998-01-09T17:04:45.000+0000",311.0],[22.0,5.0,"1997-11-12T19:16:23.000+0000",8.0],[188.0,4.0,"1997-09-20T21:55:47.000+0000",276.0],[173.0,5.0,"1997-10-30T03:44:03.000+0000",222.0],[866.0,4.0,"1997-11-20T14:24:47.000+0000",72.0],[134.0,4.0,"1997-10-30T06:18:31.000+0000",299.0],[171.0,5.0,"1998-03-13T01:15:11.000+0000",1.0],[295.0,3.0,"1998-02-17T18:51:01.000+0000",308.0],[216.0,4.0,"1997-11-14T16:42:58.000+0000",165.0],[49.0,3.0,"1997-10-30T03:51:52.000+0000",222.0],[121.0,4.0,"1997-11-08T04:17:03.000+0000",181.0],[11.0,5.0,"1998-01-06T23:32:22.000+0000",200.0],[626.0,4.0,"1998-04-11T23:12:38.000+0000",234.0],[707.0,4.0,"1997-11-27T04:50:43.000+0000",244.0],[25.0,5.0,"1998-03-31T22:53:09.000+0000",90.0],[216.0,5.0,"1997-12-26T03:52:04.000+0000",208.0],[96.0,4.0,"1998-03-30T22:52:16.000+0000",263.0],[323.0,4.0,"1998-04-04T23:25:35.000+0000",134.0],[586.0,4.0,"1998-04-18T01:57:43.000+0000",279.0],[292.0,4.0,"1998-02-27T03:39:34.000+0000",2.0],[593.0,2.0,"1998-02-07T22:55:27.000+0000",288.0],[302.0,4.0,"1998-02-21T12:50:32.000+0000",49.0],[153.0,5.0,"1997-10-22T14:43:26.000+0000",286.0],[304.0,3.0,"1998-02-24T01:38:33.000+0000",205.0],[80.0,4.0,"1997-11-07T07:20:27.000+0000",22.0],[318.0,4.0,"1998-04-08T23:41:30.000+0000",234.0],[328.0,3.0,"1998-04-02T20:29:19.000+0000",223.0],[25.0,3.0,"1997-11-13T21:23:24.000+0000",15.0],[147.0,4.0,"1997-10-10T20:06:42.000+0000",268.0],[1220.0,3.0,"1998-04-04T20:44:38.000+0000",94.0],[405.0,4.0,"1997-11-07T23:37:20.000+0000",274.0],[492.0,5.0,"1998-03-31T13:46:50.000+0000",7.0],[217.0,2.0,"1997-10-01T22:21:41.000+0000",268.0],[55.0,5.0,"1997-10-24T18:32:36.000+0000",16.0],[620.0,3.0,"1998-03-09T00:11:38.000+0000",164.0],[161.0,4.0,"1997-11-25T16:11:33.000+0000",290.0],[515.0,4.0,"1997-09-30T17:33:20.000+0000",92.0],[1070.0,5.0,"1998-03-06T10:10:32.000+0000",239.0],[449.0,5.0,"1998-04-15T22:28:28.000+0000",56.0],[234.0,4.0,"1998-01-11T16:09:28.000+0000",248.0],[10.0,3.0,"1998-03-30T03:17:31.000+0000",234.0],[1049.0,2.0,"1998-04-04T15:08:06.000+0000",280.0],[187.0,5.0,"1998-02-17T18:06:00.000+0000",308.0],[64.0,5.0,"1997-09-20T20:30:41.000+0000",276.0],[948.0,3.0,"1997-12-06T00:31:42.000+0000",192.0],[509.0,4.0,"1997-11-11T17:48:31.000+0000",122.0],[588.0,3.0,"1997-11-29T21:18:26.000+0000",85.0],[931.0,2.0,"1997-11-17T18:21:14.000+0000",262.0],[272.0,3.0,"1998-01-28T18:55:00.000+0000",201.0],[870.0,2.0,"1997-11-08T04:17:03.000+0000",181.0],[739.0,4.0,"1997-11-14T14:38:39.000+0000",295.0],[568.0,4.0,"1998-03-30T23:09:47.000+0000",263.0],[39.0,4.0,"1997-11-14T14:37:59.000+0000",295.0],[1100.0,4.0,"1998-01-06T18:53:20.000+0000",201.0],[820.0,3.0,"1998-02-28T22:46:06.000+0000",93.0],[1028.0,5.0,"1997-11-26T15:18:59.000+0000",159.0],[665.0,2.0,"1997-11-21T17:48:52.000+0000",158.0],[423.0,3.0,"1998-03-03T06:21:10.000+0000",293.0],[597.0,3.0,"1997-11-05T22:28:02.000+0000",82.0],[181.0,5.0,"1997-09-20T20:14:48.000+0000",276.0],[823.0,5.0,"1997-12-17T22:30:33.000+0000",13.0],[2.0,3.0,"1998-03-05T03:49:42.000+0000",217.0],[660.0,4.0,"1997-11-23T18:04:16.000+0000",83.0],[20.0,5.0,"1998-04-22T17:01:06.000+0000",189.0],[796.0,4.0,"1997-10-30T03:54:44.000+0000",222.0],[1022.0,5.0,"1998-04-01T19:16:33.000+0000",146.0],[121.0,3.0,"1997-11-08T06:31:21.000+0000",267.0],[294.0,3.0,"1998-02-19T02:24:47.000+0000",126.0],[1060.0,1.0,"1997-11-08T04:17:55.000+0000",181.0],[80.0,4.0,"1998-04-17T18:47:45.000+0000",125.0],[120.0,4.0,"1998-01-05T19:43:50.000+0000",43.0],[780.0,1.0,"1997-12-14T23:27:37.000+0000",13.0],[259.0,2.0,"1998-04-03T18:41:23.000+0000",253.0],[44.0,3.0,"1997-12-03T00:22:28.000+0000",42.0],[518.0,4.0,"1998-01-14T04:46:42.000+0000",77.0],[686.0,5.0,"1997-09-21T09:46:05.000+0000",291.0],[21.0,3.0,"1997-10-01T21:53:42.000+0000",268.0],[28.0,3.0,"1997-11-17T18:43:40.000+0000",262.0],[81.0,3.0,"1998-04-11T22:44:40.000+0000",234.0],[245.0,3.0,"1997-12-22T20:00:03.000+0000",29.0],[57.0,5.0,"1998-03-17T06:36:15.000+0000",236.0],[729.0,3.0,"1997-11-21T17:25:16.000+0000",158.0],[661.0,4.0,"1998-02-22T22:19:07.000+0000",156.0],[52.0,5.0,"1998-02-27T03:28:50.000+0000",232.0],[866.0,5.0,"1998-01-08T19:32:07.000+0000",168.0],[288.0,4.0,"1997-11-30T18:40:58.000+0000",37.0],[245.0,3.0,"1998-01-12T05:53:46.000+0000",141.0],[230.0,4.0,"1998-03-11T22:26:02.000+0000",235.0],[70.0,3.0,"1998-03-02T01:52:17.000+0000",102.0],[172.0,3.0,"1998-01-14T04:36:02.000+0000",77.0],[506.0,5.0,"1998-03-31T22:28:39.000+0000",90.0],[566.0,5.0,"1997-11-08T21:14:23.000+0000",186.0],[660.0,5.0,"1997-11-01T01:31:55.000+0000",44.0],[774.0,5.0,"1997-09-27T18:33:18.000+0000",118.0],[661.0,5.0,"1998-03-31T13:40:24.000+0000",7.0],[1003.0,2.0,"1998-02-21T13:44:11.000+0000",49.0],[68.0,1.0,"1997-11-12T22:49:29.000+0000",62.0],[1028.0,4.0,"1997-12-02T23:41:12.000+0000",42.0],[433.0,4.0,"1997-12-22T21:57:14.000+0000",178.0],[51.0,2.0,"1997-11-13T20:59:42.000+0000",85.0],[474.0,5.0,"1998-01-13T23:00:07.000+0000",77.0],[1099.0,2.0,"1998-04-10T21:17:59.000+0000",58.0],[1047.0,4.0,"1998-04-18T14:54:50.000+0000",56.0],[688.0,1.0,"1998-04-01T05:46:04.000+0000",197.0],[99.0,4.0,"1997-10-29T16:14:41.000+0000",286.0],[258.0,3.0,"1998-03-31T22:08:41.000+0000",90.0],[1288.0,1.0,"1997-11-08T04:12:29.000+0000",181.0],[190.0,4.0,"1997-11-14T14:17:42.000+0000",295.0],[69.0,4.0,"1998-02-21T17:34:55.000+0000",224.0],[317.0,4.0,"1997-11-13T21:02:57.000+0000",272.0],[1010.0,3.0,"1997-09-26T04:04:22.000+0000",221.0],[877.0,1.0,"1997-12-31T20:44:49.000+0000",66.0],[318.0,5.0,"1997-10-17T21:47:51.000+0000",207.0],[487.0,3.0,"1998-04-08T23:47:17.000+0000",234.0],[648.0,5.0,"1998-03-31T13:40:53.000+0000",7.0],[82.0,5.0,"1997-11-18T17:56:14.000+0000",87.0],[1052.0,1.0,"1997-10-26T03:05:02.000+0000",195.0],[449.0,5.0,"1998-01-01T00:08:54.000+0000",44.0],[287.0,4.0,"1997-10-10T17:27:22.000+0000",306.0],[172.0,3.0,"1997-11-14T15:31:14.000+0000",194.0],[62.0,3.0,"1998-04-04T20:48:53.000+0000",94.0],[659.0,4.0,"1998-04-16T14:51:17.000+0000",167.0],[100.0,4.0,"1997-11-18T19:02:00.000+0000",108.0],[304.0,5.0,"1997-11-25T18:58:06.000+0000",230.0],[927.0,1.0,"1997-11-08T04:17:55.000+0000",181.0],[302.0,4.0,"1997-11-30T22:21:59.000+0000",54.0],[22.0,4.0,"1998-03-31T22:45:57.000+0000",90.0],[696.0,2.0,"1997-11-08T04:23:17.000+0000",181.0],[357.0,4.0,"1997-10-22T14:45:37.000+0000",286.0],[269.0,4.0,"1998-04-10T21:06:43.000+0000",14.0],[179.0,2.0,"1998-01-09T17:02:37.000+0000",311.0],[121.0,5.0,"1997-09-30T17:31:19.000+0000",92.0],[440.0,1.0,"1997-09-22T18:09:58.000+0000",21.0],[550.0,1.0,"1997-11-27T03:44:24.000+0000",244.0],[405.0,4.0,"1997-11-08T04:21:59.000+0000",181.0],[806.0,4.0,"1997-11-11T02:48:49.000+0000",65.0],[540.0,2.0,"1997-11-30T18:54:30.000+0000",37.0],[443.0,5.0,"1997-11-01T01:38:09.000+0000",44.0],[183.0,4.0,"1997-11-27T04:47:23.000+0000",244.0],[265.0,4.0,"1997-11-03T07:34:01.000+0000",1.0],[25.0,5.0,"1997-10-15T22:27:36.000+0000",270.0],[387.0,2.0,"1998-03-10T04:05:56.000+0000",299.0],[572.0,3.0,"1998-04-04T21:04:43.000+0000",94.0],[746.0,4.0,"1997-10-22T15:10:58.000+0000",286.0],[272.0,5.0,"1998-03-06T10:47:27.000+0000",239.0],[55.0,5.0,"1997-11-23T00:32:25.000+0000",216.0],[121.0,3.0,"1998-02-03T02:19:29.000+0000",254.0],[665.0,2.0,"1997-11-12T23:14:43.000+0000",62.0],[385.0,4.0,"1997-12-22T21:43:02.000+0000",178.0],[23.0,4.0,"1997-11-14T15:53:39.000+0000",194.0],[955.0,3.0,"1997-10-01T22:32:40.000+0000",268.0],[143.0,5.0,"1997-09-24T03:44:34.000+0000",188.0],[294.0,4.0,"1997-09-20T20:12:46.000+0000",276.0],[1098.0,4.0,"1997-11-21T17:57:49.000+0000",158.0],[845.0,3.0,"1997-12-09T15:34:23.000+0000",207.0],[48.0,1.0,"1998-03-29T11:25:45.000+0000",161.0],[654.0,4.0,"1998-02-01T09:05:37.000+0000",305.0],[324.0,3.0,"1997-11-13T16:37:58.000+0000",47.0],[736.0,4.0,"1998-03-12T21:46:52.000+0000",64.0],[751.0,3.0,"1998-04-02T23:45:53.000+0000",191.0],[378.0,5.0,"1998-03-31T14:03:31.000+0000",7.0],[92.0,5.0,"1998-02-23T03:36:37.000+0000",59.0],[268.0,5.0,"1997-12-13T15:31:49.000+0000",69.0],[461.0,3.0,"1997-10-26T18:02:24.000+0000",10.0],[129.0,4.0,"1997-09-22T18:03:02.000+0000",21.0],[9.0,4.0,"1998-01-09T00:05:28.000+0000",58.0],[152.0,3.0,"1997-11-14T23:26:36.000+0000",194.0],[200.0,5.0,"1998-03-31T14:12:23.000+0000",7.0],[126.0,5.0,"1997-09-24T04:53:47.000+0000",113.0],[328.0,5.0,"1997-10-22T21:50:28.000+0000",173.0],[233.0,4.0,"1997-11-10T21:12:34.000+0000",95.0],[194.0,5.0,"1997-10-24T19:18:53.000+0000",16.0],[323.0,4.0,"1998-02-23T04:06:49.000+0000",59.0],[654.0,3.0,"1998-01-09T16:57:55.000+0000",311.0],[589.0,4.0,"1997-12-02T23:31:56.000+0000",292.0],[203.0,4.0,"1998-01-04T23:07:04.000+0000",43.0],[50.0,4.0,"1998-03-30T15:25:45.000+0000",79.0],[70.0,5.0,"1998-03-11T22:33:39.000+0000",235.0],[190.0,5.0,"1998-04-17T18:05:09.000+0000",125.0],[322.0,3.0,"1998-01-20T20:54:31.000+0000",284.0],[161.0,5.0,"1997-11-14T00:49:07.000+0000",303.0],[378.0,3.0,"1998-02-03T02:53:16.000+0000",254.0],[1034.0,1.0,"1997-12-27T10:03:50.000+0000",255.0],[301.0,2.0,"1998-02-25T21:31:15.000+0000",104.0],[923.0,5.0,"1998-03-31T22:38:32.000+0000",90.0],[463.0,4.0,"1997-12-31T20:55:13.000+0000",6.0],[122.0,1.0,"1997-09-26T18:10:33.000+0000",279.0],[298.0,4.0,"1997-10-02T15:43:24.000+0000",286.0],[448.0,3.0,"1997-10-30T03:52:45.000+0000",222.0],[57.0,5.0,"1997-09-26T02:03:03.000+0000",297.0],[625.0,3.0,"1997-12-03T00:27:53.000+0000",42.0],[1217.0,4.0,"1997-10-02T14:16:18.000+0000",130.0],[357.0,3.0,"1998-02-03T02:21:06.000+0000",254.0],[475.0,1.0,"1997-11-26T17:00:41.000+0000",109.0],[1444.0,2.0,"1997-11-25T19:22:06.000+0000",230.0],[310.0,3.0,"1997-11-27T03:38:25.000+0000",244.0],[301.0,2.0,"1997-12-31T20:33:26.000+0000",6.0],[748.0,4.0,"1997-12-15T03:41:25.000+0000",36.0],[443.0,3.0,"1997-12-15T05:45:27.000+0000",256.0],[515.0,1.0,"1998-03-02T01:15:16.000+0000",102.0],[285.0,4.0,"1998-02-26T03:53:21.000+0000",104.0],[447.0,5.0,"1997-09-22T18:08:15.000+0000",21.0],[301.0,4.0,"1998-04-04T08:53:48.000+0000",111.0],[408.0,5.0,"1997-11-21T16:27:08.000+0000",18.0],[222.0,4.0,"1998-01-26T22:13:37.000+0000",25.0],[944.0,3.0,"1998-02-09T01:58:21.000+0000",110.0],[98.0,5.0,"1997-10-15T22:51:08.000+0000",270.0],[237.0,5.0,"1997-10-16T03:55:33.000+0000",68.0],[215.0,4.0,"1997-11-23T17:59:00.000+0000",83.0],[258.0,2.0,"1997-12-28T00:17:58.000+0000",6.0],[216.0,5.0,"1997-11-13T22:24:19.000+0000",89.0],[317.0,4.0,"1997-11-19T19:33:49.000+0000",128.0],[512.0,4.0,"1998-02-01T08:58:45.000+0000",305.0],[412.0,2.0,"1998-03-14T21:58:11.000+0000",184.0],[175.0,5.0,"1997-10-22T15:01:10.000+0000",286.0],[1428.0,3.0,"1998-02-26T03:53:29.000+0000",279.0],[86.0,5.0,"1997-12-15T05:51:43.000+0000",256.0],[48.0,5.0,"1997-09-26T03:44:22.000+0000",221.0],[332.0,3.0,"1997-11-08T18:26:57.000+0000",140.0],[977.0,2.0,"1998-03-27T23:55:38.000+0000",190.0],[227.0,3.0,"1998-04-06T23:38:16.000+0000",11.0],[203.0,5.0,"1998-01-06T19:21:11.000+0000",201.0],[181.0,5.0,"1997-11-05T16:18:05.000+0000",150.0],[245.0,3.0,"1998-02-19T02:18:46.000+0000",126.0],[208.0,2.0,"1997-11-16T08:36:41.000+0000",20.0],[742.0,4.0,"1998-02-21T23:35:22.000+0000",144.0],[930.0,1.0,"1997-11-08T04:27:55.000+0000",181.0],[566.0,4.0,"1997-11-26T21:13:34.000+0000",109.0],[1065.0,3.0,"1997-11-13T21:03:41.000+0000",85.0],[133.0,3.0,"1997-11-08T02:26:13.000+0000",213.0],[379.0,1.0,"1997-10-30T04:04:50.000+0000",222.0],[11.0,3.0,"1998-04-02T20:57:29.000+0000",223.0],[421.0,4.0,"1998-04-01T13:01:44.000+0000",215.0],[208.0,3.0,"1997-10-22T02:46:06.000+0000",218.0],[937.0,5.0,"1998-02-02T15:23:09.000+0000",174.0],[186.0,3.0,"1997-11-23T19:46:23.000+0000",275.0],[742.0,1.0,"1997-10-16T03:56:38.000+0000",68.0],[583.0,4.0,"1997-10-10T20:03:50.000+0000",268.0],[462.0,4.0,"1997-10-14T19:45:46.000+0000",160.0],[273.0,4.0,"1997-10-28T06:15:42.000+0000",195.0],[178.0,4.0,"1998-02-21T17:34:28.000+0000",224.0],[110.0,1.0,"1997-09-30T16:21:33.000+0000",5.0],[1016.0,5.0,"1998-01-24T21:52:04.000+0000",99.0],[251.0,5.0,"1998-02-27T04:01:24.000+0000",2.0],[9.0,4.0,"1997-12-02T23:09:08.000+0000",292.0],[568.0,4.0,"1997-11-20T14:46:43.000+0000",72.0],[228.0,3.0,"1997-12-22T17:54:08.000+0000",85.0],[281.0,5.0,"1997-11-23T17:44:32.000+0000",83.0],[831.0,2.0,"1998-02-02T18:21:48.000+0000",92.0],[543.0,3.0,"1998-03-31T13:42:52.000+0000",7.0],[401.0,2.0,"1997-11-18T18:13:33.000+0000",87.0],[926.0,4.0,"1997-09-27T04:25:40.000+0000",287.0],[155.0,2.0,"1997-11-03T07:30:01.000+0000",1.0],[632.0,2.0,"1998-04-08T23:52:18.000+0000",234.0],[53.0,5.0,"1997-10-30T04:01:53.000+0000",222.0],[64.0,5.0,"1997-09-27T01:12:38.000+0000",24.0],[554.0,3.0,"1998-03-31T14:30:39.000+0000",7.0],[56.0,3.0,"1997-11-05T22:36:50.000+0000",82.0],[318.0,3.0,"1998-03-29T11:27:04.000+0000",161.0],[393.0,4.0,"1997-12-04T16:11:03.000+0000",196.0],[91.0,4.0,"1998-04-15T23:34:35.000+0000",56.0],[477.0,3.0,"1997-10-08T11:49:04.000+0000",82.0],[472.0,2.0,"1998-03-31T14:09:17.000+0000",7.0],[761.0,4.0,"1997-12-15T05:44:04.000+0000",256.0],[56.0,4.0,"1998-01-04T04:45:02.000+0000",226.0],[741.0,5.0,"1997-09-26T18:01:31.000+0000",279.0],[1286.0,3.0,"1998-02-17T17:55:51.000+0000",308.0],[8.0,5.0,"1997-10-24T19:52:16.000+0000",16.0],[202.0,3.0,"1997-10-17T22:46:28.000+0000",180.0],[93.0,4.0,"1997-11-25T05:15:40.000+0000",203.0],[56.0,5.0,"1997-09-26T11:04:56.000+0000",145.0],[305.0,4.0,"1998-02-01T22:35:27.000+0000",288.0],[742.0,3.0,"1997-12-30T02:57:23.000+0000",84.0],[644.0,3.0,"1997-11-01T01:30:18.000+0000",44.0],[13.0,3.0,"1998-01-20T05:04:14.000+0000",17.0],[117.0,4.0,"1998-03-27T16:15:19.000+0000",313.0],[1.0,4.0,"1997-10-16T16:30:11.000+0000",148.0],[347.0,4.0,"1998-04-01T05:37:50.000+0000",197.0],[164.0,5.0,"1997-09-22T18:08:15.000+0000",21.0],[982.0,3.0,"1997-09-26T18:25:14.000+0000",279.0],[491.0,5.0,"1998-03-06T10:43:35.000+0000",239.0],[287.0,5.0,"1997-12-30T23:58:08.000+0000",185.0],[89.0,4.0,"1997-09-26T01:58:45.000+0000",297.0],[68.0,4.0,"1997-11-14T00:29:21.000+0000",303.0],[250.0,1.0,"1997-11-08T21:13:27.000+0000",186.0],[206.0,3.0,"1998-02-28T00:29:14.000+0000",73.0],[756.0,2.0,"1998-02-26T04:02:19.000+0000",104.0],[216.0,3.0,"1998-01-27T03:11:05.000+0000",94.0],[194.0,5.0,"1998-03-06T10:07:13.000+0000",239.0],[511.0,5.0,"1998-04-01T05:50:39.000+0000",197.0],[1.0,4.0,"1998-04-04T14:33:46.000+0000",280.0],[117.0,3.0,"1997-09-22T22:02:19.000+0000",1.0],[583.0,1.0,"1998-02-21T23:28:49.000+0000",224.0],[397.0,1.0,"1997-11-14T21:43:51.000+0000",303.0],[162.0,4.0,"1997-12-28T16:48:54.000+0000",60.0],[258.0,4.0,"1998-01-07T20:21:41.000+0000",198.0],[513.0,5.0,"1998-03-06T10:08:07.000+0000",239.0],[69.0,3.0,"1997-12-31T20:47:57.000+0000",6.0],[375.0,4.0,"1997-10-09T05:20:19.000+0000",233.0],[642.0,4.0,"1997-12-24T20:33:35.000+0000",85.0],[38.0,3.0,"1998-02-09T01:42:54.000+0000",110.0],[522.0,3.0,"1998-03-14T20:47:42.000+0000",184.0],[873.0,1.0,"1998-01-24T21:47:16.000+0000",99.0],[418.0,2.0,"1997-12-17T22:46:03.000+0000",13.0],[518.0,4.0,"1998-01-06T18:43:21.000+0000",201.0],[858.0,1.0,"1997-12-17T22:17:48.000+0000",13.0],[131.0,3.0,"1998-04-02T19:14:25.000+0000",214.0],[228.0,4.0,"1998-01-07T18:21:04.000+0000",296.0],[87.0,3.0,"1997-10-30T03:36:29.000+0000",222.0],[725.0,4.0,"1997-09-26T22:49:04.000+0000",279.0],[182.0,2.0,"1998-03-05T03:55:09.000+0000",217.0],[433.0,3.0,"1997-11-18T04:52:00.000+0000",85.0],[234.0,3.0,"1998-03-06T10:06:02.000+0000",239.0],[72.0,4.0,"1997-12-14T23:22:07.000+0000",13.0],[77.0,3.0,"1997-11-14T17:10:21.000+0000",194.0],[663.0,5.0,"1997-12-26T03:54:36.000+0000",208.0],[178.0,3.0,"1997-11-26T19:35:50.000+0000",109.0],[172.0,4.0,"1997-11-25T19:02:03.000+0000",230.0],[485.0,2.0,"1998-02-23T03:27:46.000+0000",59.0]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"itemId","type":"\"long\"","metadata":"{}"},{"name":"rating","type":"\"long\"","metadata":"{}"},{"name":"timestamp","type":"\"timestamp\"","metadata":"{}"},{"name":"userId","type":"\"long\"","metadata":"{}"}],"overflow":true,"aggData":[[1.0,6110.0],[2.0,11370.0],[3.0,27145.0],[4.0,34174.0],[5.0,21201.0]],"aggSchema":[{"name":"rating","type":"\"long\"","metadata":"{\"aggRole\":\"groupBy\"}"},{"name":"userId","type":"\"long\"","metadata":"{\"aggRole\":\"agg\"}"}],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"scalar","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;ratingsScore&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-62-3ad9eaa94fd7&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansired\"># Cool display</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 2</span><span class=\"ansiyellow\"> </span>display<span class=\"ansiyellow\">(</span>ratingsScore<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;ratingsScore&apos; is not defined\n</div>","workflows":[],"startTime":1.481216283669E12,"submitTime":1.481216283649E12,"finishTime":1.481216287758E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"260","height":"auto","xColumns":[],"yColumns":["userId"],"pivotColumns":["rating"],"pivotAggregation":"count","customPlotOptions":{"barChart":[{"key":"grouped","value":true},{"key":"stacked","value":false},{"key":"100_stacked","value":false}],"scatterPlot":[{"key":"loess","value":false},{"key":"bandwidth","value":"0.3"}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"00639804-fab1-4b99-9c05-579db96b576f"},{"version":"CommandV1","origId":231,"guid":"def5ae7b-c276-417a-9f04-cec25bcee824","subtype":"command","commandType":"auto","position":49.0,"command":"%md ### 2.5 DataFrame NA Functions\n\n`Spark SQL` also provide simple functions for working with missing data in DataFrame.\n\nLet's first create a small DataFrame that contains some `na` fields","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"7de02296-d881-45f4-a0c1-40bd5f01d72a"},{"version":"CommandV1","origId":232,"guid":"c02747c1-7f2f-4565-b68c-287315d92087","subtype":"command","commandType":"auto","position":50.0,"command":"df = userDF.take(10)\ndf.append(Row(age=None, gender=u'F', occupation=None, userId=11, zipCode=u'30329'))\nuserDFna = spark.createDataFrame(df)\nuserDFna.show()","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+----+------+-------------+------+-------+\n| age|gender|   occupation|userId|zipCode|\n+----+------+-------------+------+-------+\n|  24|     M|   technician|     1|  85711|\n|  53|     F|        other|     2|  94043|\n|  23|     M|       writer|     3|  32067|\n|  24|     M|   technician|     4|  43537|\n|  33|     F|        other|     5|  15213|\n|  42|     M|    executive|     6|  98101|\n|  57|     M|administrator|     7|  91344|\n|  36|     M|administrator|     8|  05201|\n|  29|     M|      student|     9|  01002|\n|  53|     M|       lawyer|    10|  90703|\n|null|     F|         null|    11|  30329|\n+----+------+-------------+------+-------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481216896594E12,"submitTime":1.481216896642E12,"finishTime":1.481216897016E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"f86aaef2-f845-44e0-b848-4ce4cc4c6435"},{"version":"CommandV1","origId":233,"guid":"bacde409-0261-4125-9966-38782c5a20ba","subtype":"command","commandType":"auto","position":51.0,"command":"%md `drop(how='any')` returns a new DataFrame omitting rows with null values. Parameter how can be any or all.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"6f557291-4d5f-49fb-95be-faa2e52bfade"},{"version":"CommandV1","origId":234,"guid":"74f5c3cc-d321-474a-8fce-9a88258c53b5","subtype":"command","commandType":"auto","position":52.0,"command":"userDFna.na.drop().show()","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---+------+-------------+------+-------+\n|age|gender|   occupation|userId|zipCode|\n+---+------+-------------+------+-------+\n| 24|     M|   technician|     1|  85711|\n| 53|     F|        other|     2|  94043|\n| 23|     M|       writer|     3|  32067|\n| 24|     M|   technician|     4|  43537|\n| 33|     F|        other|     5|  15213|\n| 42|     M|    executive|     6|  98101|\n| 57|     M|administrator|     7|  91344|\n| 36|     M|administrator|     8|  05201|\n| 29|     M|      student|     9|  01002|\n| 53|     M|       lawyer|    10|  90703|\n+---+------+-------------+------+-------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481216651578E12,"submitTime":1.481216651622E12,"finishTime":1.48121665185E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"c6856a31-9a81-45a0-8462-20d4a9759278"},{"version":"CommandV1","origId":235,"guid":"f26504ce-1015-4d5a-ba6c-d538994663b8","subtype":"command","commandType":"auto","position":53.0,"command":"%md `fill(value)` replaces null values. value can be a single value or a python dict.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"5f7e97ac-43e6-4644-bdf7-d19e1cf19837"},{"version":"CommandV1","origId":236,"guid":"476b242f-9da5-4bec-b4b8-2d3e47171444","subtype":"command","commandType":"auto","position":54.0,"command":"# A single value will fill the null values in the columns of the same type\nuserDFna.na.fill(40).show()","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---+------+-------------+------+-------+\n|age|gender|   occupation|userId|zipCode|\n+---+------+-------------+------+-------+\n| 24|     M|   technician|     1|  85711|\n| 53|     F|        other|     2|  94043|\n| 23|     M|       writer|     3|  32067|\n| 24|     M|   technician|     4|  43537|\n| 33|     F|        other|     5|  15213|\n| 42|     M|    executive|     6|  98101|\n| 57|     M|administrator|     7|  91344|\n| 36|     M|administrator|     8|  05201|\n| 29|     M|      student|     9|  01002|\n| 53|     M|       lawyer|    10|  90703|\n| 40|     F|         null|    11|  30329|\n+---+------+-------------+------+-------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481216654646E12,"submitTime":1.481216654684E12,"finishTime":1.481216654967E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"f72c775c-3343-4c56-b7f1-dc4e20a1ac4f"},{"version":"CommandV1","origId":237,"guid":"9864e3e6-b86a-4285-9f77-eb3848aa9053","subtype":"command","commandType":"auto","position":55.0,"command":"userDFna.na.fill({'age': 30, 'occupation': u'other'}).show()","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---+------+-------------+------+-------+\n|age|gender|   occupation|userId|zipCode|\n+---+------+-------------+------+-------+\n| 24|     M|   technician|     1|  85711|\n| 53|     F|        other|     2|  94043|\n| 23|     M|       writer|     3|  32067|\n| 24|     M|   technician|     4|  43537|\n| 33|     F|        other|     5|  15213|\n| 42|     M|    executive|     6|  98101|\n| 57|     M|administrator|     7|  91344|\n| 36|     M|administrator|     8|  05201|\n| 29|     M|      student|     9|  01002|\n| 53|     M|       lawyer|    10|  90703|\n| 30|     F|        other|    11|  30329|\n+---+------+-------------+------+-------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481216657475E12,"submitTime":1.481216657518E12,"finishTime":1.481216657746E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"13352ba1-8b57-4d37-92a3-ff41429d7cc1"},{"version":"CommandV1","origId":238,"guid":"6c781ba8-d92b-4b0e-ae97-4d0a876e3e88","subtype":"command","commandType":"auto","position":56.0,"command":"%md ## 3 Using HiveQL in Spark SQL\n\n`SparkSession` in Spark 2.0 provides builtin support for Hive features including the ability to \n* write queries using HiveQL, \n* access to Hive UDFs, \n* and to read data from Hive tables.\n\n`SparkSession.sql(sqlQuery)` returns a DataFrame representing the result of the given query.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"c6fb18ca-d0e3-41e3-9f27-9cd5fcc0f03a"},{"version":"CommandV1","origId":239,"guid":"de54005b-fe78-43a0-b8bd-6304c68e91a3","subtype":"command","commandType":"auto","position":57.0,"command":"# This query will return all the available tables, \n# including views as well as tables in Hive metastore.\nspark.sql(\"SHOW tables\").show()","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---------+-----------+\n|tableName|isTemporary|\n+---------+-----------+\n+---------+-----------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481216911336E12,"submitTime":1.481216911387E12,"finishTime":1.481216911457E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"8955f791-d689-4b7b-a065-cd5679407b6d"},{"version":"CommandV1","origId":240,"guid":"545b0062-a12a-4a58-a4a3-9c69d4c2e62c","subtype":"command","commandType":"auto","position":58.0,"command":"%md ### 3.1 Creating Temporary Tables (Views)\n\nTo use a DataFrame as a temporary Hive table (view), we can use `createOrReplaceTempView(name)`:","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"3e88480e-1c8a-476d-bf8d-cc0eba9cb774"},{"version":"CommandV1","origId":241,"guid":"22f4c4a4-9893-4365-9547-d4ae2ca9b2e7","subtype":"command","commandType":"auto","position":59.0,"command":"# register DataFrame userDF as user\nuserDF.createOrReplaceTempView(\"userView\")\n\nspark.sql(\"SHOW tables\").show()\nspark.sql(\"SELECT * FROM userView WHERE occupation == 'programmer'\").show(10)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---------+-----------+\n|tableName|isTemporary|\n+---------+-----------+\n| userview|       true|\n+---------+-----------+\n\n+---+------+----------+------+-------+\n|age|gender|occupation|userId|zipCode|\n+---+------+----------+------+-------+\n| 30|     M|programmer|    17|  06355|\n| 41|     M|programmer|    29|  94043|\n| 29|     M|programmer|    45|  50233|\n| 26|     M|programmer|    53|  55414|\n| 37|     M|programmer|    55|  01331|\n| 27|     M|programmer|    58|  52246|\n| 50|     M|programmer|    82|  22902|\n| 38|     M|programmer|   102|  30220|\n| 27|     M|programmer|   114|  75013|\n| 32|     M|programmer|   119|  67401|\n+---+------+----------+------+-------+\nonly showing top 10 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481216985799E12,"submitTime":1.481216985852E12,"finishTime":1.481216986674E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"5aff799c-59b1-49ec-bdad-bf61199f93d3"},{"version":"CommandV1","origId":242,"guid":"9725bf4d-373c-4628-8625-25f5b7d628ae","subtype":"command","commandType":"auto","position":60.0,"command":"%md ### 3.2 Saving to Persistent Tables\n\n`DataFrames` can also be saved as persistent tables into Hive metastore using the saveAsTable command. If no Hive deployment exists then Spark will create a default local Hive metastore for you.\n\n`saveAsTable(name, mode=None)` saves the content of the DataFrame as the specified table. `mode` can be one of `append`, `overwrite`, `error`, `ignore` (default: error)","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"71634440-af7c-4bcb-b031-1e4ff84bf894"},{"version":"CommandV1","origId":243,"guid":"67532d68-5907-4e0d-8f31-942157bf37ba","subtype":"command","commandType":"auto","position":61.0,"command":"# When executing savdAsTable:\n# a folder with the name `spark-warehouse` will be created in the same folder\n# under `spark-warehouse` there will be a subfolder with the name `user`.\nuserDF.write.saveAsTable(\"user\", mode=\"overwrite\")\nspark.sql(\"SHOW tables\").show()","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---------+-----------+\n|tableName|isTemporary|\n+---------+-----------+\n|     user|      false|\n| userview|       true|\n+---------+-----------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1.481217283959E12,"submitTime":1.481217284016E12,"finishTime":1.481217288179E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"2d2f0c08-547a-4c64-8021-b8c22f642194"},{"version":"CommandV1","origId":244,"guid":"b3b5972d-f771-4a87-bd77-643028873e32","subtype":"command","commandType":"auto","position":62.0,"command":"%md ### Exercise 4\n\n4.1 Register the ratingDF DataFrame you created in Exercise 1 as a View\n\n4.2 Find the top 20 users's info based on the total number of ratings they gave using SQL query. ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"1b79cf3c-3e34-41f6-9651-e4a2ec0689f9"},{"version":"CommandV1","origId":245,"guid":"07ccea1c-2df9-4d41-94bd-8ca8318b6dfe","subtype":"command","commandType":"auto","position":63.0,"command":"# Your code goes here\n\n# 4.1\nratingsDF.createOrReplaceTempView(\"ratingsView\")\nspark.sql(\"SHOW tables\").show()\n\n# 4.2\nspark.sql(\"\"\" SELECT * FROM userView\n              LEFT JOIN\n              (SELECT userId, COUNT(*) AS count\n              FROM ratingsView\n              GROUP BY userId) AS table\n              ON userView.userId = table.userId\n              ORDER BY count DESC\n              LIMIT 20\n              \"\"\").show(10)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+-----------+-----------+\n|  tableName|isTemporary|\n+-----------+-----------+\n|       user|      false|\n|ratingsview|       true|\n|   userview|       true|\n+-----------+-----------+\n\n+---+------+----------+------+-------+------+-----+\n|age|gender|occupation|userId|zipCode|userId|count|\n+---+------+----------+------+-------+------+-----+\n| 22|     F|healthcare|   405|  10019|   405|  737|\n| 50|     F|healthcare|   655|  60657|   655|  685|\n| 47|     M|  educator|    13|  29206|    13|  636|\n| 35|     F|  educator|   450|  11758|   450|  540|\n| 21|     M|   student|   276|  95064|   276|  518|\n| 20|     F|   student|   416|  92626|   416|  493|\n| 36|     M|  engineer|   537|  22902|   537|  490|\n| 19|     M|   student|   303|  14853|   303|  484|\n| 60|     M|   retired|   234|  94702|   234|  480|\n| 19|     M|   student|   393|  83686|   393|  448|\n+---+------+----------+------+-------+------+-----+\nonly showing top 10 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">ParseException</span>: u&quot;\\nextraneous input &apos;;&apos; expecting {&lt;EOF&gt;, &apos;.&apos;, &apos;[&apos;, &apos;OR&apos;, &apos;AND&apos;, &apos;IN&apos;, NOT, &apos;BETWEEN&apos;, &apos;LIKE&apos;, RLIKE, &apos;IS&apos;, EQ, &apos;&lt;=&gt;&apos;, &apos;&lt;&gt;&apos;, &apos;!=&apos;, &apos;&lt;&apos;, LTE, &apos;&gt;&apos;, GTE, &apos;+&apos;, &apos;-&apos;, &apos;*&apos;, &apos;/&apos;, &apos;%&apos;, &apos;DIV&apos;, &apos;&amp;&apos;, &apos;|&apos;, &apos;^&apos;}(line 8, pos 22)\\n\\n== SQL ==\\n SELECT * FROM userView\\n              LEFT JOIN\\n              (SELECT userId, COUNT(*) AS count\\n              FROM ratingsView\\n              GROUP BY userId) AS table\\n              ON userView.userId = table.userId\\n              ORDER BY count DESC\\n              LIMIT 20;\\n----------------------^^^\\n              \\n&quot;","error":"<div class=\"ansiout\">+-----------+-----------+\n|  tableName|isTemporary|\n+-----------+-----------+\n|       user|      false|\n|ratingsview|       true|\n|   userview|       true|\n+-----------+-----------+\n\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: (&apos;EOF in multi-line string&apos;, (1, 14))\n\n<span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">ParseException</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-97-ad2e4c520805&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">     14</span>               ORDER BY count DESC<span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     15</span>               LIMIT <span class=\"ansicyan\">20</span><span class=\"ansiyellow\">;</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 16</span><span class=\"ansiyellow\">               &quot;&quot;&quot;).show(10)\n</span>\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/session.py</span> in <span class=\"ansicyan\">sql</span><span class=\"ansiblue\">(self, sqlQuery)</span>\n<span class=\"ansigreen\">    541</span>         <span class=\"ansiyellow\">[</span>Row<span class=\"ansiyellow\">(</span>f1<span class=\"ansiyellow\">=</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">,</span> f2<span class=\"ansiyellow\">=</span><span class=\"ansiblue\">u&apos;row1&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> Row<span class=\"ansiyellow\">(</span>f1<span class=\"ansiyellow\">=</span><span class=\"ansicyan\">2</span><span class=\"ansiyellow\">,</span> f2<span class=\"ansiyellow\">=</span><span class=\"ansiblue\">u&apos;row2&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> Row<span class=\"ansiyellow\">(</span>f1<span class=\"ansiyellow\">=</span><span class=\"ansicyan\">3</span><span class=\"ansiyellow\">,</span> f2<span class=\"ansiyellow\">=</span><span class=\"ansiblue\">u&apos;row3&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    542</span>         &quot;&quot;&quot;\n<span class=\"ansigreen\">--&gt; 543</span><span class=\"ansiyellow\">         </span><span class=\"ansigreen\">return</span> DataFrame<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">.</span>_jsparkSession<span class=\"ansiyellow\">.</span>sql<span class=\"ansiyellow\">(</span>sqlQuery<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> self<span class=\"ansiyellow\">.</span>_wrapped<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    544</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    545</span>     <span class=\"ansiyellow\">@</span>since<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">2.0</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.3-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">   1131</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1132</span>         return_value = get_return_value(\n<span class=\"ansigreen\">-&gt; 1133</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">   1134</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1135</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.py</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     71</span>                 <span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     72</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.catalyst.parser.ParseException: &apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 73</span><span class=\"ansiyellow\">                 </span><span class=\"ansigreen\">raise</span> ParseException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     74</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.streaming.StreamingQueryException: &apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     75</span>                 <span class=\"ansigreen\">raise</span> StreamingQueryException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">ParseException</span>: u&quot;\\nextraneous input &apos;;&apos; expecting {&lt;EOF&gt;, &apos;.&apos;, &apos;[&apos;, &apos;OR&apos;, &apos;AND&apos;, &apos;IN&apos;, NOT, &apos;BETWEEN&apos;, &apos;LIKE&apos;, RLIKE, &apos;IS&apos;, EQ, &apos;&lt;=&gt;&apos;, &apos;&lt;&gt;&apos;, &apos;!=&apos;, &apos;&lt;&apos;, LTE, &apos;&gt;&apos;, GTE, &apos;+&apos;, &apos;-&apos;, &apos;*&apos;, &apos;/&apos;, &apos;%&apos;, &apos;DIV&apos;, &apos;&amp;&apos;, &apos;|&apos;, &apos;^&apos;}(line 8, pos 22)\\n\\n== SQL ==\\n SELECT * FROM userView\\n              LEFT JOIN\\n              (SELECT userId, COUNT(*) AS count\\n              FROM ratingsView\\n              GROUP BY userId) AS table\\n              ON userView.userId = table.userId\\n              ORDER BY count DESC\\n              LIMIT 20;\\n----------------------^^^\\n              \\n&quot;\n</div>","workflows":[],"startTime":1.481218757685E12,"submitTime":1.48121875776E12,"finishTime":1.481218759396E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"f68ef254-65b5-4a5a-97e6-c2c194953ac2"},{"version":"CommandV1","origId":246,"guid":"e360b7d4-963d-430c-b9af-3a3b23b312f6","subtype":"command","commandType":"auto","position":64.0,"command":"%md ### 3.3 Using User Defined Functions\n\nTo use an UDF in SQL statements, we need to register the UDF with `registerFunction(name, f, returnType=StringType)`. For example:","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"9c9d9327-c99c-498a-849d-74879eae401d"},{"version":"CommandV1","origId":247,"guid":"bafbdc47-fbe4-4893-b4a8-920438edf446","subtype":"command","commandType":"auto","position":65.0,"command":"sqlContext.registerFunction(\"udfAgeGroup\", ageToGroup, StringType())\nspark.sql(\"SELECT *, udfAgeGroup(age) AS ageGroup FROM user\").show(10)","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"87aff250-2e5d-4a01-b5d5-92888552efee"},{"version":"CommandV1","origId":248,"guid":"f7397a16-b82c-4bbd-b899-d5d4c3bfee4a","subtype":"command","commandType":"auto","position":66.0,"command":"%md ### Exercise 5\n\nRedo Exercise 3 with UDF in SQL.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":true},"streamStates":{},"nuid":"baf6969d-9cf6-46a4-97a3-005f287903e4"},{"version":"CommandV1","origId":249,"guid":"de1876be-28e4-4931-87e7-2063a2c67ae7","subtype":"command","commandType":"auto","position":67.0,"command":"# Your code goes here\n","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":false},"streamStates":{},"nuid":"a6917d5d-6184-4152-a355-593d46243a27"},{"version":"CommandV1","origId":250,"guid":"0cf7c797-a401-4bb0-8af2-cf229ff803bb","subtype":"command","commandType":"auto","position":68.0,"command":"","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":true},"streamStates":{},"nuid":"f5acfe60-5eb2-4f5f-a5a0-f6e0658bf4e2"}],"dashboards":[],"guid":"53c5fbc5-ffcb-4f1d-8dbf-00d764386021","globalVars":{},"iPythonMetadata":{"nbformat":4.0,"IPythonMetadata":{"kernelspec":{"display_name":"Python 2","language":"python","name":"python2"},"language_info":{"mimetype":"text/x-python","name":"python","pygments_lexer":"ipython2","codemirror_mode":{"name":"ipython","version":2.0},"version":"2.7.11","nbconvert_exporter":"python","file_extension":".py"}}},"inputWidgets":{}};</script>
<script
 src="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/js/notebook-main.js"
 onerror="window.mainJsLoadError = true;"></script>
<script>var tableOfContentsCell = {"version":"CommandV1","origId":0,"guid":"5ba58b98-d7e0-4a86-9e89-b693dde18858","subtype":"command","commandType":"auto","position":0.0,"command":"%md [&lsaquo; Back to Table of Contents](../index.html)","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{}};</script>
</head>
<body>
  <script>
if (window.mainJsLoadError) {
  var u = 'https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/js/notebook-main.js';
  var b = document.getElementsByTagName('body')[0];
  var c = document.createElement('div');
  c.innerHTML = ('<h1>Network Error</h1>' +
    '<p><b>Please check your network connection and try again.</b></p>' +
    '<p>Could not load a required resource: ' + u + '</p>');
  c.style.margin = '30px';
  c.style.padding = '20px 50px';
  c.style.backgroundColor = '#f5f5f5';
  c.style.borderRadius = '5px';
  b.appendChild(c);
}
</script>
</body>
</html>